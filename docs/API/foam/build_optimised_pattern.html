<!DOCTYPE html>
<html>
<style>
.api-page-content {margin: 20px 0px 10px 200px; max-width: 75%;}

.sidenav {
  height: 100%;
  width: 170px;
  position: fixed;
  z-index: 1;
  top: 0;
  left: 0;
  background-color: #111;
  overflow-x: hidden;
  padding-top: 20px;
}

.sidenav a {
  padding: 6px 8px 6px 16px;
  text-decoration: none;
  font-size: 25px;
  color: #a0a0a0;
  display: block;
}

.sidenav a:hover {
  color: #f1f1f1;
}

.dropdown {
  float: left;
  overflow: hidden;
}

.dropdown .dropbtn {
  font-size: 25px;  
  border: none;
  outline: none;
  color: #a0a0a0;
  padding: 14px 16px;
  background-color: inherit;
  font-family: inherit;
  margin: 0;
}

.dropdown-content {
  font-size: 17px;
  display: none;
  position: absolute;
  background-color: #111;
  z-index: 1;
  padding-left: 5px;
  padding-bottom: 15px;
}

.dropdown-content a {
  font-size: 16px;
  float: none;
  color: #a0a0a0;
  text-decoration: none;
  display: block;
  text-align: left;
}

.dropdown-content a:hover {
  color: #f1f1f1
}

.dropdown:hover .dropdown-content {
  display: block;
}
</style><!-- <div id="sidenav" class="sidenav" onmouseover="expandSidebar()" onmouseout="collapseSidebar()"> -->
    <div id="sidenav" class="sidenav"">
        <a href="https://michielsenm.github.io/TEST_foam/">Home</a>
        <a href="https://michielsenm.github.io/TEST_foam">Installation</a>
        <a href="https://michielsenm.github.io/TEST_foam/Walkthrough">Walkthrough</a>
        <a href="https://michielsenm.github.io/TEST_foam/Pipeline">Pipeline modules</a>
        <a href="https://michielsenm.github.io/TEST_foam/Configuration">Pipeline configuration</a>
        <a href="https://michielsenm.github.io/TEST_foam/Plottools">Plotting tools</a>
        <a href="https://michielsenm.github.io/TEST_foam/Guidelines">Community guidelines</a>
        <div class="dropdown">
        <button class="dropbtn" href="https://michielsenm.github.io/TEST_foam/API/index.html">API</button>
        <div class="dropdown-content">
            <a href="https://michielsenm.github.io/TEST_foam/API/foam/additional_constraints.html">Additional constraints</a>
            <a href="https://michielsenm.github.io/TEST_foam/API/foam/build_optimised_pattern.html">Build optimised pattern</a>
            <a href="https://michielsenm.github.io/TEST_foam/API/foam/functions_for_gyre.html">Functions for gyre</a>
            <a href="https://michielsenm.github.io/TEST_foam/API/foam/functions_for_mesa.html">Functions for mesa</a>
            <a href="https://michielsenm.github.io/TEST_foam/API/foam/gmode_rotation_scaling.html">Gmode rotation scaling</a>
            <a href="https://michielsenm.github.io/TEST_foam/API/foam/maximum_likelihood_estimator.html">Maximum likelihood estimator</a>
            <a href="https://michielsenm.github.io/TEST_foam/API/foam/model_grid.html">Model grid</a>
            <a href="https://michielsenm.github.io/TEST_foam/API/foam/plot_tools.html">Plot tools</a>
            <a href="https://michielsenm.github.io/TEST_foam/API/foam/support_functions.html">Support functions</a>
        </div>
      </div>
      </div>  
      
      <!-- <script>
        document.getElementById("page-content").style.marginLeft = "160px"
        function expandSidebar() {
            console.log("opening sidebar");
            document.getElementById("sidenav").style.left = "0px";
            document.getElementById("page-content").style.marginLeft = "160px";
          } 
          function collapseSidebar() {
            console.log("closing sidebar");
            document.getElementById("sidenav").style.left = "-100px";
            document.getElementById("page-content").style.marginLeft = "60px";
          } 
      </script> --><div id="page-content" class="api-page-content">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <h1 id="project_title"> FAOM API documentation</h1>
        </header>
    </div>

    <!-- MAIN CONTENT -->

    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../foam.html">foam</a><wbr>.build_optimised_pattern    </h1>

                        <div class="docstring"><p>Selection of the theoretical pulsation patterns that best match the observations,
with the possibility to optimise the rotation rate in the process through rescaling.</p>
</div>

                        <input id="mod-build_optimised_pattern-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-build_optimised_pattern-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;Selection of the theoretical pulsation patterns that best match the observations,</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">   with the possibility to optimise the rotation rate in the process through rescaling.&quot;&quot;&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span> <span class="nn">multiprocessing</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span> <span class="nn">lmfit</span> <span class="kn">import</span> <span class="n">Minimizer</span><span class="p">,</span> <span class="n">Parameters</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;logger.bop&quot;</span><span class="p">)</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="c1">################################################################################</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="k">def</span> <span class="nf">generate_spacing_series</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    Generate the period spacing series (delta P = p_(n+1) - p_n )</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    Parameters</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    ----------</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    periods: list of floats</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">        Periods in units of days</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">     errors (optional): list of floats</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">        Errors on periods in units of days</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    Returns</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    ----------</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    observed_spacings, observed_spacings_errors: tuple of lists of floats</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">        period spacing series (delta P values) and its errors (if supplied) in units of seconds</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    <span class="n">spacings</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="k">if</span> <span class="n">errors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="n">spacings_errors</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">period_n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">periods</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>            <span class="n">spacings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">period_n</span> <span class="o">-</span> <span class="n">periods</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">86400.0</span><span class="p">)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="n">spacings_errors</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">period_n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">periods</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>            <span class="n">spacings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">period_n</span> <span class="o">-</span> <span class="n">periods</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">86400.0</span><span class="p">)</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>            <span class="n">spacings_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">errors</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">86400.0</span><span class="p">)</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>    <span class="k">return</span> <span class="n">spacings</span><span class="p">,</span> <span class="n">spacings_errors</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="c1">################################################################################</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="k">def</span> <span class="nf">construct_theoretical_puls_pattern</span><span class="p">(</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>    <span class="n">pulsation_grid_file</span><span class="p">,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>    <span class="n">observations_file</span><span class="p">,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    <span class="n">method_build_series</span><span class="p">,</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>    <span class="n">pattern_starting_pulsation</span><span class="o">=</span><span class="p">[],</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    <span class="n">which_observable</span><span class="o">=</span><span class="s2">&quot;period&quot;</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;theoretical_frequency_patterns.hdf&quot;</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="n">asymptotic_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>    <span class="n">estimated_rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="n">grid_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>    <span class="n">nr_cpu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="p">):</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">    Construct the theoretical frequency pattern for each model in the grid, which correspond to the observed pattern.</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    (Each theoretical model is a row in &#39;pulsation_grid_file&#39;.)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    The rotation rate will be scaled and optimised for each theoretical pattern individually.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    This optimisation will not be performed if asymptotic_object=None.</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">    Parameters</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">    ----------</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">    pulsation_grid_file: string</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        path to file containing input parameters of the models, and the pulsation frequencies of those models</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">        (as generated by function &#39;extract_frequency_grid&#39; in &#39;functions_for_gyre&#39;).</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">    observations_file: string</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">        Path to the tsv file with observations, with a column for each observable and each set of errors.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        Column names specify the observable, and &quot;_err&quot; suffix denotes that it&#39;s the error.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">    method_build_series: string</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        way to generate the theoretical frequency pattern from each model to match the observed pattern. Options are:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">            provided-pulsation: build pattern from the provided pulsation    (function &#39;puls_series_from_given_puls&#39;)</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">            highest-frequency: build pattern from the observed highest frequency    (function &#39;puls_series_from_given_puls&#39;)</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">            chisq-longest-sequence: build pattern based on longest, best matching sequence of pulsations (function &#39;chisq_longest_sequence&#39;)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">    pattern_starting_pulsation: list of floats</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        Only needed if you set method_build_series=provided-pulsation</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        Value of the pulsation to start building the pattern from, one for each separated part of the pattern.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        The unit of this value needs to be the same as the observable set through which_observable.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">    which_observable: string</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">        Observable used in the theoretical pattern construction, options are &#39;frequency&#39; or &#39;period&#39;.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">    output_file: string</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">        Name (can include a path) for the file containing all the pulsation frequencies of the grid.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">    asymptotic_object: asymptotic (see &#39;gmode_rotation_scaling&#39;)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">        Object to calculate g-mode period spacing patterns in the asymptotic regime using the TAR.</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    estimated_rotation: float</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">        Estimation of the rotation rate of the star, used as initial value in the optimisation problem.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">    grid_parameters: list of string</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">        List of the parameters in the theoretical grid.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">    nr_cpu: int</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">        Number of worker processes to use in multiprocessing. The default &#39;None&#39; will use the number returned by os.cpu_count().</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="c1"># Read in the files with observed and theoretical frequencies as pandas DataFrames</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="n">obs_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">observations_file</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>    <span class="n">theory_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">pulsation_grid_file</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>    <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="n">which_observable</span><span class="p">])</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="n">obs_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">which_observable</span><span class="si">}</span><span class="s2">_err&quot;</span><span class="p">])</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="c1"># if frequency was filled in as 0, it indicates an interruption in the pattern</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="n">missing_puls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>    <span class="c1"># remove values indicating interruptions in the pattern</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>    <span class="n">obs_without_missing</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="n">obs</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="c1"># remove values indicating interruptions in the pattern</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="n">obs_err_without_missing</span> <span class="o">=</span> <span class="n">obs_err</span><span class="p">[</span><span class="n">obs_err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>    <span class="c1"># Adjust indices for removed 0-values of missing frequencies</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="n">missing_puls</span> <span class="o">=</span> <span class="p">[</span><span class="n">missing_puls</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_puls</span><span class="p">))]</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="c1"># split into different parts of the interrupted pattern</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>    <span class="n">obs_pattern_parts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">obs_without_missing</span><span class="p">,</span> <span class="n">missing_puls</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="n">obs_err_pattern_parts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">obs_err_without_missing</span><span class="p">,</span> <span class="n">missing_puls</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="c1"># partial function fixes all parameters of the function except for 1 that is iterated over in the multiprocessing pool.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    <span class="n">theory_pattern_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="n">theoretical_pattern_from_dfrow</span><span class="p">,</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="n">obs</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="n">obs_pattern_parts</span><span class="o">=</span><span class="n">obs_pattern_parts</span><span class="p">,</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="n">obs_err_pattern_parts</span><span class="o">=</span><span class="n">obs_err_pattern_parts</span><span class="p">,</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="n">which_observable</span><span class="o">=</span><span class="n">which_observable</span><span class="p">,</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="n">method_build_series</span><span class="o">=</span><span class="n">method_build_series</span><span class="p">,</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="n">pattern_starting_pulsation</span><span class="o">=</span><span class="n">pattern_starting_pulsation</span><span class="p">,</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="n">grid_parameters</span><span class="o">=</span><span class="n">grid_parameters</span><span class="p">,</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        <span class="n">asymptotic_object</span><span class="o">=</span><span class="n">asymptotic_object</span><span class="p">,</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="n">estimated_rotation</span><span class="o">=</span><span class="n">estimated_rotation</span><span class="p">,</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="n">plot_rotation_optimisation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>    <span class="p">)</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="c1"># Make the output file directory</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="c1"># Send the rows of the dataframe iteratively to a pool of processors to get the theoretical pattern for each model</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>    <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">nr_cpu</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="n">freqs</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">theory_pattern_func</span><span class="p">,</span> <span class="n">theory_dataframe</span><span class="o">.</span><span class="n">iterrows</span><span class="p">())</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="n">header_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">,</span> <span class="s2">&quot;rot_err&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">grid_parameters</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">obs_dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="s2">&quot;f_missing&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>                <span class="n">f</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">which_observable</span><span class="si">}</span><span class="s2">_missing&quot;</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>                <span class="n">f</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">which_observable</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>            <span class="n">header_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">header_parameters</span><span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;selected_puls_grid&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="c1"># %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="k">def</span> <span class="nf">theoretical_pattern_from_dfrow</span><span class="p">(</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>    <span class="n">summary_grid_row</span><span class="p">,</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>    <span class="n">obs</span><span class="p">,</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="n">obs_pattern_parts</span><span class="p">,</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    <span class="n">obs_err_pattern_parts</span><span class="p">,</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>    <span class="n">which_observable</span><span class="p">,</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>    <span class="n">method_build_series</span><span class="p">,</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>    <span class="n">pattern_starting_pulsation</span><span class="o">=</span><span class="p">[],</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>    <span class="n">asymptotic_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>    <span class="n">estimated_rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>    <span class="n">plot_rotation_optimisation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>    <span class="n">grid_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="p">):</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">    Extract model parameters and a theoretical pulsation pattern from a row of the dataFrame that contains all model parameters and pulsation frequencies.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">    Parameters</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">    ----------</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">    summary_grid_row: tuple, made of (int, pandas series)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        tuple returned from pandas.iterrows(), first tuple entry is the row index of the pandas dataFrame</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        second tuple entry is a pandas series, containing a row from the pandas dataFrame.</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        (This row holds model parameters and pulsation frequencies.)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">    obs: numpy array, dtype=float</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        Array of observed frequencies or periods. (Ordered increasing in frequency.)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">    obs_pattern_parts : list of numpy array, dtype=float</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        Holds a numpy array (with the observed frequencies or periods) per split off part</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">        of the observed pattern if it is interrupted.</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">        The list contains only one array if the observed pattern is uninterrupted.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">    obs_err_pattern_parts : list of numpy array, dtype=float</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">        The errors on the data in obs_pattern_parts.</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">    which_observable: string</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">        Which observables are used in the pattern building, options are &#39;frequency&#39; or &#39;period&#39;.</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">    method_build_series: string</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">        way to generate the theoretical frequency pattern from each model</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">        to match the observed pattern. Options are:</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">            provided-pulsation: build pattern from the provided pulsation    (function &#39;puls_series_from_given_puls&#39;)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">            highest-frequency: build pattern from the observed highest frequency    (function &#39;puls_series_from_given_puls&#39;)</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">            chisq-longest-sequence: build pattern based on longest, best matching sequence of pulsations    (function &#39;chisq_longest_sequence&#39;)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">    pattern_starting_pulsation: list of floats</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">        Only needed if you set method_build_series=provided-pulsation</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">        Value of the pulsation to start building the pattern from, one for each separated part of the pattern.</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">        The unit of this value needs to be the same as the observable set through which_observable.</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">    asymptotic_object: asymptotic (see &#39;gmode_rotation_scaling&#39;)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">        Object to calculate g-mode period spacing patterns in the asymptotic regime using the TAR.</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">    estimated_rotation: float</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        Estimation of the rotation rate of the star, used as initial value in the optimisation problem.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">    grid_parameters: list of string</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        List of the parameters in the theoretical grid.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">    Returns</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">    ----------</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">    list_out: list of float</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">        The input parameters and pulsation frequencies of the theoretical pattern</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">        (or periods, depending on &#39;which_observable&#39;).</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>    <span class="c1"># all keys containing n_pg (these are all the radial orders)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>    <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">summary_grid_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;n_pg&quot;</span><span class="p">))</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="c1"># array with radial orders</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>    <span class="n">orders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;n_pg&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">summary_grid_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;n_pg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>    <span class="n">orders</span> <span class="o">=</span> <span class="n">orders</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">freqs</span><span class="p">)]</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>    <span class="c1"># remove all entries that are NaN in the numpy array (for when the models have a different amount of computed modes)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>    <span class="n">freqs</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">freqs</span><span class="p">)]</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>    <span class="c1"># Check if pattern_starting_pulsation has enough entries to not truncate other parts in the zip function.</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_pattern_parts</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern_starting_pulsation</span><span class="p">):</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="k">if</span> <span class="n">method_build_series</span> <span class="o">==</span> <span class="s2">&quot;provided-pulsation&quot;</span><span class="p">:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>                    <span class="s2">&quot;Amount of pulsations specified to build patterns from is not equal to the amount of split-off parts in the pattern.&quot;</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>                <span class="p">)</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="c1"># Content of pattern_starting_pulsation doesn&#39;t matter if it&#39;s not used to build the pattern.</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>            <span class="c1"># We only care about the length if the method doesn&#39;t use specified pulsations.</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>            <span class="n">pattern_starting_pulsation</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_pattern_parts</span><span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>    <span class="c1"># In this case, rescaling nor optimisation will happen</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>    <span class="k">if</span> <span class="n">asymptotic_object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="n">residual</span> <span class="o">=</span> <span class="n">rescale_rotation_and_select_theoretical_pattern</span><span class="p">(</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>            <span class="kc">None</span><span class="p">,</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>            <span class="n">asymptotic_object</span><span class="p">,</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>            <span class="n">estimated_rotation</span><span class="p">,</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>            <span class="n">freqs</span><span class="p">,</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>            <span class="n">orders</span><span class="p">,</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>            <span class="n">obs</span><span class="p">,</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="n">obs_pattern_parts</span><span class="p">,</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>            <span class="n">obs_err_pattern_parts</span><span class="p">,</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="n">which_observable</span><span class="p">,</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>            <span class="n">method_build_series</span><span class="p">,</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>            <span class="n">pattern_starting_pulsation</span><span class="p">,</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="p">)</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="n">list_out</span> <span class="o">=</span> <span class="p">[</span><span class="n">estimated_rotation</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">grid_parameters</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="n">list_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary_grid_row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">parameter</span><span class="p">])</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="n">selected_pulsations</span> <span class="o">=</span> <span class="n">obs</span> <span class="o">+</span> <span class="n">residual</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="n">list_out</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">selected_pulsations</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="c1"># Optimise the rotation rate and get the pulsations at that rotation rate</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;rotation&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">estimated_rotation</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="c1"># Fit rotation to observed pattern with the default leastsq algorithm</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="n">optimise_rotation</span> <span class="o">=</span> <span class="n">Minimizer</span><span class="p">(</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="n">rescale_rotation_and_select_theoretical_pattern</span><span class="p">,</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">params</span><span class="p">,</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">fcn_args</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>                <span class="n">asymptotic_object</span><span class="p">,</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>                <span class="n">estimated_rotation</span><span class="p">,</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>                <span class="n">freqs</span><span class="p">,</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>                <span class="n">orders</span><span class="p">,</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>                <span class="n">obs</span><span class="p">,</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>                <span class="n">obs_pattern_parts</span><span class="p">,</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>                <span class="n">obs_err_pattern_parts</span><span class="p">,</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>                <span class="n">which_observable</span><span class="p">,</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>                <span class="n">method_build_series</span><span class="p">,</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>                <span class="n">pattern_starting_pulsation</span><span class="p">,</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="p">),</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="n">result_minimizer</span> <span class="o">=</span> <span class="n">optimise_rotation</span><span class="o">.</span><span class="n">minimize</span><span class="p">()</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="c1"># Search from second initial value, which is as separated from the first solution as the first initial guess.</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="n">search_second_initial_value</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">estimated_rotation</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;rotation&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">search_second_initial_value</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="n">optimise_rotation</span> <span class="o">=</span> <span class="n">Minimizer</span><span class="p">(</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="n">rescale_rotation_and_select_theoretical_pattern</span><span class="p">,</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="n">params</span><span class="p">,</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="n">fcn_args</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>                <span class="n">asymptotic_object</span><span class="p">,</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>                <span class="n">estimated_rotation</span><span class="p">,</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                <span class="n">freqs</span><span class="p">,</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                <span class="n">orders</span><span class="p">,</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>                <span class="n">obs</span><span class="p">,</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>                <span class="n">obs_pattern_parts</span><span class="p">,</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>                <span class="n">obs_err_pattern_parts</span><span class="p">,</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>                <span class="n">which_observable</span><span class="p">,</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>                <span class="n">method_build_series</span><span class="p">,</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>                <span class="n">pattern_starting_pulsation</span><span class="p">,</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="p">),</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="n">result_minimizer2</span> <span class="o">=</span> <span class="n">optimise_rotation</span><span class="o">.</span><span class="n">minimize</span><span class="p">()</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        <span class="c1"># Select the minimizer with the initial guess that resulted in the best fit.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="k">if</span> <span class="n">result_minimizer2</span><span class="o">.</span><span class="n">chisqr</span> <span class="o">&lt;</span> <span class="n">result_minimizer</span><span class="o">.</span><span class="n">chisqr</span><span class="p">:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>            <span class="n">result_minimizer</span> <span class="o">=</span> <span class="n">result_minimizer2</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="n">optimised_pulsations</span> <span class="o">=</span> <span class="n">result_minimizer</span><span class="o">.</span><span class="n">residual</span> <span class="o">+</span> <span class="n">obs</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="k">if</span> <span class="n">result_minimizer</span><span class="o">.</span><span class="n">message</span> <span class="o">!=</span> <span class="s2">&quot;Fit succeeded.&quot;</span><span class="p">:</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Fitting rotation did not succeed: </span><span class="si">{</span><span class="n">result_minimizer</span><span class="o">.</span><span class="n">message</span><span class="si">}</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="s2">                            for model </span><span class="si">{</span><span class="n">summary_grid_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">summary_grid_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;n_pg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;rot&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="si">}</span><span class="s2"> using method: </span><span class="si">{</span><span class="n">method_build_series</span><span class="si">}</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="s2">                            rotation found: </span><span class="si">{</span><span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rotation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> with error: </span><span class="si">{</span><span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rotation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>            <span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="k">if</span> <span class="n">plot_rotation_optimisation</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>            <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>            <span class="k">if</span> <span class="n">which_observable</span> <span class="o">==</span> <span class="s2">&quot;frequency&quot;</span><span class="p">:</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>                <span class="n">obsperiod</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">obs</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>                <span class="n">optimised_periods</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">optimised_pulsations</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>                <span class="n">obsperiod</span> <span class="o">=</span> <span class="n">obs</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>                <span class="n">optimised_periods</span> <span class="o">=</span> <span class="n">optimised_pulsations</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>            <span class="c1"># Recombine observational errors in one array</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>            <span class="n">combined_obs_err</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>            <span class="k">for</span> <span class="n">obs_err_part</span> <span class="ow">in</span> <span class="n">obs_err_pattern_parts</span><span class="p">:</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">combined_obs_err</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>                    <span class="n">combined_obs_err</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>                <span class="n">combined_obs_err</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">obs_err_part</span><span class="p">)</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="n">combined_obs_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">combined_obs_err</span><span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="n">spacings</span> <span class="o">=</span> <span class="n">generate_spacing_series</span><span class="p">(</span><span class="n">obsperiod</span><span class="p">,</span> <span class="n">combined_obs_err</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">obsperiod</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">spacings</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">spacings</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obsperiod</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">spacings</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>                <span class="n">optimised_periods</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                <span class="n">generate_spacing_series</span><span class="p">(</span><span class="n">optimised_periods</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>                <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>                <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;optimised&quot;</span><span class="p">,</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>            <span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>                <span class="mi">1</span> <span class="o">/</span> <span class="n">freqs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">generate_spacing_series</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">freqs</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;initial&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>            <span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">combined_obs_err</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">optimised_periods</span><span class="p">,</span> <span class="n">optimised_periods</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;optimised&quot;</span><span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">freqs</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">freqs</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;initial&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>                <span class="sa">f</span><span class="s2">&quot;initial omega = </span><span class="si">{</span><span class="n">estimated_rotation</span><span class="si">}</span><span class="s2">, optimised omega = </span><span class="si">{</span><span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rotation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>            <span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>                <span class="sa">f</span><span class="s2">&quot;initial omega = </span><span class="si">{</span><span class="n">estimated_rotation</span><span class="si">}</span><span class="s2">, optimised omega = </span><span class="si">{</span><span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rotation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>            <span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="c1"># Create list with rotation, its error, all the input parameters, and the optimised pulsations</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="n">list_out</span> <span class="o">=</span> <span class="p">[</span><span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">]</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">grid_parameters</span><span class="p">:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="n">list_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary_grid_row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">parameter</span><span class="p">])</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="n">list_out</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">optimised_pulsations</span><span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>    <span class="k">return</span> <span class="n">list_out</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="c1"># %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="k">def</span> <span class="nf">rescale_rotation_and_select_theoretical_pattern</span><span class="p">(</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>    <span class="n">params</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>    <span class="n">asymptotic_object</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>    <span class="n">estimated_rotation</span><span class="p">,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>    <span class="n">freqs_input</span><span class="p">,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>    <span class="n">orders</span><span class="p">,</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>    <span class="n">obs</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>    <span class="n">obs_pattern_parts</span><span class="p">,</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>    <span class="n">obs_err_pattern_parts</span><span class="p">,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>    <span class="n">which_observable</span><span class="p">,</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    <span class="n">method_build_series</span><span class="p">,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="n">pattern_starting_pulsation</span><span class="p">,</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="p">):</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">    If rotation is not optimised in the modelling, asymptotic_object should be set to &#39;None&#39; and</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">    this function will just select a theoretical pulsation pattern based on the specified method.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">    If asymptotic_object is supplied, the rotation will be optimised and this will be the</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">    objective function for the lmfit Minimizer class to minimise the output of.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">    Rescales the theoretical pulsation pattern using the asymptotic object from</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">    &#39;gmode_rotation_scaling&#39;, and selects a theoretical pulsation pattern based</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">    on the specified method.</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">    Parameters</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">    ----------</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">    params: Parameter (object of lmfit)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">        The parameter used to optimise the fit. In this case rotation in units of 1/day.</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">    asymptotic_object: asymptotic (see &#39;gmode_rotation_scaling&#39;)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">        Object to calculate g-mode period spacing patterns in the asymptotic regime using the TAR.</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">    estimated_rotation: float</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        Estimated rotation rate in units of 1/day. Used as initial value in the optimisation problem.</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">    freqs_input: numpy array, dtype=float</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">        Array of the frequencies as computed by GYRE, to be scaled to the optimal rotation rate.</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">    orders: numpy array, dtype=int</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">        Array with the radial orders of the theoretical input frequencies.</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">    obs: numpy array, dtype=float</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        Array of observed frequencies or periods. (Ordered increasing in frequency.)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">    obs_pattern_parts: list of numpy array, dtype=float</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">        Holds a numpy array with observed frequencies or periods</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">        per split off part of the observed pattern if it is interrupted.</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">        The list contains only one array if the observed pattern is uninterrupted.</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">    obs_err_pattern_parts: list of numpy array, dtype=float</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        The errors on obs_pattern_parts</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">    which_observable: string</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">        Which observables are used in the pattern building, options are &#39;frequency&#39; or &#39;period&#39;.</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">    method_build_series: string</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">        way to generate the theoretical frequency pattern from each model</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">        to match the observed pattern. Options are:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">            provided-pulsation: build pattern from the provided pulsation    (function &#39;puls_series_from_given_puls&#39;)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">            highest-frequency: build pattern from the observed highest frequency    (function &#39;puls_series_from_given_puls&#39;)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">            chisq-longest-sequence: build pattern based on longest, best matching sequence of pulsations    (function &#39;chisq_longest_sequence&#39;)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">    pattern_starting_pulsation: list of floats</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">        Only needed if you set method_build_series=provided-pulsation</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">        Value of the pulsation to start building the pattern from, one for each separated part of the pattern.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">        The unit of this value needs to be the same as the observable set through which_observable.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">    Returns</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">    ----------</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">    (output_pulsations - obs): numpy array, dtype=float</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">        Differences between the scaled pulsations and the observations.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">        The array to be minimised by the lmfit Minimizer if rotation is optimised.</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>    <span class="k">if</span> <span class="n">asymptotic_object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">valuesdict</span><span class="p">()</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="c1"># To avoid division by zero in scale_pattern</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="k">if</span> <span class="n">estimated_rotation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>            <span class="n">estimated_rotation</span> <span class="o">=</span> <span class="mf">1e-99</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="n">freqs</span> <span class="o">=</span> <span class="n">asymptotic_object</span><span class="o">.</span><span class="n">scale_pattern</span><span class="p">(</span><span class="n">freqs_input</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">estimated_rotation</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>        <span class="c1"># convert astropy quantities back to floats</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>        <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>        <span class="n">freqs</span> <span class="o">=</span> <span class="n">freqs_input</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>    <span class="n">periods</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">freqs</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>    <span class="n">output_pulsations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>    <span class="k">for</span> <span class="n">obs_part</span><span class="p">,</span> <span class="n">obs_err_part</span><span class="p">,</span> <span class="n">pattern_starting_pulsation_part</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>        <span class="n">obs_pattern_parts</span><span class="p">,</span> <span class="n">obs_err_pattern_parts</span><span class="p">,</span> <span class="n">pattern_starting_pulsation</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>    <span class="p">):</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="c1"># To indicate interruptions in the pattern</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_pulsations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>            <span class="n">output_pulsations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="k">if</span> <span class="n">which_observable</span> <span class="o">==</span> <span class="s2">&quot;frequency&quot;</span><span class="p">:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>            <span class="c1"># remove frequencies that were already chosen in a different, split-off part of the pattern</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_pulsations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>                <span class="c1"># If input is in increasing radial order (decreasing n_pg, since n_pg is negative for g-modes)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>                <span class="k">if</span> <span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>                    <span class="c1"># index -2 to get lowest, non-zero freq</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">freqs</span> <span class="o">&gt;=</span> <span class="n">output_pulsations</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>                <span class="c1"># If input is in decreasing radial order</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">freqs</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">output_pulsations</span><span class="p">)))</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>            <span class="n">theory_value</span> <span class="o">=</span> <span class="n">freqs</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>            <span class="n">obs_period</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">obs_part</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="n">obs_period_err</span> <span class="o">=</span> <span class="n">obs_err_part</span> <span class="o">/</span> <span class="n">obs_part</span><span class="o">**</span><span class="mi">2</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>            <span class="n">highest_obs_freq</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">obs_part</span><span class="p">)</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="k">elif</span> <span class="n">which_observable</span> <span class="o">==</span> <span class="s2">&quot;period&quot;</span><span class="p">:</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>            <span class="c1"># remove periods that were already chosen in a different, split-off part of the pattern</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_pulsations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>                <span class="c1"># If input is in increasing radial order (decreasing n_pg, since n_pg is negative for g-modes)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>                <span class="k">if</span> <span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">periods</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">output_pulsations</span><span class="p">)))</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>                <span class="c1"># If input is in decreasing radial order</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>                    <span class="c1"># index -2 to get lowest, non-zero period</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">periods</span> <span class="o">&gt;=</span> <span class="n">output_pulsations</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>            <span class="n">theory_value</span> <span class="o">=</span> <span class="n">periods</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>            <span class="n">obs_period</span> <span class="o">=</span> <span class="n">obs_part</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>            <span class="n">obs_period_err</span> <span class="o">=</span> <span class="n">obs_err_part</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>            <span class="c1"># highest frequency is lowest period</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>            <span class="n">highest_obs_freq</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">obs_part</span><span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown observable to fit&quot;</span><span class="p">))</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="k">if</span> <span class="n">method_build_series</span> <span class="o">==</span> <span class="s2">&quot;provided-pulsation&quot;</span><span class="p">:</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>            <span class="n">selected_theoretical_pulsations</span> <span class="o">=</span> <span class="n">puls_series_from_given_puls</span><span class="p">(</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>                <span class="n">theory_value</span><span class="p">,</span> <span class="n">obs_part</span><span class="p">,</span> <span class="n">pattern_starting_pulsation_part</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>            <span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="k">elif</span> <span class="n">method_build_series</span> <span class="o">==</span> <span class="s2">&quot;highest-frequency&quot;</span><span class="p">:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>            <span class="n">selected_theoretical_pulsations</span> <span class="o">=</span> <span class="n">puls_series_from_given_puls</span><span class="p">(</span><span class="n">theory_value</span><span class="p">,</span> <span class="n">obs_part</span><span class="p">,</span> <span class="n">highest_obs_freq</span><span class="p">)</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>        <span class="k">elif</span> <span class="n">method_build_series</span> <span class="o">==</span> <span class="s2">&quot;chisq-longest-sequence&quot;</span><span class="p">:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>            <span class="n">series_chi2</span><span class="p">,</span> <span class="n">final_theoretical_periods</span><span class="p">,</span> <span class="n">corresponding_orders</span> <span class="o">=</span> <span class="n">chisq_longest_sequence</span><span class="p">(</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>                <span class="n">periods</span><span class="p">,</span> <span class="n">orders</span><span class="p">,</span> <span class="n">obs_period</span><span class="p">,</span> <span class="n">obs_period_err</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>            <span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>            <span class="k">if</span> <span class="n">which_observable</span> <span class="o">==</span> <span class="s2">&quot;frequency&quot;</span><span class="p">:</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>                <span class="n">selected_theoretical_pulsations</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">final_theoretical_periods</span><span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="k">elif</span> <span class="n">which_observable</span> <span class="o">==</span> <span class="s2">&quot;period&quot;</span><span class="p">:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>                <span class="n">selected_theoretical_pulsations</span> <span class="o">=</span> <span class="n">final_theoretical_periods</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecognised method to build pulsation series: </span><span class="si">{</span><span class="n">method_build_series</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>        <span class="n">output_pulsations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">selected_theoretical_pulsations</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>    <span class="k">return</span> <span class="n">output_pulsations</span> <span class="o">-</span> <span class="n">obs</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="c1">################################################################################</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="k">def</span> <span class="nf">puls_series_from_given_puls</span><span class="p">(</span><span class="n">theory_in</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">obs_to_build_from</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">    Generate a theoretical pulsation pattern (can be in frequency or period) from the given observations.</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">    Build consecutively in radial order, starting from the theoretical value closest to the provided observational value.</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">    Parameters</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">    ----------</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">    theory_in: numpy array, dtype=float</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">        Array of theoretical frequencies or periods.</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">    obs: numpy array, dtype=float</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">        Array of observed frequencies or periods.</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">    obs_to_build_from: float</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">        observed frequency or period value to start building the pattern from.</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">    plot: boolean</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">        Make a period spacing diagram for the constructed series.</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">    Returns</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">    ----------</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">    theory_sequence: list of float</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">        The constructed theoretical frequency pattern</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>    <span class="c1"># get index of observation to build the series from</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>    <span class="n">nth_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obs</span> <span class="o">==</span> <span class="n">obs_to_build_from</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>    <span class="c1"># search theoretical freq closest to the given observed one</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>    <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theory_in</span> <span class="o">-</span> <span class="n">obs_to_build_from</span><span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>    <span class="c1"># get index of this theoretical frequency</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">diff</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>    <span class="c1"># Insert a value of -1 if observations miss a theoretical counterpart in the beginning</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>    <span class="n">theory_sequence</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">-</span> <span class="n">nth_obs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">index</span> <span class="o">-</span> <span class="n">nth_obs</span><span class="p">))):</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>            <span class="n">theory_sequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="n">theory_sequence</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">theory_in</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">-</span> <span class="n">nth_obs</span><span class="p">)])</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="n">theory_sequence</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">theory_in</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="n">nth_obs</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">-</span> <span class="n">nth_obs</span><span class="p">)])</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>    <span class="c1"># Insert a value of -1 if observations miss a theoretical counterpart at the end</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>    <span class="k">if</span> <span class="n">index</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">-</span> <span class="n">nth_obs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">theory_in</span><span class="p">):</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">index</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">-</span> <span class="n">nth_obs</span><span class="p">))</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">theory_in</span><span class="p">)):</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>            <span class="n">theory_sequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>    <span class="k">if</span> <span class="n">plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>        <span class="n">theory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theory_sequence</span><span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="n">obs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="n">obs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">86400</span><span class="p">,</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>            <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">theory</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>            <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">theory</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">86400</span><span class="p">,</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>            <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>            <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>            <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>            <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>        <span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>    <span class="k">return</span> <span class="n">theory_sequence</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a><span class="c1">################################################################################</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a><span class="k">def</span> <span class="nf">chisq_longest_sequence</span><span class="p">(</span><span class="n">theory_periods</span><span class="p">,</span> <span class="n">orders</span><span class="p">,</span> <span class="n">obs_periods</span><span class="p">,</span> <span class="n">obs_periods_errors</span><span class="p">):</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="sd">    Method to extract the theoretical pattern that best matches the observed one.</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="sd">    Match each observed mode period to its best matching theoretical counterpart,</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">    and adopt the longest sequence of consecutive modes found this way.</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a><span class="sd">    In case of multiple mode series with the same length, a final pattern selection</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="sd">    is made based on the best (chi-square) match between theory and observations.</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">    Parameters</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="sd">    ----------</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">    theory_periods : numpy array, dtype=float</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">        Theoretical periods and their radial orders.</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="sd">    orders : numpy array, dtype=int</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd">        Radial orders corresponding to the periods in theory_periods.</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="sd">    obs_periods: numpy array, dtype=float</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a><span class="sd">        Observational periods.</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a><span class="sd">    obs_periods_errors: numpy array, dtype=float</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">        The errors on obs_periods.</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="sd">    Returns</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a><span class="sd">    ----------</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">    series_chi2: float</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">        chi2 value of the selected theoretical frequencies.</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="sd">    final_theoretical_periods: numpy array, dtype=float</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">        The selected theoretical periods that best match the observed pattern.</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">    corresponding_orders: list of integers</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">        The radial orders of the returned theoretical periods.</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">theory_periods</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_periods</span><span class="p">):</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>        <span class="k">return</span> <span class="mf">1e16</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_periods</span><span class="p">))],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_periods</span><span class="p">))]</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>        <span class="c1"># Find the best matches per observed period</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>        <span class="n">pairs_orders</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_periods</span><span class="p">):</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>            <span class="c1">## Chi_squared array definition</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>            <span class="n">chi_sqrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>                <span class="p">[((</span><span class="n">period</span> <span class="o">-</span> <span class="n">theory_period</span><span class="p">)</span> <span class="o">/</span> <span class="n">obs_periods_errors</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">theory_period</span> <span class="ow">in</span> <span class="n">theory_periods</span><span class="p">]</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>            <span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>            <span class="c1">## Locate the theoretical frequency (and accompanying order) with the best chi2</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>            <span class="n">min_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">chi_sqrs</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">chi_sqrs</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>            <span class="n">best_match</span> <span class="o">=</span> <span class="n">theory_periods</span><span class="p">[</span><span class="n">min_ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>            <span class="n">best_order</span> <span class="o">=</span> <span class="n">orders</span><span class="p">[</span><span class="n">min_ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>            <span class="c1">## Toss everything together for bookkeeping</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>            <span class="n">pairs_orders</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">period</span><span class="p">,</span> <span class="n">best_match</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">best_order</span><span class="p">),</span> <span class="n">chi_sqrs</span><span class="p">[</span><span class="n">min_ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>        <span class="n">pairs_orders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pairs_orders</span><span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>        <span class="c1"># If input is in increasing radial order (decreasing n_pg, since n_pg is negative for g-modes)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>        <span class="k">if</span> <span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>            <span class="n">increase_or_decrease</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>        <span class="c1"># If input is in decreasing radial order</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>            <span class="n">increase_or_decrease</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>        <span class="n">sequences</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>        <span class="c1">## Go through all pairs of obs and theoretical frequencies and</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>        <span class="c1">## check if the next observed frequency has a corresponding theoretical frequency</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>        <span class="c1">## with the consecutive radial order.</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>        <span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>        <span class="n">lp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairs_orders</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">sett</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pairs_orders</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sett</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pairs_orders</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">increase_or_decrease</span><span class="p">:</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>                <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sett</span><span class="p">)</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>            <span class="c1"># If not consecutive radial order, save the current sequence and start a new one.</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>                <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sett</span><span class="p">)</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>                <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>                <span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>            <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="n">lp</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>                <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sett</span><span class="p">)</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>                <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>                <span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>        <span class="n">len_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">])</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>        <span class="n">longest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">len_list</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">len_list</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>        <span class="c1">## Test if there really is one longest sequence</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">longest</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>            <span class="n">lseq</span> <span class="o">=</span> <span class="n">sequences</span><span class="p">[</span><span class="n">longest</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>        <span class="c1">## if not, pick, of all the sequences with the same length, the best based on chi2</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>            <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sequences</span><span class="p">[</span><span class="n">ii</span><span class="p">][:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequences</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">longest</span><span class="p">]</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>            <span class="n">min_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">scores</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">scores</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>            <span class="n">lseq</span> <span class="o">=</span> <span class="n">sequences</span><span class="p">[</span><span class="n">longest</span><span class="p">[</span><span class="n">min_score</span><span class="p">]]</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>        <span class="n">obs_ordering_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obs_periods</span> <span class="o">==</span> <span class="n">lseq</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>        <span class="n">thr_ordering_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theory_periods</span> <span class="o">==</span> <span class="n">lseq</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>        <span class="n">ordered_theoretical_periods</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>        <span class="n">corresponding_orders</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>        <span class="n">thr_ind_start</span> <span class="o">=</span> <span class="n">thr_ordering_ind</span> <span class="o">-</span> <span class="n">obs_ordering_ind</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>        <span class="n">thr_ind_current</span> <span class="o">=</span> <span class="n">thr_ind_start</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">oper</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_periods</span><span class="p">):</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>            <span class="n">thr_ind_current</span> <span class="o">=</span> <span class="n">thr_ind_start</span> <span class="o">+</span> <span class="n">i</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>            <span class="k">if</span> <span class="n">thr_ind_current</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>                <span class="n">tper</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>                <span class="n">ordr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>            <span class="k">elif</span> <span class="n">thr_ind_current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theory_periods</span><span class="p">):</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>                <span class="n">tper</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>                <span class="n">ordr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>                <span class="n">tper</span> <span class="o">=</span> <span class="n">theory_periods</span><span class="p">[</span><span class="n">thr_ind_current</span><span class="p">]</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>                <span class="n">ordr</span> <span class="o">=</span> <span class="n">orders</span><span class="p">[</span><span class="n">thr_ind_current</span><span class="p">]</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>            <span class="n">ordered_theoretical_periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tper</span><span class="p">)</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>            <span class="n">corresponding_orders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ordr</span><span class="p">)</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>        <span class="n">final_theoretical_periods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ordered_theoretical_periods</span><span class="p">)</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>        <span class="n">obs_series</span><span class="p">,</span> <span class="n">obs_series_errors</span> <span class="o">=</span> <span class="n">generate_spacing_series</span><span class="p">(</span><span class="n">obs_periods</span><span class="p">,</span> <span class="n">obs_periods_errors</span><span class="p">)</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>        <span class="n">thr_series</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generate_spacing_series</span><span class="p">(</span><span class="n">final_theoretical_periods</span><span class="p">)</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>        <span class="n">obs_series</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs_series</span><span class="p">)</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>        <span class="n">obs_series_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs_series_errors</span><span class="p">)</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>        <span class="n">thr_series</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thr_series</span><span class="p">)</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>        <span class="n">series_chi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">obs_series</span> <span class="o">-</span> <span class="n">thr_series</span><span class="p">)</span> <span class="o">/</span> <span class="n">obs_series_errors</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_series</span><span class="p">)</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>        <span class="k">return</span> <span class="n">series_chi2</span><span class="p">,</span> <span class="n">final_theoretical_periods</span><span class="p">,</span> <span class="n">corresponding_orders</span>
</span></pre></div>


            </section>
                <section id="generate_spacing_series">
                            <input id="generate_spacing_series-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_spacing_series</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">periods</span>, </span><span class="param"><span class="n">errors</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="generate_spacing_series-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#generate_spacing_series"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="generate_spacing_series-21"><a href="#generate_spacing_series-21"><span class="linenos">21</span></a><span class="k">def</span> <span class="nf">generate_spacing_series</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="generate_spacing_series-22"><a href="#generate_spacing_series-22"><span class="linenos">22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="generate_spacing_series-23"><a href="#generate_spacing_series-23"><span class="linenos">23</span></a><span class="sd">    Generate the period spacing series (delta P = p_(n+1) - p_n )</span>
</span><span id="generate_spacing_series-24"><a href="#generate_spacing_series-24"><span class="linenos">24</span></a>
</span><span id="generate_spacing_series-25"><a href="#generate_spacing_series-25"><span class="linenos">25</span></a><span class="sd">    Parameters</span>
</span><span id="generate_spacing_series-26"><a href="#generate_spacing_series-26"><span class="linenos">26</span></a><span class="sd">    ----------</span>
</span><span id="generate_spacing_series-27"><a href="#generate_spacing_series-27"><span class="linenos">27</span></a><span class="sd">    periods: list of floats</span>
</span><span id="generate_spacing_series-28"><a href="#generate_spacing_series-28"><span class="linenos">28</span></a><span class="sd">        Periods in units of days</span>
</span><span id="generate_spacing_series-29"><a href="#generate_spacing_series-29"><span class="linenos">29</span></a><span class="sd">     errors (optional): list of floats</span>
</span><span id="generate_spacing_series-30"><a href="#generate_spacing_series-30"><span class="linenos">30</span></a><span class="sd">        Errors on periods in units of days</span>
</span><span id="generate_spacing_series-31"><a href="#generate_spacing_series-31"><span class="linenos">31</span></a><span class="sd">    Returns</span>
</span><span id="generate_spacing_series-32"><a href="#generate_spacing_series-32"><span class="linenos">32</span></a><span class="sd">    ----------</span>
</span><span id="generate_spacing_series-33"><a href="#generate_spacing_series-33"><span class="linenos">33</span></a><span class="sd">    observed_spacings, observed_spacings_errors: tuple of lists of floats</span>
</span><span id="generate_spacing_series-34"><a href="#generate_spacing_series-34"><span class="linenos">34</span></a><span class="sd">        period spacing series (delta P values) and its errors (if supplied) in units of seconds</span>
</span><span id="generate_spacing_series-35"><a href="#generate_spacing_series-35"><span class="linenos">35</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="generate_spacing_series-36"><a href="#generate_spacing_series-36"><span class="linenos">36</span></a>    <span class="n">spacings</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="generate_spacing_series-37"><a href="#generate_spacing_series-37"><span class="linenos">37</span></a>    <span class="k">if</span> <span class="n">errors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="generate_spacing_series-38"><a href="#generate_spacing_series-38"><span class="linenos">38</span></a>        <span class="n">spacings_errors</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="generate_spacing_series-39"><a href="#generate_spacing_series-39"><span class="linenos">39</span></a>        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">period_n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">periods</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="generate_spacing_series-40"><a href="#generate_spacing_series-40"><span class="linenos">40</span></a>            <span class="n">spacings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">period_n</span> <span class="o">-</span> <span class="n">periods</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">86400.0</span><span class="p">)</span>
</span><span id="generate_spacing_series-41"><a href="#generate_spacing_series-41"><span class="linenos">41</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="generate_spacing_series-42"><a href="#generate_spacing_series-42"><span class="linenos">42</span></a>        <span class="n">spacings_errors</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="generate_spacing_series-43"><a href="#generate_spacing_series-43"><span class="linenos">43</span></a>        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">period_n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">periods</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="generate_spacing_series-44"><a href="#generate_spacing_series-44"><span class="linenos">44</span></a>            <span class="n">spacings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">period_n</span> <span class="o">-</span> <span class="n">periods</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">86400.0</span><span class="p">)</span>
</span><span id="generate_spacing_series-45"><a href="#generate_spacing_series-45"><span class="linenos">45</span></a>            <span class="n">spacings_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">errors</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">86400.0</span><span class="p">)</span>
</span><span id="generate_spacing_series-46"><a href="#generate_spacing_series-46"><span class="linenos">46</span></a>
</span><span id="generate_spacing_series-47"><a href="#generate_spacing_series-47"><span class="linenos">47</span></a>    <span class="k">return</span> <span class="n">spacings</span><span class="p">,</span> <span class="n">spacings_errors</span>
</span></pre></div>


            <div class="docstring"><p>Generate the period spacing series (delta P = p_(n+1) - p_n )</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>periods</strong> (list of floats):
Periods in units of days
errors (optional): list of floats
   Errors on periods in units of days</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>observed_spacings, observed_spacings_errors</strong> (tuple of lists of floats):
period spacing series (delta P values) and its errors (if supplied) in units of seconds</li>
</ul>
</div>


                </section>
                <section id="construct_theoretical_puls_pattern">
                            <input id="construct_theoretical_puls_pattern-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">construct_theoretical_puls_pattern</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">pulsation_grid_file</span>,</span><span class="param">	<span class="n">observations_file</span>,</span><span class="param">	<span class="n">method_build_series</span>,</span><span class="param">	<span class="n">pattern_starting_pulsation</span><span class="o">=</span><span class="p">[]</span>,</span><span class="param">	<span class="n">which_observable</span><span class="o">=</span><span class="s1">&#39;period&#39;</span>,</span><span class="param">	<span class="n">output_file</span><span class="o">=</span><span class="s1">&#39;theoretical_frequency_patterns.hdf&#39;</span>,</span><span class="param">	<span class="n">asymptotic_object</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">estimated_rotation</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">grid_parameters</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">nr_cpu</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="construct_theoretical_puls_pattern-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#construct_theoretical_puls_pattern"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="construct_theoretical_puls_pattern-51"><a href="#construct_theoretical_puls_pattern-51"><span class="linenos"> 51</span></a><span class="k">def</span> <span class="nf">construct_theoretical_puls_pattern</span><span class="p">(</span>
</span><span id="construct_theoretical_puls_pattern-52"><a href="#construct_theoretical_puls_pattern-52"><span class="linenos"> 52</span></a>    <span class="n">pulsation_grid_file</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-53"><a href="#construct_theoretical_puls_pattern-53"><span class="linenos"> 53</span></a>    <span class="n">observations_file</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-54"><a href="#construct_theoretical_puls_pattern-54"><span class="linenos"> 54</span></a>    <span class="n">method_build_series</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-55"><a href="#construct_theoretical_puls_pattern-55"><span class="linenos"> 55</span></a>    <span class="n">pattern_starting_pulsation</span><span class="o">=</span><span class="p">[],</span>
</span><span id="construct_theoretical_puls_pattern-56"><a href="#construct_theoretical_puls_pattern-56"><span class="linenos"> 56</span></a>    <span class="n">which_observable</span><span class="o">=</span><span class="s2">&quot;period&quot;</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-57"><a href="#construct_theoretical_puls_pattern-57"><span class="linenos"> 57</span></a>    <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;theoretical_frequency_patterns.hdf&quot;</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-58"><a href="#construct_theoretical_puls_pattern-58"><span class="linenos"> 58</span></a>    <span class="n">asymptotic_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-59"><a href="#construct_theoretical_puls_pattern-59"><span class="linenos"> 59</span></a>    <span class="n">estimated_rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-60"><a href="#construct_theoretical_puls_pattern-60"><span class="linenos"> 60</span></a>    <span class="n">grid_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-61"><a href="#construct_theoretical_puls_pattern-61"><span class="linenos"> 61</span></a>    <span class="n">nr_cpu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-62"><a href="#construct_theoretical_puls_pattern-62"><span class="linenos"> 62</span></a><span class="p">):</span>
</span><span id="construct_theoretical_puls_pattern-63"><a href="#construct_theoretical_puls_pattern-63"><span class="linenos"> 63</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="construct_theoretical_puls_pattern-64"><a href="#construct_theoretical_puls_pattern-64"><span class="linenos"> 64</span></a><span class="sd">    Construct the theoretical frequency pattern for each model in the grid, which correspond to the observed pattern.</span>
</span><span id="construct_theoretical_puls_pattern-65"><a href="#construct_theoretical_puls_pattern-65"><span class="linenos"> 65</span></a><span class="sd">    (Each theoretical model is a row in &#39;pulsation_grid_file&#39;.)</span>
</span><span id="construct_theoretical_puls_pattern-66"><a href="#construct_theoretical_puls_pattern-66"><span class="linenos"> 66</span></a><span class="sd">    The rotation rate will be scaled and optimised for each theoretical pattern individually.</span>
</span><span id="construct_theoretical_puls_pattern-67"><a href="#construct_theoretical_puls_pattern-67"><span class="linenos"> 67</span></a><span class="sd">    This optimisation will not be performed if asymptotic_object=None.</span>
</span><span id="construct_theoretical_puls_pattern-68"><a href="#construct_theoretical_puls_pattern-68"><span class="linenos"> 68</span></a>
</span><span id="construct_theoretical_puls_pattern-69"><a href="#construct_theoretical_puls_pattern-69"><span class="linenos"> 69</span></a><span class="sd">    Parameters</span>
</span><span id="construct_theoretical_puls_pattern-70"><a href="#construct_theoretical_puls_pattern-70"><span class="linenos"> 70</span></a><span class="sd">    ----------</span>
</span><span id="construct_theoretical_puls_pattern-71"><a href="#construct_theoretical_puls_pattern-71"><span class="linenos"> 71</span></a><span class="sd">    pulsation_grid_file: string</span>
</span><span id="construct_theoretical_puls_pattern-72"><a href="#construct_theoretical_puls_pattern-72"><span class="linenos"> 72</span></a><span class="sd">        path to file containing input parameters of the models, and the pulsation frequencies of those models</span>
</span><span id="construct_theoretical_puls_pattern-73"><a href="#construct_theoretical_puls_pattern-73"><span class="linenos"> 73</span></a><span class="sd">        (as generated by function &#39;extract_frequency_grid&#39; in &#39;functions_for_gyre&#39;).</span>
</span><span id="construct_theoretical_puls_pattern-74"><a href="#construct_theoretical_puls_pattern-74"><span class="linenos"> 74</span></a><span class="sd">    observations_file: string</span>
</span><span id="construct_theoretical_puls_pattern-75"><a href="#construct_theoretical_puls_pattern-75"><span class="linenos"> 75</span></a><span class="sd">        Path to the tsv file with observations, with a column for each observable and each set of errors.</span>
</span><span id="construct_theoretical_puls_pattern-76"><a href="#construct_theoretical_puls_pattern-76"><span class="linenos"> 76</span></a><span class="sd">        Column names specify the observable, and &quot;_err&quot; suffix denotes that it&#39;s the error.</span>
</span><span id="construct_theoretical_puls_pattern-77"><a href="#construct_theoretical_puls_pattern-77"><span class="linenos"> 77</span></a><span class="sd">    method_build_series: string</span>
</span><span id="construct_theoretical_puls_pattern-78"><a href="#construct_theoretical_puls_pattern-78"><span class="linenos"> 78</span></a><span class="sd">        way to generate the theoretical frequency pattern from each model to match the observed pattern. Options are:</span>
</span><span id="construct_theoretical_puls_pattern-79"><a href="#construct_theoretical_puls_pattern-79"><span class="linenos"> 79</span></a><span class="sd">            provided-pulsation: build pattern from the provided pulsation    (function &#39;puls_series_from_given_puls&#39;)</span>
</span><span id="construct_theoretical_puls_pattern-80"><a href="#construct_theoretical_puls_pattern-80"><span class="linenos"> 80</span></a><span class="sd">            highest-frequency: build pattern from the observed highest frequency    (function &#39;puls_series_from_given_puls&#39;)</span>
</span><span id="construct_theoretical_puls_pattern-81"><a href="#construct_theoretical_puls_pattern-81"><span class="linenos"> 81</span></a><span class="sd">            chisq-longest-sequence: build pattern based on longest, best matching sequence of pulsations (function &#39;chisq_longest_sequence&#39;)</span>
</span><span id="construct_theoretical_puls_pattern-82"><a href="#construct_theoretical_puls_pattern-82"><span class="linenos"> 82</span></a><span class="sd">    pattern_starting_pulsation: list of floats</span>
</span><span id="construct_theoretical_puls_pattern-83"><a href="#construct_theoretical_puls_pattern-83"><span class="linenos"> 83</span></a><span class="sd">        Only needed if you set method_build_series=provided-pulsation</span>
</span><span id="construct_theoretical_puls_pattern-84"><a href="#construct_theoretical_puls_pattern-84"><span class="linenos"> 84</span></a><span class="sd">        Value of the pulsation to start building the pattern from, one for each separated part of the pattern.</span>
</span><span id="construct_theoretical_puls_pattern-85"><a href="#construct_theoretical_puls_pattern-85"><span class="linenos"> 85</span></a><span class="sd">        The unit of this value needs to be the same as the observable set through which_observable.</span>
</span><span id="construct_theoretical_puls_pattern-86"><a href="#construct_theoretical_puls_pattern-86"><span class="linenos"> 86</span></a><span class="sd">    which_observable: string</span>
</span><span id="construct_theoretical_puls_pattern-87"><a href="#construct_theoretical_puls_pattern-87"><span class="linenos"> 87</span></a><span class="sd">        Observable used in the theoretical pattern construction, options are &#39;frequency&#39; or &#39;period&#39;.</span>
</span><span id="construct_theoretical_puls_pattern-88"><a href="#construct_theoretical_puls_pattern-88"><span class="linenos"> 88</span></a><span class="sd">    output_file: string</span>
</span><span id="construct_theoretical_puls_pattern-89"><a href="#construct_theoretical_puls_pattern-89"><span class="linenos"> 89</span></a><span class="sd">        Name (can include a path) for the file containing all the pulsation frequencies of the grid.</span>
</span><span id="construct_theoretical_puls_pattern-90"><a href="#construct_theoretical_puls_pattern-90"><span class="linenos"> 90</span></a><span class="sd">    asymptotic_object: asymptotic (see &#39;gmode_rotation_scaling&#39;)</span>
</span><span id="construct_theoretical_puls_pattern-91"><a href="#construct_theoretical_puls_pattern-91"><span class="linenos"> 91</span></a><span class="sd">        Object to calculate g-mode period spacing patterns in the asymptotic regime using the TAR.</span>
</span><span id="construct_theoretical_puls_pattern-92"><a href="#construct_theoretical_puls_pattern-92"><span class="linenos"> 92</span></a><span class="sd">    estimated_rotation: float</span>
</span><span id="construct_theoretical_puls_pattern-93"><a href="#construct_theoretical_puls_pattern-93"><span class="linenos"> 93</span></a><span class="sd">        Estimation of the rotation rate of the star, used as initial value in the optimisation problem.</span>
</span><span id="construct_theoretical_puls_pattern-94"><a href="#construct_theoretical_puls_pattern-94"><span class="linenos"> 94</span></a><span class="sd">    grid_parameters: list of string</span>
</span><span id="construct_theoretical_puls_pattern-95"><a href="#construct_theoretical_puls_pattern-95"><span class="linenos"> 95</span></a><span class="sd">        List of the parameters in the theoretical grid.</span>
</span><span id="construct_theoretical_puls_pattern-96"><a href="#construct_theoretical_puls_pattern-96"><span class="linenos"> 96</span></a><span class="sd">    nr_cpu: int</span>
</span><span id="construct_theoretical_puls_pattern-97"><a href="#construct_theoretical_puls_pattern-97"><span class="linenos"> 97</span></a><span class="sd">        Number of worker processes to use in multiprocessing. The default &#39;None&#39; will use the number returned by os.cpu_count().</span>
</span><span id="construct_theoretical_puls_pattern-98"><a href="#construct_theoretical_puls_pattern-98"><span class="linenos"> 98</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="construct_theoretical_puls_pattern-99"><a href="#construct_theoretical_puls_pattern-99"><span class="linenos"> 99</span></a>    <span class="c1"># Read in the files with observed and theoretical frequencies as pandas DataFrames</span>
</span><span id="construct_theoretical_puls_pattern-100"><a href="#construct_theoretical_puls_pattern-100"><span class="linenos">100</span></a>    <span class="n">obs_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">observations_file</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="construct_theoretical_puls_pattern-101"><a href="#construct_theoretical_puls_pattern-101"><span class="linenos">101</span></a>    <span class="n">theory_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">pulsation_grid_file</span><span class="p">)</span>
</span><span id="construct_theoretical_puls_pattern-102"><a href="#construct_theoretical_puls_pattern-102"><span class="linenos">102</span></a>
</span><span id="construct_theoretical_puls_pattern-103"><a href="#construct_theoretical_puls_pattern-103"><span class="linenos">103</span></a>    <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="n">which_observable</span><span class="p">])</span>
</span><span id="construct_theoretical_puls_pattern-104"><a href="#construct_theoretical_puls_pattern-104"><span class="linenos">104</span></a>    <span class="n">obs_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">which_observable</span><span class="si">}</span><span class="s2">_err&quot;</span><span class="p">])</span>
</span><span id="construct_theoretical_puls_pattern-105"><a href="#construct_theoretical_puls_pattern-105"><span class="linenos">105</span></a>
</span><span id="construct_theoretical_puls_pattern-106"><a href="#construct_theoretical_puls_pattern-106"><span class="linenos">106</span></a>    <span class="c1"># if frequency was filled in as 0, it indicates an interruption in the pattern</span>
</span><span id="construct_theoretical_puls_pattern-107"><a href="#construct_theoretical_puls_pattern-107"><span class="linenos">107</span></a>    <span class="n">missing_puls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="construct_theoretical_puls_pattern-108"><a href="#construct_theoretical_puls_pattern-108"><span class="linenos">108</span></a>    <span class="c1"># remove values indicating interruptions in the pattern</span>
</span><span id="construct_theoretical_puls_pattern-109"><a href="#construct_theoretical_puls_pattern-109"><span class="linenos">109</span></a>    <span class="n">obs_without_missing</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="n">obs</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="construct_theoretical_puls_pattern-110"><a href="#construct_theoretical_puls_pattern-110"><span class="linenos">110</span></a>    <span class="c1"># remove values indicating interruptions in the pattern</span>
</span><span id="construct_theoretical_puls_pattern-111"><a href="#construct_theoretical_puls_pattern-111"><span class="linenos">111</span></a>    <span class="n">obs_err_without_missing</span> <span class="o">=</span> <span class="n">obs_err</span><span class="p">[</span><span class="n">obs_err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="construct_theoretical_puls_pattern-112"><a href="#construct_theoretical_puls_pattern-112"><span class="linenos">112</span></a>    <span class="c1"># Adjust indices for removed 0-values of missing frequencies</span>
</span><span id="construct_theoretical_puls_pattern-113"><a href="#construct_theoretical_puls_pattern-113"><span class="linenos">113</span></a>    <span class="n">missing_puls</span> <span class="o">=</span> <span class="p">[</span><span class="n">missing_puls</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_puls</span><span class="p">))]</span>
</span><span id="construct_theoretical_puls_pattern-114"><a href="#construct_theoretical_puls_pattern-114"><span class="linenos">114</span></a>
</span><span id="construct_theoretical_puls_pattern-115"><a href="#construct_theoretical_puls_pattern-115"><span class="linenos">115</span></a>    <span class="c1"># split into different parts of the interrupted pattern</span>
</span><span id="construct_theoretical_puls_pattern-116"><a href="#construct_theoretical_puls_pattern-116"><span class="linenos">116</span></a>    <span class="n">obs_pattern_parts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">obs_without_missing</span><span class="p">,</span> <span class="n">missing_puls</span><span class="p">)</span>
</span><span id="construct_theoretical_puls_pattern-117"><a href="#construct_theoretical_puls_pattern-117"><span class="linenos">117</span></a>    <span class="n">obs_err_pattern_parts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">obs_err_without_missing</span><span class="p">,</span> <span class="n">missing_puls</span><span class="p">)</span>
</span><span id="construct_theoretical_puls_pattern-118"><a href="#construct_theoretical_puls_pattern-118"><span class="linenos">118</span></a>
</span><span id="construct_theoretical_puls_pattern-119"><a href="#construct_theoretical_puls_pattern-119"><span class="linenos">119</span></a>    <span class="c1"># partial function fixes all parameters of the function except for 1 that is iterated over in the multiprocessing pool.</span>
</span><span id="construct_theoretical_puls_pattern-120"><a href="#construct_theoretical_puls_pattern-120"><span class="linenos">120</span></a>    <span class="n">theory_pattern_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
</span><span id="construct_theoretical_puls_pattern-121"><a href="#construct_theoretical_puls_pattern-121"><span class="linenos">121</span></a>        <span class="n">theoretical_pattern_from_dfrow</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-122"><a href="#construct_theoretical_puls_pattern-122"><span class="linenos">122</span></a>        <span class="n">obs</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-123"><a href="#construct_theoretical_puls_pattern-123"><span class="linenos">123</span></a>        <span class="n">obs_pattern_parts</span><span class="o">=</span><span class="n">obs_pattern_parts</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-124"><a href="#construct_theoretical_puls_pattern-124"><span class="linenos">124</span></a>        <span class="n">obs_err_pattern_parts</span><span class="o">=</span><span class="n">obs_err_pattern_parts</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-125"><a href="#construct_theoretical_puls_pattern-125"><span class="linenos">125</span></a>        <span class="n">which_observable</span><span class="o">=</span><span class="n">which_observable</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-126"><a href="#construct_theoretical_puls_pattern-126"><span class="linenos">126</span></a>        <span class="n">method_build_series</span><span class="o">=</span><span class="n">method_build_series</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-127"><a href="#construct_theoretical_puls_pattern-127"><span class="linenos">127</span></a>        <span class="n">pattern_starting_pulsation</span><span class="o">=</span><span class="n">pattern_starting_pulsation</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-128"><a href="#construct_theoretical_puls_pattern-128"><span class="linenos">128</span></a>        <span class="n">grid_parameters</span><span class="o">=</span><span class="n">grid_parameters</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-129"><a href="#construct_theoretical_puls_pattern-129"><span class="linenos">129</span></a>        <span class="n">asymptotic_object</span><span class="o">=</span><span class="n">asymptotic_object</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-130"><a href="#construct_theoretical_puls_pattern-130"><span class="linenos">130</span></a>        <span class="n">estimated_rotation</span><span class="o">=</span><span class="n">estimated_rotation</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-131"><a href="#construct_theoretical_puls_pattern-131"><span class="linenos">131</span></a>        <span class="n">plot_rotation_optimisation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="construct_theoretical_puls_pattern-132"><a href="#construct_theoretical_puls_pattern-132"><span class="linenos">132</span></a>    <span class="p">)</span>
</span><span id="construct_theoretical_puls_pattern-133"><a href="#construct_theoretical_puls_pattern-133"><span class="linenos">133</span></a>
</span><span id="construct_theoretical_puls_pattern-134"><a href="#construct_theoretical_puls_pattern-134"><span class="linenos">134</span></a>    <span class="c1"># Make the output file directory</span>
</span><span id="construct_theoretical_puls_pattern-135"><a href="#construct_theoretical_puls_pattern-135"><span class="linenos">135</span></a>    <span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="construct_theoretical_puls_pattern-136"><a href="#construct_theoretical_puls_pattern-136"><span class="linenos">136</span></a>    <span class="c1"># Send the rows of the dataframe iteratively to a pool of processors to get the theoretical pattern for each model</span>
</span><span id="construct_theoretical_puls_pattern-137"><a href="#construct_theoretical_puls_pattern-137"><span class="linenos">137</span></a>    <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">nr_cpu</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="construct_theoretical_puls_pattern-138"><a href="#construct_theoretical_puls_pattern-138"><span class="linenos">138</span></a>        <span class="n">freqs</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">theory_pattern_func</span><span class="p">,</span> <span class="n">theory_dataframe</span><span class="o">.</span><span class="n">iterrows</span><span class="p">())</span>
</span><span id="construct_theoretical_puls_pattern-139"><a href="#construct_theoretical_puls_pattern-139"><span class="linenos">139</span></a>        <span class="n">header_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">,</span> <span class="s2">&quot;rot_err&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">grid_parameters</span>
</span><span id="construct_theoretical_puls_pattern-140"><a href="#construct_theoretical_puls_pattern-140"><span class="linenos">140</span></a>
</span><span id="construct_theoretical_puls_pattern-141"><a href="#construct_theoretical_puls_pattern-141"><span class="linenos">141</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">obs_dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="construct_theoretical_puls_pattern-142"><a href="#construct_theoretical_puls_pattern-142"><span class="linenos">142</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="s2">&quot;f_missing&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="construct_theoretical_puls_pattern-143"><a href="#construct_theoretical_puls_pattern-143"><span class="linenos">143</span></a>                <span class="n">f</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">which_observable</span><span class="si">}</span><span class="s2">_missing&quot;</span>
</span><span id="construct_theoretical_puls_pattern-144"><a href="#construct_theoretical_puls_pattern-144"><span class="linenos">144</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="construct_theoretical_puls_pattern-145"><a href="#construct_theoretical_puls_pattern-145"><span class="linenos">145</span></a>                <span class="n">f</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">which_observable</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="construct_theoretical_puls_pattern-146"><a href="#construct_theoretical_puls_pattern-146"><span class="linenos">146</span></a>            <span class="n">header_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="construct_theoretical_puls_pattern-147"><a href="#construct_theoretical_puls_pattern-147"><span class="linenos">147</span></a>
</span><span id="construct_theoretical_puls_pattern-148"><a href="#construct_theoretical_puls_pattern-148"><span class="linenos">148</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="construct_theoretical_puls_pattern-149"><a href="#construct_theoretical_puls_pattern-149"><span class="linenos">149</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
</span><span id="construct_theoretical_puls_pattern-150"><a href="#construct_theoretical_puls_pattern-150"><span class="linenos">150</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="construct_theoretical_puls_pattern-151"><a href="#construct_theoretical_puls_pattern-151"><span class="linenos">151</span></a>
</span><span id="construct_theoretical_puls_pattern-152"><a href="#construct_theoretical_puls_pattern-152"><span class="linenos">152</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">header_parameters</span><span class="p">)</span>
</span><span id="construct_theoretical_puls_pattern-153"><a href="#construct_theoretical_puls_pattern-153"><span class="linenos">153</span></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;selected_puls_grid&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Construct the theoretical frequency pattern for each model in the grid, which correspond to the observed pattern.
(Each theoretical model is a row in 'pulsation_grid_file'.)
The rotation rate will be scaled and optimised for each theoretical pattern individually.
This optimisation will not be performed if asymptotic_object=None.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>pulsation_grid_file</strong> (string):
path to file containing input parameters of the models, and the pulsation frequencies of those models
(as generated by function 'extract_frequency_grid' in 'functions_for_gyre').</li>
<li><strong>observations_file</strong> (string):
Path to the tsv file with observations, with a column for each observable and each set of errors.
Column names specify the observable, and "_err" suffix denotes that it's the error.</li>
<li><strong>method_build_series</strong> (string):
way to generate the theoretical frequency pattern from each model to match the observed pattern. Options are:
    provided-pulsation: build pattern from the provided pulsation    (function 'puls_series_from_given_puls')
    highest-frequency: build pattern from the observed highest frequency    (function 'puls_series_from_given_puls')
    chisq-longest-sequence: build pattern based on longest, best matching sequence of pulsations (function 'chisq_longest_sequence')</li>
<li><strong>pattern_starting_pulsation</strong> (list of floats):
Only needed if you set method_build_series=provided-pulsation
Value of the pulsation to start building the pattern from, one for each separated part of the pattern.
The unit of this value needs to be the same as the observable set through which_observable.</li>
<li><strong>which_observable</strong> (string):
Observable used in the theoretical pattern construction, options are 'frequency' or 'period'.</li>
<li><strong>output_file</strong> (string):
Name (can include a path) for the file containing all the pulsation frequencies of the grid.</li>
<li><strong>asymptotic_object</strong> (asymptotic (see 'gmode_rotation_scaling')):
Object to calculate g-mode period spacing patterns in the asymptotic regime using the TAR.</li>
<li><strong>estimated_rotation</strong> (float):
Estimation of the rotation rate of the star, used as initial value in the optimisation problem.</li>
<li><strong>grid_parameters</strong> (list of string):
List of the parameters in the theoretical grid.</li>
<li><strong>nr_cpu</strong> (int):
Number of worker processes to use in multiprocessing. The default 'None' will use the number returned by os.cpu_count().</li>
</ul>
</div>


                </section>
                <section id="theoretical_pattern_from_dfrow">
                            <input id="theoretical_pattern_from_dfrow-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">theoretical_pattern_from_dfrow</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">summary_grid_row</span>,</span><span class="param">	<span class="n">obs</span>,</span><span class="param">	<span class="n">obs_pattern_parts</span>,</span><span class="param">	<span class="n">obs_err_pattern_parts</span>,</span><span class="param">	<span class="n">which_observable</span>,</span><span class="param">	<span class="n">method_build_series</span>,</span><span class="param">	<span class="n">pattern_starting_pulsation</span><span class="o">=</span><span class="p">[]</span>,</span><span class="param">	<span class="n">asymptotic_object</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">estimated_rotation</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">plot_rotation_optimisation</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">grid_parameters</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="theoretical_pattern_from_dfrow-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#theoretical_pattern_from_dfrow"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="theoretical_pattern_from_dfrow-157"><a href="#theoretical_pattern_from_dfrow-157"><span class="linenos">157</span></a><span class="k">def</span> <span class="nf">theoretical_pattern_from_dfrow</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-158"><a href="#theoretical_pattern_from_dfrow-158"><span class="linenos">158</span></a>    <span class="n">summary_grid_row</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-159"><a href="#theoretical_pattern_from_dfrow-159"><span class="linenos">159</span></a>    <span class="n">obs</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-160"><a href="#theoretical_pattern_from_dfrow-160"><span class="linenos">160</span></a>    <span class="n">obs_pattern_parts</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-161"><a href="#theoretical_pattern_from_dfrow-161"><span class="linenos">161</span></a>    <span class="n">obs_err_pattern_parts</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-162"><a href="#theoretical_pattern_from_dfrow-162"><span class="linenos">162</span></a>    <span class="n">which_observable</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-163"><a href="#theoretical_pattern_from_dfrow-163"><span class="linenos">163</span></a>    <span class="n">method_build_series</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-164"><a href="#theoretical_pattern_from_dfrow-164"><span class="linenos">164</span></a>    <span class="n">pattern_starting_pulsation</span><span class="o">=</span><span class="p">[],</span>
</span><span id="theoretical_pattern_from_dfrow-165"><a href="#theoretical_pattern_from_dfrow-165"><span class="linenos">165</span></a>    <span class="n">asymptotic_object</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-166"><a href="#theoretical_pattern_from_dfrow-166"><span class="linenos">166</span></a>    <span class="n">estimated_rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-167"><a href="#theoretical_pattern_from_dfrow-167"><span class="linenos">167</span></a>    <span class="n">plot_rotation_optimisation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-168"><a href="#theoretical_pattern_from_dfrow-168"><span class="linenos">168</span></a>    <span class="n">grid_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-169"><a href="#theoretical_pattern_from_dfrow-169"><span class="linenos">169</span></a><span class="p">):</span>
</span><span id="theoretical_pattern_from_dfrow-170"><a href="#theoretical_pattern_from_dfrow-170"><span class="linenos">170</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="theoretical_pattern_from_dfrow-171"><a href="#theoretical_pattern_from_dfrow-171"><span class="linenos">171</span></a><span class="sd">    Extract model parameters and a theoretical pulsation pattern from a row of the dataFrame that contains all model parameters and pulsation frequencies.</span>
</span><span id="theoretical_pattern_from_dfrow-172"><a href="#theoretical_pattern_from_dfrow-172"><span class="linenos">172</span></a>
</span><span id="theoretical_pattern_from_dfrow-173"><a href="#theoretical_pattern_from_dfrow-173"><span class="linenos">173</span></a><span class="sd">    Parameters</span>
</span><span id="theoretical_pattern_from_dfrow-174"><a href="#theoretical_pattern_from_dfrow-174"><span class="linenos">174</span></a><span class="sd">    ----------</span>
</span><span id="theoretical_pattern_from_dfrow-175"><a href="#theoretical_pattern_from_dfrow-175"><span class="linenos">175</span></a><span class="sd">    summary_grid_row: tuple, made of (int, pandas series)</span>
</span><span id="theoretical_pattern_from_dfrow-176"><a href="#theoretical_pattern_from_dfrow-176"><span class="linenos">176</span></a><span class="sd">        tuple returned from pandas.iterrows(), first tuple entry is the row index of the pandas dataFrame</span>
</span><span id="theoretical_pattern_from_dfrow-177"><a href="#theoretical_pattern_from_dfrow-177"><span class="linenos">177</span></a><span class="sd">        second tuple entry is a pandas series, containing a row from the pandas dataFrame.</span>
</span><span id="theoretical_pattern_from_dfrow-178"><a href="#theoretical_pattern_from_dfrow-178"><span class="linenos">178</span></a><span class="sd">        (This row holds model parameters and pulsation frequencies.)</span>
</span><span id="theoretical_pattern_from_dfrow-179"><a href="#theoretical_pattern_from_dfrow-179"><span class="linenos">179</span></a><span class="sd">    obs: numpy array, dtype=float</span>
</span><span id="theoretical_pattern_from_dfrow-180"><a href="#theoretical_pattern_from_dfrow-180"><span class="linenos">180</span></a><span class="sd">        Array of observed frequencies or periods. (Ordered increasing in frequency.)</span>
</span><span id="theoretical_pattern_from_dfrow-181"><a href="#theoretical_pattern_from_dfrow-181"><span class="linenos">181</span></a><span class="sd">    obs_pattern_parts : list of numpy array, dtype=float</span>
</span><span id="theoretical_pattern_from_dfrow-182"><a href="#theoretical_pattern_from_dfrow-182"><span class="linenos">182</span></a><span class="sd">        Holds a numpy array (with the observed frequencies or periods) per split off part</span>
</span><span id="theoretical_pattern_from_dfrow-183"><a href="#theoretical_pattern_from_dfrow-183"><span class="linenos">183</span></a><span class="sd">        of the observed pattern if it is interrupted.</span>
</span><span id="theoretical_pattern_from_dfrow-184"><a href="#theoretical_pattern_from_dfrow-184"><span class="linenos">184</span></a><span class="sd">        The list contains only one array if the observed pattern is uninterrupted.</span>
</span><span id="theoretical_pattern_from_dfrow-185"><a href="#theoretical_pattern_from_dfrow-185"><span class="linenos">185</span></a><span class="sd">    obs_err_pattern_parts : list of numpy array, dtype=float</span>
</span><span id="theoretical_pattern_from_dfrow-186"><a href="#theoretical_pattern_from_dfrow-186"><span class="linenos">186</span></a><span class="sd">        The errors on the data in obs_pattern_parts.</span>
</span><span id="theoretical_pattern_from_dfrow-187"><a href="#theoretical_pattern_from_dfrow-187"><span class="linenos">187</span></a><span class="sd">    which_observable: string</span>
</span><span id="theoretical_pattern_from_dfrow-188"><a href="#theoretical_pattern_from_dfrow-188"><span class="linenos">188</span></a><span class="sd">        Which observables are used in the pattern building, options are &#39;frequency&#39; or &#39;period&#39;.</span>
</span><span id="theoretical_pattern_from_dfrow-189"><a href="#theoretical_pattern_from_dfrow-189"><span class="linenos">189</span></a><span class="sd">    method_build_series: string</span>
</span><span id="theoretical_pattern_from_dfrow-190"><a href="#theoretical_pattern_from_dfrow-190"><span class="linenos">190</span></a><span class="sd">        way to generate the theoretical frequency pattern from each model</span>
</span><span id="theoretical_pattern_from_dfrow-191"><a href="#theoretical_pattern_from_dfrow-191"><span class="linenos">191</span></a><span class="sd">        to match the observed pattern. Options are:</span>
</span><span id="theoretical_pattern_from_dfrow-192"><a href="#theoretical_pattern_from_dfrow-192"><span class="linenos">192</span></a><span class="sd">            provided-pulsation: build pattern from the provided pulsation    (function &#39;puls_series_from_given_puls&#39;)</span>
</span><span id="theoretical_pattern_from_dfrow-193"><a href="#theoretical_pattern_from_dfrow-193"><span class="linenos">193</span></a><span class="sd">            highest-frequency: build pattern from the observed highest frequency    (function &#39;puls_series_from_given_puls&#39;)</span>
</span><span id="theoretical_pattern_from_dfrow-194"><a href="#theoretical_pattern_from_dfrow-194"><span class="linenos">194</span></a><span class="sd">            chisq-longest-sequence: build pattern based on longest, best matching sequence of pulsations    (function &#39;chisq_longest_sequence&#39;)</span>
</span><span id="theoretical_pattern_from_dfrow-195"><a href="#theoretical_pattern_from_dfrow-195"><span class="linenos">195</span></a><span class="sd">    pattern_starting_pulsation: list of floats</span>
</span><span id="theoretical_pattern_from_dfrow-196"><a href="#theoretical_pattern_from_dfrow-196"><span class="linenos">196</span></a><span class="sd">        Only needed if you set method_build_series=provided-pulsation</span>
</span><span id="theoretical_pattern_from_dfrow-197"><a href="#theoretical_pattern_from_dfrow-197"><span class="linenos">197</span></a><span class="sd">        Value of the pulsation to start building the pattern from, one for each separated part of the pattern.</span>
</span><span id="theoretical_pattern_from_dfrow-198"><a href="#theoretical_pattern_from_dfrow-198"><span class="linenos">198</span></a><span class="sd">        The unit of this value needs to be the same as the observable set through which_observable.</span>
</span><span id="theoretical_pattern_from_dfrow-199"><a href="#theoretical_pattern_from_dfrow-199"><span class="linenos">199</span></a><span class="sd">    asymptotic_object: asymptotic (see &#39;gmode_rotation_scaling&#39;)</span>
</span><span id="theoretical_pattern_from_dfrow-200"><a href="#theoretical_pattern_from_dfrow-200"><span class="linenos">200</span></a><span class="sd">        Object to calculate g-mode period spacing patterns in the asymptotic regime using the TAR.</span>
</span><span id="theoretical_pattern_from_dfrow-201"><a href="#theoretical_pattern_from_dfrow-201"><span class="linenos">201</span></a><span class="sd">    estimated_rotation: float</span>
</span><span id="theoretical_pattern_from_dfrow-202"><a href="#theoretical_pattern_from_dfrow-202"><span class="linenos">202</span></a><span class="sd">        Estimation of the rotation rate of the star, used as initial value in the optimisation problem.</span>
</span><span id="theoretical_pattern_from_dfrow-203"><a href="#theoretical_pattern_from_dfrow-203"><span class="linenos">203</span></a><span class="sd">    grid_parameters: list of string</span>
</span><span id="theoretical_pattern_from_dfrow-204"><a href="#theoretical_pattern_from_dfrow-204"><span class="linenos">204</span></a><span class="sd">        List of the parameters in the theoretical grid.</span>
</span><span id="theoretical_pattern_from_dfrow-205"><a href="#theoretical_pattern_from_dfrow-205"><span class="linenos">205</span></a>
</span><span id="theoretical_pattern_from_dfrow-206"><a href="#theoretical_pattern_from_dfrow-206"><span class="linenos">206</span></a><span class="sd">    Returns</span>
</span><span id="theoretical_pattern_from_dfrow-207"><a href="#theoretical_pattern_from_dfrow-207"><span class="linenos">207</span></a><span class="sd">    ----------</span>
</span><span id="theoretical_pattern_from_dfrow-208"><a href="#theoretical_pattern_from_dfrow-208"><span class="linenos">208</span></a><span class="sd">    list_out: list of float</span>
</span><span id="theoretical_pattern_from_dfrow-209"><a href="#theoretical_pattern_from_dfrow-209"><span class="linenos">209</span></a><span class="sd">        The input parameters and pulsation frequencies of the theoretical pattern</span>
</span><span id="theoretical_pattern_from_dfrow-210"><a href="#theoretical_pattern_from_dfrow-210"><span class="linenos">210</span></a><span class="sd">        (or periods, depending on &#39;which_observable&#39;).</span>
</span><span id="theoretical_pattern_from_dfrow-211"><a href="#theoretical_pattern_from_dfrow-211"><span class="linenos">211</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="theoretical_pattern_from_dfrow-212"><a href="#theoretical_pattern_from_dfrow-212"><span class="linenos">212</span></a>    <span class="c1"># all keys containing n_pg (these are all the radial orders)</span>
</span><span id="theoretical_pattern_from_dfrow-213"><a href="#theoretical_pattern_from_dfrow-213"><span class="linenos">213</span></a>    <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">summary_grid_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;n_pg&quot;</span><span class="p">))</span>
</span><span id="theoretical_pattern_from_dfrow-214"><a href="#theoretical_pattern_from_dfrow-214"><span class="linenos">214</span></a>    <span class="c1"># array with radial orders</span>
</span><span id="theoretical_pattern_from_dfrow-215"><a href="#theoretical_pattern_from_dfrow-215"><span class="linenos">215</span></a>    <span class="n">orders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;n_pg&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">summary_grid_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;n_pg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
</span><span id="theoretical_pattern_from_dfrow-216"><a href="#theoretical_pattern_from_dfrow-216"><span class="linenos">216</span></a>    <span class="n">orders</span> <span class="o">=</span> <span class="n">orders</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">freqs</span><span class="p">)]</span>
</span><span id="theoretical_pattern_from_dfrow-217"><a href="#theoretical_pattern_from_dfrow-217"><span class="linenos">217</span></a>    <span class="c1"># remove all entries that are NaN in the numpy array (for when the models have a different amount of computed modes)</span>
</span><span id="theoretical_pattern_from_dfrow-218"><a href="#theoretical_pattern_from_dfrow-218"><span class="linenos">218</span></a>    <span class="n">freqs</span> <span class="o">=</span> <span class="n">freqs</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">freqs</span><span class="p">)]</span>
</span><span id="theoretical_pattern_from_dfrow-219"><a href="#theoretical_pattern_from_dfrow-219"><span class="linenos">219</span></a>
</span><span id="theoretical_pattern_from_dfrow-220"><a href="#theoretical_pattern_from_dfrow-220"><span class="linenos">220</span></a>    <span class="c1"># Check if pattern_starting_pulsation has enough entries to not truncate other parts in the zip function.</span>
</span><span id="theoretical_pattern_from_dfrow-221"><a href="#theoretical_pattern_from_dfrow-221"><span class="linenos">221</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_pattern_parts</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern_starting_pulsation</span><span class="p">):</span>
</span><span id="theoretical_pattern_from_dfrow-222"><a href="#theoretical_pattern_from_dfrow-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="n">method_build_series</span> <span class="o">==</span> <span class="s2">&quot;provided-pulsation&quot;</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-223"><a href="#theoretical_pattern_from_dfrow-223"><span class="linenos">223</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-224"><a href="#theoretical_pattern_from_dfrow-224"><span class="linenos">224</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-225"><a href="#theoretical_pattern_from_dfrow-225"><span class="linenos">225</span></a>                    <span class="s2">&quot;Amount of pulsations specified to build patterns from is not equal to the amount of split-off parts in the pattern.&quot;</span>
</span><span id="theoretical_pattern_from_dfrow-226"><a href="#theoretical_pattern_from_dfrow-226"><span class="linenos">226</span></a>                <span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-227"><a href="#theoretical_pattern_from_dfrow-227"><span class="linenos">227</span></a>            <span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-228"><a href="#theoretical_pattern_from_dfrow-228"><span class="linenos">228</span></a>        <span class="c1"># Content of pattern_starting_pulsation doesn&#39;t matter if it&#39;s not used to build the pattern.</span>
</span><span id="theoretical_pattern_from_dfrow-229"><a href="#theoretical_pattern_from_dfrow-229"><span class="linenos">229</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-230"><a href="#theoretical_pattern_from_dfrow-230"><span class="linenos">230</span></a>            <span class="c1"># We only care about the length if the method doesn&#39;t use specified pulsations.</span>
</span><span id="theoretical_pattern_from_dfrow-231"><a href="#theoretical_pattern_from_dfrow-231"><span class="linenos">231</span></a>            <span class="n">pattern_starting_pulsation</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_pattern_parts</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-232"><a href="#theoretical_pattern_from_dfrow-232"><span class="linenos">232</span></a>
</span><span id="theoretical_pattern_from_dfrow-233"><a href="#theoretical_pattern_from_dfrow-233"><span class="linenos">233</span></a>    <span class="c1"># In this case, rescaling nor optimisation will happen</span>
</span><span id="theoretical_pattern_from_dfrow-234"><a href="#theoretical_pattern_from_dfrow-234"><span class="linenos">234</span></a>    <span class="k">if</span> <span class="n">asymptotic_object</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-235"><a href="#theoretical_pattern_from_dfrow-235"><span class="linenos">235</span></a>        <span class="n">residual</span> <span class="o">=</span> <span class="n">rescale_rotation_and_select_theoretical_pattern</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-236"><a href="#theoretical_pattern_from_dfrow-236"><span class="linenos">236</span></a>            <span class="kc">None</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-237"><a href="#theoretical_pattern_from_dfrow-237"><span class="linenos">237</span></a>            <span class="n">asymptotic_object</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-238"><a href="#theoretical_pattern_from_dfrow-238"><span class="linenos">238</span></a>            <span class="n">estimated_rotation</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-239"><a href="#theoretical_pattern_from_dfrow-239"><span class="linenos">239</span></a>            <span class="n">freqs</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-240"><a href="#theoretical_pattern_from_dfrow-240"><span class="linenos">240</span></a>            <span class="n">orders</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-241"><a href="#theoretical_pattern_from_dfrow-241"><span class="linenos">241</span></a>            <span class="n">obs</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-242"><a href="#theoretical_pattern_from_dfrow-242"><span class="linenos">242</span></a>            <span class="n">obs_pattern_parts</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-243"><a href="#theoretical_pattern_from_dfrow-243"><span class="linenos">243</span></a>            <span class="n">obs_err_pattern_parts</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-244"><a href="#theoretical_pattern_from_dfrow-244"><span class="linenos">244</span></a>            <span class="n">which_observable</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-245"><a href="#theoretical_pattern_from_dfrow-245"><span class="linenos">245</span></a>            <span class="n">method_build_series</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-246"><a href="#theoretical_pattern_from_dfrow-246"><span class="linenos">246</span></a>            <span class="n">pattern_starting_pulsation</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-247"><a href="#theoretical_pattern_from_dfrow-247"><span class="linenos">247</span></a>        <span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-248"><a href="#theoretical_pattern_from_dfrow-248"><span class="linenos">248</span></a>
</span><span id="theoretical_pattern_from_dfrow-249"><a href="#theoretical_pattern_from_dfrow-249"><span class="linenos">249</span></a>        <span class="n">list_out</span> <span class="o">=</span> <span class="p">[</span><span class="n">estimated_rotation</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="theoretical_pattern_from_dfrow-250"><a href="#theoretical_pattern_from_dfrow-250"><span class="linenos">250</span></a>        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">grid_parameters</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-251"><a href="#theoretical_pattern_from_dfrow-251"><span class="linenos">251</span></a>            <span class="n">list_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary_grid_row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">parameter</span><span class="p">])</span>
</span><span id="theoretical_pattern_from_dfrow-252"><a href="#theoretical_pattern_from_dfrow-252"><span class="linenos">252</span></a>
</span><span id="theoretical_pattern_from_dfrow-253"><a href="#theoretical_pattern_from_dfrow-253"><span class="linenos">253</span></a>        <span class="n">selected_pulsations</span> <span class="o">=</span> <span class="n">obs</span> <span class="o">+</span> <span class="n">residual</span>
</span><span id="theoretical_pattern_from_dfrow-254"><a href="#theoretical_pattern_from_dfrow-254"><span class="linenos">254</span></a>        <span class="n">list_out</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">selected_pulsations</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-255"><a href="#theoretical_pattern_from_dfrow-255"><span class="linenos">255</span></a>
</span><span id="theoretical_pattern_from_dfrow-256"><a href="#theoretical_pattern_from_dfrow-256"><span class="linenos">256</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-257"><a href="#theoretical_pattern_from_dfrow-257"><span class="linenos">257</span></a>        <span class="c1"># Optimise the rotation rate and get the pulsations at that rotation rate</span>
</span><span id="theoretical_pattern_from_dfrow-258"><a href="#theoretical_pattern_from_dfrow-258"><span class="linenos">258</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
</span><span id="theoretical_pattern_from_dfrow-259"><a href="#theoretical_pattern_from_dfrow-259"><span class="linenos">259</span></a>        <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;rotation&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">estimated_rotation</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-260"><a href="#theoretical_pattern_from_dfrow-260"><span class="linenos">260</span></a>        <span class="c1"># Fit rotation to observed pattern with the default leastsq algorithm</span>
</span><span id="theoretical_pattern_from_dfrow-261"><a href="#theoretical_pattern_from_dfrow-261"><span class="linenos">261</span></a>        <span class="n">optimise_rotation</span> <span class="o">=</span> <span class="n">Minimizer</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-262"><a href="#theoretical_pattern_from_dfrow-262"><span class="linenos">262</span></a>            <span class="n">rescale_rotation_and_select_theoretical_pattern</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-263"><a href="#theoretical_pattern_from_dfrow-263"><span class="linenos">263</span></a>            <span class="n">params</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-264"><a href="#theoretical_pattern_from_dfrow-264"><span class="linenos">264</span></a>            <span class="n">fcn_args</span><span class="o">=</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-265"><a href="#theoretical_pattern_from_dfrow-265"><span class="linenos">265</span></a>                <span class="n">asymptotic_object</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-266"><a href="#theoretical_pattern_from_dfrow-266"><span class="linenos">266</span></a>                <span class="n">estimated_rotation</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-267"><a href="#theoretical_pattern_from_dfrow-267"><span class="linenos">267</span></a>                <span class="n">freqs</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-268"><a href="#theoretical_pattern_from_dfrow-268"><span class="linenos">268</span></a>                <span class="n">orders</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-269"><a href="#theoretical_pattern_from_dfrow-269"><span class="linenos">269</span></a>                <span class="n">obs</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-270"><a href="#theoretical_pattern_from_dfrow-270"><span class="linenos">270</span></a>                <span class="n">obs_pattern_parts</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-271"><a href="#theoretical_pattern_from_dfrow-271"><span class="linenos">271</span></a>                <span class="n">obs_err_pattern_parts</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-272"><a href="#theoretical_pattern_from_dfrow-272"><span class="linenos">272</span></a>                <span class="n">which_observable</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-273"><a href="#theoretical_pattern_from_dfrow-273"><span class="linenos">273</span></a>                <span class="n">method_build_series</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-274"><a href="#theoretical_pattern_from_dfrow-274"><span class="linenos">274</span></a>                <span class="n">pattern_starting_pulsation</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-275"><a href="#theoretical_pattern_from_dfrow-275"><span class="linenos">275</span></a>            <span class="p">),</span>
</span><span id="theoretical_pattern_from_dfrow-276"><a href="#theoretical_pattern_from_dfrow-276"><span class="linenos">276</span></a>        <span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-277"><a href="#theoretical_pattern_from_dfrow-277"><span class="linenos">277</span></a>
</span><span id="theoretical_pattern_from_dfrow-278"><a href="#theoretical_pattern_from_dfrow-278"><span class="linenos">278</span></a>        <span class="n">result_minimizer</span> <span class="o">=</span> <span class="n">optimise_rotation</span><span class="o">.</span><span class="n">minimize</span><span class="p">()</span>
</span><span id="theoretical_pattern_from_dfrow-279"><a href="#theoretical_pattern_from_dfrow-279"><span class="linenos">279</span></a>
</span><span id="theoretical_pattern_from_dfrow-280"><a href="#theoretical_pattern_from_dfrow-280"><span class="linenos">280</span></a>        <span class="c1"># Search from second initial value, which is as separated from the first solution as the first initial guess.</span>
</span><span id="theoretical_pattern_from_dfrow-281"><a href="#theoretical_pattern_from_dfrow-281"><span class="linenos">281</span></a>        <span class="n">search_second_initial_value</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">estimated_rotation</span>
</span><span id="theoretical_pattern_from_dfrow-282"><a href="#theoretical_pattern_from_dfrow-282"><span class="linenos">282</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">()</span>
</span><span id="theoretical_pattern_from_dfrow-283"><a href="#theoretical_pattern_from_dfrow-283"><span class="linenos">283</span></a>        <span class="n">params</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;rotation&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">search_second_initial_value</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-284"><a href="#theoretical_pattern_from_dfrow-284"><span class="linenos">284</span></a>        <span class="n">optimise_rotation</span> <span class="o">=</span> <span class="n">Minimizer</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-285"><a href="#theoretical_pattern_from_dfrow-285"><span class="linenos">285</span></a>            <span class="n">rescale_rotation_and_select_theoretical_pattern</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-286"><a href="#theoretical_pattern_from_dfrow-286"><span class="linenos">286</span></a>            <span class="n">params</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-287"><a href="#theoretical_pattern_from_dfrow-287"><span class="linenos">287</span></a>            <span class="n">fcn_args</span><span class="o">=</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-288"><a href="#theoretical_pattern_from_dfrow-288"><span class="linenos">288</span></a>                <span class="n">asymptotic_object</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-289"><a href="#theoretical_pattern_from_dfrow-289"><span class="linenos">289</span></a>                <span class="n">estimated_rotation</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-290"><a href="#theoretical_pattern_from_dfrow-290"><span class="linenos">290</span></a>                <span class="n">freqs</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-291"><a href="#theoretical_pattern_from_dfrow-291"><span class="linenos">291</span></a>                <span class="n">orders</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-292"><a href="#theoretical_pattern_from_dfrow-292"><span class="linenos">292</span></a>                <span class="n">obs</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-293"><a href="#theoretical_pattern_from_dfrow-293"><span class="linenos">293</span></a>                <span class="n">obs_pattern_parts</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-294"><a href="#theoretical_pattern_from_dfrow-294"><span class="linenos">294</span></a>                <span class="n">obs_err_pattern_parts</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-295"><a href="#theoretical_pattern_from_dfrow-295"><span class="linenos">295</span></a>                <span class="n">which_observable</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-296"><a href="#theoretical_pattern_from_dfrow-296"><span class="linenos">296</span></a>                <span class="n">method_build_series</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-297"><a href="#theoretical_pattern_from_dfrow-297"><span class="linenos">297</span></a>                <span class="n">pattern_starting_pulsation</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-298"><a href="#theoretical_pattern_from_dfrow-298"><span class="linenos">298</span></a>            <span class="p">),</span>
</span><span id="theoretical_pattern_from_dfrow-299"><a href="#theoretical_pattern_from_dfrow-299"><span class="linenos">299</span></a>        <span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-300"><a href="#theoretical_pattern_from_dfrow-300"><span class="linenos">300</span></a>
</span><span id="theoretical_pattern_from_dfrow-301"><a href="#theoretical_pattern_from_dfrow-301"><span class="linenos">301</span></a>        <span class="n">result_minimizer2</span> <span class="o">=</span> <span class="n">optimise_rotation</span><span class="o">.</span><span class="n">minimize</span><span class="p">()</span>
</span><span id="theoretical_pattern_from_dfrow-302"><a href="#theoretical_pattern_from_dfrow-302"><span class="linenos">302</span></a>        <span class="c1"># Select the minimizer with the initial guess that resulted in the best fit.</span>
</span><span id="theoretical_pattern_from_dfrow-303"><a href="#theoretical_pattern_from_dfrow-303"><span class="linenos">303</span></a>        <span class="k">if</span> <span class="n">result_minimizer2</span><span class="o">.</span><span class="n">chisqr</span> <span class="o">&lt;</span> <span class="n">result_minimizer</span><span class="o">.</span><span class="n">chisqr</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-304"><a href="#theoretical_pattern_from_dfrow-304"><span class="linenos">304</span></a>            <span class="n">result_minimizer</span> <span class="o">=</span> <span class="n">result_minimizer2</span>
</span><span id="theoretical_pattern_from_dfrow-305"><a href="#theoretical_pattern_from_dfrow-305"><span class="linenos">305</span></a>
</span><span id="theoretical_pattern_from_dfrow-306"><a href="#theoretical_pattern_from_dfrow-306"><span class="linenos">306</span></a>        <span class="n">optimised_pulsations</span> <span class="o">=</span> <span class="n">result_minimizer</span><span class="o">.</span><span class="n">residual</span> <span class="o">+</span> <span class="n">obs</span>
</span><span id="theoretical_pattern_from_dfrow-307"><a href="#theoretical_pattern_from_dfrow-307"><span class="linenos">307</span></a>
</span><span id="theoretical_pattern_from_dfrow-308"><a href="#theoretical_pattern_from_dfrow-308"><span class="linenos">308</span></a>        <span class="k">if</span> <span class="n">result_minimizer</span><span class="o">.</span><span class="n">message</span> <span class="o">!=</span> <span class="s2">&quot;Fit succeeded.&quot;</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-309"><a href="#theoretical_pattern_from_dfrow-309"><span class="linenos">309</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-310"><a href="#theoretical_pattern_from_dfrow-310"><span class="linenos">310</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Fitting rotation did not succeed: </span><span class="si">{</span><span class="n">result_minimizer</span><span class="o">.</span><span class="n">message</span><span class="si">}</span>
</span><span id="theoretical_pattern_from_dfrow-311"><a href="#theoretical_pattern_from_dfrow-311"><span class="linenos">311</span></a><span class="s2">                            for model </span><span class="si">{</span><span class="n">summary_grid_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">summary_grid_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;n_pg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;rot&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="si">}</span><span class="s2"> using method: </span><span class="si">{</span><span class="n">method_build_series</span><span class="si">}</span>
</span><span id="theoretical_pattern_from_dfrow-312"><a href="#theoretical_pattern_from_dfrow-312"><span class="linenos">312</span></a><span class="s2">                            rotation found: </span><span class="si">{</span><span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rotation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> with error: </span><span class="si">{</span><span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rotation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="theoretical_pattern_from_dfrow-313"><a href="#theoretical_pattern_from_dfrow-313"><span class="linenos">313</span></a>            <span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-314"><a href="#theoretical_pattern_from_dfrow-314"><span class="linenos">314</span></a>
</span><span id="theoretical_pattern_from_dfrow-315"><a href="#theoretical_pattern_from_dfrow-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="n">plot_rotation_optimisation</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-316"><a href="#theoretical_pattern_from_dfrow-316"><span class="linenos">316</span></a>            <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="theoretical_pattern_from_dfrow-317"><a href="#theoretical_pattern_from_dfrow-317"><span class="linenos">317</span></a>            <span class="k">if</span> <span class="n">which_observable</span> <span class="o">==</span> <span class="s2">&quot;frequency&quot;</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-318"><a href="#theoretical_pattern_from_dfrow-318"><span class="linenos">318</span></a>                <span class="n">obsperiod</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">obs</span>
</span><span id="theoretical_pattern_from_dfrow-319"><a href="#theoretical_pattern_from_dfrow-319"><span class="linenos">319</span></a>                <span class="n">optimised_periods</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">optimised_pulsations</span>
</span><span id="theoretical_pattern_from_dfrow-320"><a href="#theoretical_pattern_from_dfrow-320"><span class="linenos">320</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-321"><a href="#theoretical_pattern_from_dfrow-321"><span class="linenos">321</span></a>                <span class="n">obsperiod</span> <span class="o">=</span> <span class="n">obs</span>
</span><span id="theoretical_pattern_from_dfrow-322"><a href="#theoretical_pattern_from_dfrow-322"><span class="linenos">322</span></a>                <span class="n">optimised_periods</span> <span class="o">=</span> <span class="n">optimised_pulsations</span>
</span><span id="theoretical_pattern_from_dfrow-323"><a href="#theoretical_pattern_from_dfrow-323"><span class="linenos">323</span></a>
</span><span id="theoretical_pattern_from_dfrow-324"><a href="#theoretical_pattern_from_dfrow-324"><span class="linenos">324</span></a>            <span class="c1"># Recombine observational errors in one array</span>
</span><span id="theoretical_pattern_from_dfrow-325"><a href="#theoretical_pattern_from_dfrow-325"><span class="linenos">325</span></a>            <span class="n">combined_obs_err</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="theoretical_pattern_from_dfrow-326"><a href="#theoretical_pattern_from_dfrow-326"><span class="linenos">326</span></a>            <span class="k">for</span> <span class="n">obs_err_part</span> <span class="ow">in</span> <span class="n">obs_err_pattern_parts</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-327"><a href="#theoretical_pattern_from_dfrow-327"><span class="linenos">327</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">combined_obs_err</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-328"><a href="#theoretical_pattern_from_dfrow-328"><span class="linenos">328</span></a>                    <span class="n">combined_obs_err</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
</span><span id="theoretical_pattern_from_dfrow-329"><a href="#theoretical_pattern_from_dfrow-329"><span class="linenos">329</span></a>                <span class="n">combined_obs_err</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">obs_err_part</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-330"><a href="#theoretical_pattern_from_dfrow-330"><span class="linenos">330</span></a>            <span class="n">combined_obs_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">combined_obs_err</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-331"><a href="#theoretical_pattern_from_dfrow-331"><span class="linenos">331</span></a>
</span><span id="theoretical_pattern_from_dfrow-332"><a href="#theoretical_pattern_from_dfrow-332"><span class="linenos">332</span></a>            <span class="n">spacings</span> <span class="o">=</span> <span class="n">generate_spacing_series</span><span class="p">(</span><span class="n">obsperiod</span><span class="p">,</span> <span class="n">combined_obs_err</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-333"><a href="#theoretical_pattern_from_dfrow-333"><span class="linenos">333</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">obsperiod</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">spacings</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">spacings</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-334"><a href="#theoretical_pattern_from_dfrow-334"><span class="linenos">334</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obsperiod</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">spacings</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-335"><a href="#theoretical_pattern_from_dfrow-335"><span class="linenos">335</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-336"><a href="#theoretical_pattern_from_dfrow-336"><span class="linenos">336</span></a>                <span class="n">optimised_periods</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="theoretical_pattern_from_dfrow-337"><a href="#theoretical_pattern_from_dfrow-337"><span class="linenos">337</span></a>                <span class="n">generate_spacing_series</span><span class="p">(</span><span class="n">optimised_periods</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="theoretical_pattern_from_dfrow-338"><a href="#theoretical_pattern_from_dfrow-338"><span class="linenos">338</span></a>                <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-339"><a href="#theoretical_pattern_from_dfrow-339"><span class="linenos">339</span></a>                <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-340"><a href="#theoretical_pattern_from_dfrow-340"><span class="linenos">340</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-341"><a href="#theoretical_pattern_from_dfrow-341"><span class="linenos">341</span></a>                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;optimised&quot;</span><span class="p">,</span>
</span><span id="theoretical_pattern_from_dfrow-342"><a href="#theoretical_pattern_from_dfrow-342"><span class="linenos">342</span></a>            <span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-343"><a href="#theoretical_pattern_from_dfrow-343"><span class="linenos">343</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-344"><a href="#theoretical_pattern_from_dfrow-344"><span class="linenos">344</span></a>                <span class="mi">1</span> <span class="o">/</span> <span class="n">freqs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">generate_spacing_series</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">freqs</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;initial&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
</span><span id="theoretical_pattern_from_dfrow-345"><a href="#theoretical_pattern_from_dfrow-345"><span class="linenos">345</span></a>            <span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-346"><a href="#theoretical_pattern_from_dfrow-346"><span class="linenos">346</span></a>
</span><span id="theoretical_pattern_from_dfrow-347"><a href="#theoretical_pattern_from_dfrow-347"><span class="linenos">347</span></a>            <span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="theoretical_pattern_from_dfrow-348"><a href="#theoretical_pattern_from_dfrow-348"><span class="linenos">348</span></a>
</span><span id="theoretical_pattern_from_dfrow-349"><a href="#theoretical_pattern_from_dfrow-349"><span class="linenos">349</span></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">combined_obs_err</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-350"><a href="#theoretical_pattern_from_dfrow-350"><span class="linenos">350</span></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">optimised_periods</span><span class="p">,</span> <span class="n">optimised_periods</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;optimised&quot;</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-351"><a href="#theoretical_pattern_from_dfrow-351"><span class="linenos">351</span></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">freqs</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">freqs</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;initial&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-352"><a href="#theoretical_pattern_from_dfrow-352"><span class="linenos">352</span></a>
</span><span id="theoretical_pattern_from_dfrow-353"><a href="#theoretical_pattern_from_dfrow-353"><span class="linenos">353</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>
</span><span id="theoretical_pattern_from_dfrow-354"><a href="#theoretical_pattern_from_dfrow-354"><span class="linenos">354</span></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>
</span><span id="theoretical_pattern_from_dfrow-355"><a href="#theoretical_pattern_from_dfrow-355"><span class="linenos">355</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-356"><a href="#theoretical_pattern_from_dfrow-356"><span class="linenos">356</span></a>                <span class="sa">f</span><span class="s2">&quot;initial omega = </span><span class="si">{</span><span class="n">estimated_rotation</span><span class="si">}</span><span class="s2">, optimised omega = </span><span class="si">{</span><span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rotation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="theoretical_pattern_from_dfrow-357"><a href="#theoretical_pattern_from_dfrow-357"><span class="linenos">357</span></a>            <span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-358"><a href="#theoretical_pattern_from_dfrow-358"><span class="linenos">358</span></a>            <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
</span><span id="theoretical_pattern_from_dfrow-359"><a href="#theoretical_pattern_from_dfrow-359"><span class="linenos">359</span></a>                <span class="sa">f</span><span class="s2">&quot;initial omega = </span><span class="si">{</span><span class="n">estimated_rotation</span><span class="si">}</span><span class="s2">, optimised omega = </span><span class="si">{</span><span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rotation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="theoretical_pattern_from_dfrow-360"><a href="#theoretical_pattern_from_dfrow-360"><span class="linenos">360</span></a>            <span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-361"><a href="#theoretical_pattern_from_dfrow-361"><span class="linenos">361</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="theoretical_pattern_from_dfrow-362"><a href="#theoretical_pattern_from_dfrow-362"><span class="linenos">362</span></a>
</span><span id="theoretical_pattern_from_dfrow-363"><a href="#theoretical_pattern_from_dfrow-363"><span class="linenos">363</span></a>        <span class="c1"># Create list with rotation, its error, all the input parameters, and the optimised pulsations</span>
</span><span id="theoretical_pattern_from_dfrow-364"><a href="#theoretical_pattern_from_dfrow-364"><span class="linenos">364</span></a>        <span class="n">list_out</span> <span class="o">=</span> <span class="p">[</span><span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">result_minimizer</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">]</span>
</span><span id="theoretical_pattern_from_dfrow-365"><a href="#theoretical_pattern_from_dfrow-365"><span class="linenos">365</span></a>        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">grid_parameters</span><span class="p">:</span>
</span><span id="theoretical_pattern_from_dfrow-366"><a href="#theoretical_pattern_from_dfrow-366"><span class="linenos">366</span></a>            <span class="n">list_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary_grid_row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">parameter</span><span class="p">])</span>
</span><span id="theoretical_pattern_from_dfrow-367"><a href="#theoretical_pattern_from_dfrow-367"><span class="linenos">367</span></a>        <span class="n">list_out</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">optimised_pulsations</span><span class="p">)</span>
</span><span id="theoretical_pattern_from_dfrow-368"><a href="#theoretical_pattern_from_dfrow-368"><span class="linenos">368</span></a>
</span><span id="theoretical_pattern_from_dfrow-369"><a href="#theoretical_pattern_from_dfrow-369"><span class="linenos">369</span></a>    <span class="k">return</span> <span class="n">list_out</span>
</span></pre></div>


            <div class="docstring"><p>Extract model parameters and a theoretical pulsation pattern from a row of the dataFrame that contains all model parameters and pulsation frequencies.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>summary_grid_row</strong> (tuple, made of (int, pandas series)):
tuple returned from pandas.iterrows(), first tuple entry is the row index of the pandas dataFrame
second tuple entry is a pandas series, containing a row from the pandas dataFrame.
(This row holds model parameters and pulsation frequencies.)</li>
<li><strong>obs</strong> (numpy array, dtype=float):
Array of observed frequencies or periods. (Ordered increasing in frequency.)</li>
<li><strong>obs_pattern_parts</strong> (list of numpy array, dtype=float):
Holds a numpy array (with the observed frequencies or periods) per split off part
of the observed pattern if it is interrupted.
The list contains only one array if the observed pattern is uninterrupted.</li>
<li><strong>obs_err_pattern_parts</strong> (list of numpy array, dtype=float):
The errors on the data in obs_pattern_parts.</li>
<li><strong>which_observable</strong> (string):
Which observables are used in the pattern building, options are 'frequency' or 'period'.</li>
<li><strong>method_build_series</strong> (string):
way to generate the theoretical frequency pattern from each model
to match the observed pattern. Options are:
    provided-pulsation: build pattern from the provided pulsation    (function 'puls_series_from_given_puls')
    highest-frequency: build pattern from the observed highest frequency    (function 'puls_series_from_given_puls')
    chisq-longest-sequence: build pattern based on longest, best matching sequence of pulsations    (function 'chisq_longest_sequence')</li>
<li><strong>pattern_starting_pulsation</strong> (list of floats):
Only needed if you set method_build_series=provided-pulsation
Value of the pulsation to start building the pattern from, one for each separated part of the pattern.
The unit of this value needs to be the same as the observable set through which_observable.</li>
<li><strong>asymptotic_object</strong> (asymptotic (see 'gmode_rotation_scaling')):
Object to calculate g-mode period spacing patterns in the asymptotic regime using the TAR.</li>
<li><strong>estimated_rotation</strong> (float):
Estimation of the rotation rate of the star, used as initial value in the optimisation problem.</li>
<li><strong>grid_parameters</strong> (list of string):
List of the parameters in the theoretical grid.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list_out</strong> (list of float):
The input parameters and pulsation frequencies of the theoretical pattern
(or periods, depending on 'which_observable').</li>
</ul>
</div>


                </section>
                <section id="rescale_rotation_and_select_theoretical_pattern">
                            <input id="rescale_rotation_and_select_theoretical_pattern-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rescale_rotation_and_select_theoretical_pattern</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">params</span>,</span><span class="param">	<span class="n">asymptotic_object</span>,</span><span class="param">	<span class="n">estimated_rotation</span>,</span><span class="param">	<span class="n">freqs_input</span>,</span><span class="param">	<span class="n">orders</span>,</span><span class="param">	<span class="n">obs</span>,</span><span class="param">	<span class="n">obs_pattern_parts</span>,</span><span class="param">	<span class="n">obs_err_pattern_parts</span>,</span><span class="param">	<span class="n">which_observable</span>,</span><span class="param">	<span class="n">method_build_series</span>,</span><span class="param">	<span class="n">pattern_starting_pulsation</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="rescale_rotation_and_select_theoretical_pattern-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#rescale_rotation_and_select_theoretical_pattern"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="rescale_rotation_and_select_theoretical_pattern-373"><a href="#rescale_rotation_and_select_theoretical_pattern-373"><span class="linenos">373</span></a><span class="k">def</span> <span class="nf">rescale_rotation_and_select_theoretical_pattern</span><span class="p">(</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-374"><a href="#rescale_rotation_and_select_theoretical_pattern-374"><span class="linenos">374</span></a>    <span class="n">params</span><span class="p">,</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-375"><a href="#rescale_rotation_and_select_theoretical_pattern-375"><span class="linenos">375</span></a>    <span class="n">asymptotic_object</span><span class="p">,</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-376"><a href="#rescale_rotation_and_select_theoretical_pattern-376"><span class="linenos">376</span></a>    <span class="n">estimated_rotation</span><span class="p">,</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-377"><a href="#rescale_rotation_and_select_theoretical_pattern-377"><span class="linenos">377</span></a>    <span class="n">freqs_input</span><span class="p">,</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-378"><a href="#rescale_rotation_and_select_theoretical_pattern-378"><span class="linenos">378</span></a>    <span class="n">orders</span><span class="p">,</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-379"><a href="#rescale_rotation_and_select_theoretical_pattern-379"><span class="linenos">379</span></a>    <span class="n">obs</span><span class="p">,</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-380"><a href="#rescale_rotation_and_select_theoretical_pattern-380"><span class="linenos">380</span></a>    <span class="n">obs_pattern_parts</span><span class="p">,</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-381"><a href="#rescale_rotation_and_select_theoretical_pattern-381"><span class="linenos">381</span></a>    <span class="n">obs_err_pattern_parts</span><span class="p">,</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-382"><a href="#rescale_rotation_and_select_theoretical_pattern-382"><span class="linenos">382</span></a>    <span class="n">which_observable</span><span class="p">,</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-383"><a href="#rescale_rotation_and_select_theoretical_pattern-383"><span class="linenos">383</span></a>    <span class="n">method_build_series</span><span class="p">,</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-384"><a href="#rescale_rotation_and_select_theoretical_pattern-384"><span class="linenos">384</span></a>    <span class="n">pattern_starting_pulsation</span><span class="p">,</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-385"><a href="#rescale_rotation_and_select_theoretical_pattern-385"><span class="linenos">385</span></a><span class="p">):</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-386"><a href="#rescale_rotation_and_select_theoretical_pattern-386"><span class="linenos">386</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-387"><a href="#rescale_rotation_and_select_theoretical_pattern-387"><span class="linenos">387</span></a><span class="sd">    If rotation is not optimised in the modelling, asymptotic_object should be set to &#39;None&#39; and</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-388"><a href="#rescale_rotation_and_select_theoretical_pattern-388"><span class="linenos">388</span></a><span class="sd">    this function will just select a theoretical pulsation pattern based on the specified method.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-389"><a href="#rescale_rotation_and_select_theoretical_pattern-389"><span class="linenos">389</span></a><span class="sd">    If asymptotic_object is supplied, the rotation will be optimised and this will be the</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-390"><a href="#rescale_rotation_and_select_theoretical_pattern-390"><span class="linenos">390</span></a><span class="sd">    objective function for the lmfit Minimizer class to minimise the output of.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-391"><a href="#rescale_rotation_and_select_theoretical_pattern-391"><span class="linenos">391</span></a><span class="sd">    Rescales the theoretical pulsation pattern using the asymptotic object from</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-392"><a href="#rescale_rotation_and_select_theoretical_pattern-392"><span class="linenos">392</span></a><span class="sd">    &#39;gmode_rotation_scaling&#39;, and selects a theoretical pulsation pattern based</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-393"><a href="#rescale_rotation_and_select_theoretical_pattern-393"><span class="linenos">393</span></a><span class="sd">    on the specified method.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-394"><a href="#rescale_rotation_and_select_theoretical_pattern-394"><span class="linenos">394</span></a>
</span><span id="rescale_rotation_and_select_theoretical_pattern-395"><a href="#rescale_rotation_and_select_theoretical_pattern-395"><span class="linenos">395</span></a><span class="sd">    Parameters</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-396"><a href="#rescale_rotation_and_select_theoretical_pattern-396"><span class="linenos">396</span></a><span class="sd">    ----------</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-397"><a href="#rescale_rotation_and_select_theoretical_pattern-397"><span class="linenos">397</span></a><span class="sd">    params: Parameter (object of lmfit)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-398"><a href="#rescale_rotation_and_select_theoretical_pattern-398"><span class="linenos">398</span></a><span class="sd">        The parameter used to optimise the fit. In this case rotation in units of 1/day.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-399"><a href="#rescale_rotation_and_select_theoretical_pattern-399"><span class="linenos">399</span></a><span class="sd">    asymptotic_object: asymptotic (see &#39;gmode_rotation_scaling&#39;)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-400"><a href="#rescale_rotation_and_select_theoretical_pattern-400"><span class="linenos">400</span></a><span class="sd">        Object to calculate g-mode period spacing patterns in the asymptotic regime using the TAR.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-401"><a href="#rescale_rotation_and_select_theoretical_pattern-401"><span class="linenos">401</span></a><span class="sd">    estimated_rotation: float</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-402"><a href="#rescale_rotation_and_select_theoretical_pattern-402"><span class="linenos">402</span></a><span class="sd">        Estimated rotation rate in units of 1/day. Used as initial value in the optimisation problem.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-403"><a href="#rescale_rotation_and_select_theoretical_pattern-403"><span class="linenos">403</span></a><span class="sd">    freqs_input: numpy array, dtype=float</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-404"><a href="#rescale_rotation_and_select_theoretical_pattern-404"><span class="linenos">404</span></a><span class="sd">        Array of the frequencies as computed by GYRE, to be scaled to the optimal rotation rate.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-405"><a href="#rescale_rotation_and_select_theoretical_pattern-405"><span class="linenos">405</span></a><span class="sd">    orders: numpy array, dtype=int</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-406"><a href="#rescale_rotation_and_select_theoretical_pattern-406"><span class="linenos">406</span></a><span class="sd">        Array with the radial orders of the theoretical input frequencies.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-407"><a href="#rescale_rotation_and_select_theoretical_pattern-407"><span class="linenos">407</span></a><span class="sd">    obs: numpy array, dtype=float</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-408"><a href="#rescale_rotation_and_select_theoretical_pattern-408"><span class="linenos">408</span></a><span class="sd">        Array of observed frequencies or periods. (Ordered increasing in frequency.)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-409"><a href="#rescale_rotation_and_select_theoretical_pattern-409"><span class="linenos">409</span></a><span class="sd">    obs_pattern_parts: list of numpy array, dtype=float</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-410"><a href="#rescale_rotation_and_select_theoretical_pattern-410"><span class="linenos">410</span></a><span class="sd">        Holds a numpy array with observed frequencies or periods</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-411"><a href="#rescale_rotation_and_select_theoretical_pattern-411"><span class="linenos">411</span></a><span class="sd">        per split off part of the observed pattern if it is interrupted.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-412"><a href="#rescale_rotation_and_select_theoretical_pattern-412"><span class="linenos">412</span></a><span class="sd">        The list contains only one array if the observed pattern is uninterrupted.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-413"><a href="#rescale_rotation_and_select_theoretical_pattern-413"><span class="linenos">413</span></a><span class="sd">    obs_err_pattern_parts: list of numpy array, dtype=float</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-414"><a href="#rescale_rotation_and_select_theoretical_pattern-414"><span class="linenos">414</span></a><span class="sd">        The errors on obs_pattern_parts</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-415"><a href="#rescale_rotation_and_select_theoretical_pattern-415"><span class="linenos">415</span></a><span class="sd">    which_observable: string</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-416"><a href="#rescale_rotation_and_select_theoretical_pattern-416"><span class="linenos">416</span></a><span class="sd">        Which observables are used in the pattern building, options are &#39;frequency&#39; or &#39;period&#39;.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-417"><a href="#rescale_rotation_and_select_theoretical_pattern-417"><span class="linenos">417</span></a><span class="sd">    method_build_series: string</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-418"><a href="#rescale_rotation_and_select_theoretical_pattern-418"><span class="linenos">418</span></a><span class="sd">        way to generate the theoretical frequency pattern from each model</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-419"><a href="#rescale_rotation_and_select_theoretical_pattern-419"><span class="linenos">419</span></a><span class="sd">        to match the observed pattern. Options are:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-420"><a href="#rescale_rotation_and_select_theoretical_pattern-420"><span class="linenos">420</span></a><span class="sd">            provided-pulsation: build pattern from the provided pulsation    (function &#39;puls_series_from_given_puls&#39;)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-421"><a href="#rescale_rotation_and_select_theoretical_pattern-421"><span class="linenos">421</span></a><span class="sd">            highest-frequency: build pattern from the observed highest frequency    (function &#39;puls_series_from_given_puls&#39;)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-422"><a href="#rescale_rotation_and_select_theoretical_pattern-422"><span class="linenos">422</span></a><span class="sd">            chisq-longest-sequence: build pattern based on longest, best matching sequence of pulsations    (function &#39;chisq_longest_sequence&#39;)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-423"><a href="#rescale_rotation_and_select_theoretical_pattern-423"><span class="linenos">423</span></a><span class="sd">    pattern_starting_pulsation: list of floats</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-424"><a href="#rescale_rotation_and_select_theoretical_pattern-424"><span class="linenos">424</span></a><span class="sd">        Only needed if you set method_build_series=provided-pulsation</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-425"><a href="#rescale_rotation_and_select_theoretical_pattern-425"><span class="linenos">425</span></a><span class="sd">        Value of the pulsation to start building the pattern from, one for each separated part of the pattern.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-426"><a href="#rescale_rotation_and_select_theoretical_pattern-426"><span class="linenos">426</span></a><span class="sd">        The unit of this value needs to be the same as the observable set through which_observable.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-427"><a href="#rescale_rotation_and_select_theoretical_pattern-427"><span class="linenos">427</span></a>
</span><span id="rescale_rotation_and_select_theoretical_pattern-428"><a href="#rescale_rotation_and_select_theoretical_pattern-428"><span class="linenos">428</span></a><span class="sd">    Returns</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-429"><a href="#rescale_rotation_and_select_theoretical_pattern-429"><span class="linenos">429</span></a><span class="sd">    ----------</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-430"><a href="#rescale_rotation_and_select_theoretical_pattern-430"><span class="linenos">430</span></a><span class="sd">    (output_pulsations - obs): numpy array, dtype=float</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-431"><a href="#rescale_rotation_and_select_theoretical_pattern-431"><span class="linenos">431</span></a><span class="sd">        Differences between the scaled pulsations and the observations.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-432"><a href="#rescale_rotation_and_select_theoretical_pattern-432"><span class="linenos">432</span></a><span class="sd">        The array to be minimised by the lmfit Minimizer if rotation is optimised.</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-433"><a href="#rescale_rotation_and_select_theoretical_pattern-433"><span class="linenos">433</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-434"><a href="#rescale_rotation_and_select_theoretical_pattern-434"><span class="linenos">434</span></a>    <span class="k">if</span> <span class="n">asymptotic_object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-435"><a href="#rescale_rotation_and_select_theoretical_pattern-435"><span class="linenos">435</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">valuesdict</span><span class="p">()</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-436"><a href="#rescale_rotation_and_select_theoretical_pattern-436"><span class="linenos">436</span></a>        <span class="c1"># To avoid division by zero in scale_pattern</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-437"><a href="#rescale_rotation_and_select_theoretical_pattern-437"><span class="linenos">437</span></a>        <span class="k">if</span> <span class="n">estimated_rotation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-438"><a href="#rescale_rotation_and_select_theoretical_pattern-438"><span class="linenos">438</span></a>            <span class="n">estimated_rotation</span> <span class="o">=</span> <span class="mf">1e-99</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-439"><a href="#rescale_rotation_and_select_theoretical_pattern-439"><span class="linenos">439</span></a>        <span class="n">freqs</span> <span class="o">=</span> <span class="n">asymptotic_object</span><span class="o">.</span><span class="n">scale_pattern</span><span class="p">(</span><span class="n">freqs_input</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">estimated_rotation</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-440"><a href="#rescale_rotation_and_select_theoretical_pattern-440"><span class="linenos">440</span></a>        <span class="c1"># convert astropy quantities back to floats</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-441"><a href="#rescale_rotation_and_select_theoretical_pattern-441"><span class="linenos">441</span></a>        <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-442"><a href="#rescale_rotation_and_select_theoretical_pattern-442"><span class="linenos">442</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-443"><a href="#rescale_rotation_and_select_theoretical_pattern-443"><span class="linenos">443</span></a>        <span class="n">freqs</span> <span class="o">=</span> <span class="n">freqs_input</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-444"><a href="#rescale_rotation_and_select_theoretical_pattern-444"><span class="linenos">444</span></a>
</span><span id="rescale_rotation_and_select_theoretical_pattern-445"><a href="#rescale_rotation_and_select_theoretical_pattern-445"><span class="linenos">445</span></a>    <span class="n">periods</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">freqs</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-446"><a href="#rescale_rotation_and_select_theoretical_pattern-446"><span class="linenos">446</span></a>
</span><span id="rescale_rotation_and_select_theoretical_pattern-447"><a href="#rescale_rotation_and_select_theoretical_pattern-447"><span class="linenos">447</span></a>    <span class="n">output_pulsations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-448"><a href="#rescale_rotation_and_select_theoretical_pattern-448"><span class="linenos">448</span></a>    <span class="k">for</span> <span class="n">obs_part</span><span class="p">,</span> <span class="n">obs_err_part</span><span class="p">,</span> <span class="n">pattern_starting_pulsation_part</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-449"><a href="#rescale_rotation_and_select_theoretical_pattern-449"><span class="linenos">449</span></a>        <span class="n">obs_pattern_parts</span><span class="p">,</span> <span class="n">obs_err_pattern_parts</span><span class="p">,</span> <span class="n">pattern_starting_pulsation</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-450"><a href="#rescale_rotation_and_select_theoretical_pattern-450"><span class="linenos">450</span></a>    <span class="p">):</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-451"><a href="#rescale_rotation_and_select_theoretical_pattern-451"><span class="linenos">451</span></a>        <span class="c1"># To indicate interruptions in the pattern</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-452"><a href="#rescale_rotation_and_select_theoretical_pattern-452"><span class="linenos">452</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_pulsations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-453"><a href="#rescale_rotation_and_select_theoretical_pattern-453"><span class="linenos">453</span></a>            <span class="n">output_pulsations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-454"><a href="#rescale_rotation_and_select_theoretical_pattern-454"><span class="linenos">454</span></a>
</span><span id="rescale_rotation_and_select_theoretical_pattern-455"><a href="#rescale_rotation_and_select_theoretical_pattern-455"><span class="linenos">455</span></a>        <span class="k">if</span> <span class="n">which_observable</span> <span class="o">==</span> <span class="s2">&quot;frequency&quot;</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-456"><a href="#rescale_rotation_and_select_theoretical_pattern-456"><span class="linenos">456</span></a>            <span class="c1"># remove frequencies that were already chosen in a different, split-off part of the pattern</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-457"><a href="#rescale_rotation_and_select_theoretical_pattern-457"><span class="linenos">457</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_pulsations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-458"><a href="#rescale_rotation_and_select_theoretical_pattern-458"><span class="linenos">458</span></a>                <span class="c1"># If input is in increasing radial order (decreasing n_pg, since n_pg is negative for g-modes)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-459"><a href="#rescale_rotation_and_select_theoretical_pattern-459"><span class="linenos">459</span></a>                <span class="k">if</span> <span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-460"><a href="#rescale_rotation_and_select_theoretical_pattern-460"><span class="linenos">460</span></a>                    <span class="c1"># index -2 to get lowest, non-zero freq</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-461"><a href="#rescale_rotation_and_select_theoretical_pattern-461"><span class="linenos">461</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">freqs</span> <span class="o">&gt;=</span> <span class="n">output_pulsations</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-462"><a href="#rescale_rotation_and_select_theoretical_pattern-462"><span class="linenos">462</span></a>                <span class="c1"># If input is in decreasing radial order</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-463"><a href="#rescale_rotation_and_select_theoretical_pattern-463"><span class="linenos">463</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-464"><a href="#rescale_rotation_and_select_theoretical_pattern-464"><span class="linenos">464</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">freqs</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">output_pulsations</span><span class="p">)))</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-465"><a href="#rescale_rotation_and_select_theoretical_pattern-465"><span class="linenos">465</span></a>            <span class="n">theory_value</span> <span class="o">=</span> <span class="n">freqs</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-466"><a href="#rescale_rotation_and_select_theoretical_pattern-466"><span class="linenos">466</span></a>            <span class="n">obs_period</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">obs_part</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-467"><a href="#rescale_rotation_and_select_theoretical_pattern-467"><span class="linenos">467</span></a>            <span class="n">obs_period_err</span> <span class="o">=</span> <span class="n">obs_err_part</span> <span class="o">/</span> <span class="n">obs_part</span><span class="o">**</span><span class="mi">2</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-468"><a href="#rescale_rotation_and_select_theoretical_pattern-468"><span class="linenos">468</span></a>            <span class="n">highest_obs_freq</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">obs_part</span><span class="p">)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-469"><a href="#rescale_rotation_and_select_theoretical_pattern-469"><span class="linenos">469</span></a>
</span><span id="rescale_rotation_and_select_theoretical_pattern-470"><a href="#rescale_rotation_and_select_theoretical_pattern-470"><span class="linenos">470</span></a>        <span class="k">elif</span> <span class="n">which_observable</span> <span class="o">==</span> <span class="s2">&quot;period&quot;</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-471"><a href="#rescale_rotation_and_select_theoretical_pattern-471"><span class="linenos">471</span></a>            <span class="c1"># remove periods that were already chosen in a different, split-off part of the pattern</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-472"><a href="#rescale_rotation_and_select_theoretical_pattern-472"><span class="linenos">472</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_pulsations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-473"><a href="#rescale_rotation_and_select_theoretical_pattern-473"><span class="linenos">473</span></a>                <span class="c1"># If input is in increasing radial order (decreasing n_pg, since n_pg is negative for g-modes)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-474"><a href="#rescale_rotation_and_select_theoretical_pattern-474"><span class="linenos">474</span></a>                <span class="k">if</span> <span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-475"><a href="#rescale_rotation_and_select_theoretical_pattern-475"><span class="linenos">475</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">periods</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">output_pulsations</span><span class="p">)))</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-476"><a href="#rescale_rotation_and_select_theoretical_pattern-476"><span class="linenos">476</span></a>                <span class="c1"># If input is in decreasing radial order</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-477"><a href="#rescale_rotation_and_select_theoretical_pattern-477"><span class="linenos">477</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-478"><a href="#rescale_rotation_and_select_theoretical_pattern-478"><span class="linenos">478</span></a>                    <span class="c1"># index -2 to get lowest, non-zero period</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-479"><a href="#rescale_rotation_and_select_theoretical_pattern-479"><span class="linenos">479</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">periods</span> <span class="o">&gt;=</span> <span class="n">output_pulsations</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-480"><a href="#rescale_rotation_and_select_theoretical_pattern-480"><span class="linenos">480</span></a>            <span class="n">theory_value</span> <span class="o">=</span> <span class="n">periods</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-481"><a href="#rescale_rotation_and_select_theoretical_pattern-481"><span class="linenos">481</span></a>            <span class="n">obs_period</span> <span class="o">=</span> <span class="n">obs_part</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-482"><a href="#rescale_rotation_and_select_theoretical_pattern-482"><span class="linenos">482</span></a>            <span class="n">obs_period_err</span> <span class="o">=</span> <span class="n">obs_err_part</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-483"><a href="#rescale_rotation_and_select_theoretical_pattern-483"><span class="linenos">483</span></a>            <span class="c1"># highest frequency is lowest period</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-484"><a href="#rescale_rotation_and_select_theoretical_pattern-484"><span class="linenos">484</span></a>            <span class="n">highest_obs_freq</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">obs_part</span><span class="p">)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-485"><a href="#rescale_rotation_and_select_theoretical_pattern-485"><span class="linenos">485</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-486"><a href="#rescale_rotation_and_select_theoretical_pattern-486"><span class="linenos">486</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown observable to fit&quot;</span><span class="p">))</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-487"><a href="#rescale_rotation_and_select_theoretical_pattern-487"><span class="linenos">487</span></a>
</span><span id="rescale_rotation_and_select_theoretical_pattern-488"><a href="#rescale_rotation_and_select_theoretical_pattern-488"><span class="linenos">488</span></a>        <span class="k">if</span> <span class="n">method_build_series</span> <span class="o">==</span> <span class="s2">&quot;provided-pulsation&quot;</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-489"><a href="#rescale_rotation_and_select_theoretical_pattern-489"><span class="linenos">489</span></a>            <span class="n">selected_theoretical_pulsations</span> <span class="o">=</span> <span class="n">puls_series_from_given_puls</span><span class="p">(</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-490"><a href="#rescale_rotation_and_select_theoretical_pattern-490"><span class="linenos">490</span></a>                <span class="n">theory_value</span><span class="p">,</span> <span class="n">obs_part</span><span class="p">,</span> <span class="n">pattern_starting_pulsation_part</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-491"><a href="#rescale_rotation_and_select_theoretical_pattern-491"><span class="linenos">491</span></a>            <span class="p">)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-492"><a href="#rescale_rotation_and_select_theoretical_pattern-492"><span class="linenos">492</span></a>        <span class="k">elif</span> <span class="n">method_build_series</span> <span class="o">==</span> <span class="s2">&quot;highest-frequency&quot;</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-493"><a href="#rescale_rotation_and_select_theoretical_pattern-493"><span class="linenos">493</span></a>            <span class="n">selected_theoretical_pulsations</span> <span class="o">=</span> <span class="n">puls_series_from_given_puls</span><span class="p">(</span><span class="n">theory_value</span><span class="p">,</span> <span class="n">obs_part</span><span class="p">,</span> <span class="n">highest_obs_freq</span><span class="p">)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-494"><a href="#rescale_rotation_and_select_theoretical_pattern-494"><span class="linenos">494</span></a>        <span class="k">elif</span> <span class="n">method_build_series</span> <span class="o">==</span> <span class="s2">&quot;chisq-longest-sequence&quot;</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-495"><a href="#rescale_rotation_and_select_theoretical_pattern-495"><span class="linenos">495</span></a>            <span class="n">series_chi2</span><span class="p">,</span> <span class="n">final_theoretical_periods</span><span class="p">,</span> <span class="n">corresponding_orders</span> <span class="o">=</span> <span class="n">chisq_longest_sequence</span><span class="p">(</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-496"><a href="#rescale_rotation_and_select_theoretical_pattern-496"><span class="linenos">496</span></a>                <span class="n">periods</span><span class="p">,</span> <span class="n">orders</span><span class="p">,</span> <span class="n">obs_period</span><span class="p">,</span> <span class="n">obs_period_err</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-497"><a href="#rescale_rotation_and_select_theoretical_pattern-497"><span class="linenos">497</span></a>            <span class="p">)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-498"><a href="#rescale_rotation_and_select_theoretical_pattern-498"><span class="linenos">498</span></a>            <span class="k">if</span> <span class="n">which_observable</span> <span class="o">==</span> <span class="s2">&quot;frequency&quot;</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-499"><a href="#rescale_rotation_and_select_theoretical_pattern-499"><span class="linenos">499</span></a>                <span class="n">selected_theoretical_pulsations</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">final_theoretical_periods</span><span class="p">)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-500"><a href="#rescale_rotation_and_select_theoretical_pattern-500"><span class="linenos">500</span></a>            <span class="k">elif</span> <span class="n">which_observable</span> <span class="o">==</span> <span class="s2">&quot;period&quot;</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-501"><a href="#rescale_rotation_and_select_theoretical_pattern-501"><span class="linenos">501</span></a>                <span class="n">selected_theoretical_pulsations</span> <span class="o">=</span> <span class="n">final_theoretical_periods</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-502"><a href="#rescale_rotation_and_select_theoretical_pattern-502"><span class="linenos">502</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-503"><a href="#rescale_rotation_and_select_theoretical_pattern-503"><span class="linenos">503</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecognised method to build pulsation series: </span><span class="si">{</span><span class="n">method_build_series</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-504"><a href="#rescale_rotation_and_select_theoretical_pattern-504"><span class="linenos">504</span></a>
</span><span id="rescale_rotation_and_select_theoretical_pattern-505"><a href="#rescale_rotation_and_select_theoretical_pattern-505"><span class="linenos">505</span></a>        <span class="n">output_pulsations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">selected_theoretical_pulsations</span><span class="p">)</span>
</span><span id="rescale_rotation_and_select_theoretical_pattern-506"><a href="#rescale_rotation_and_select_theoretical_pattern-506"><span class="linenos">506</span></a>
</span><span id="rescale_rotation_and_select_theoretical_pattern-507"><a href="#rescale_rotation_and_select_theoretical_pattern-507"><span class="linenos">507</span></a>    <span class="k">return</span> <span class="n">output_pulsations</span> <span class="o">-</span> <span class="n">obs</span>
</span></pre></div>


            <div class="docstring"><p>If rotation is not optimised in the modelling, asymptotic_object should be set to 'None' and
this function will just select a theoretical pulsation pattern based on the specified method.
If asymptotic_object is supplied, the rotation will be optimised and this will be the
objective function for the lmfit Minimizer class to minimise the output of.
Rescales the theoretical pulsation pattern using the asymptotic object from
'gmode_rotation_scaling', and selects a theoretical pulsation pattern based
on the specified method.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>params</strong> (Parameter (object of lmfit)):
The parameter used to optimise the fit. In this case rotation in units of 1/day.</li>
<li><strong>asymptotic_object</strong> (asymptotic (see 'gmode_rotation_scaling')):
Object to calculate g-mode period spacing patterns in the asymptotic regime using the TAR.</li>
<li><strong>estimated_rotation</strong> (float):
Estimated rotation rate in units of 1/day. Used as initial value in the optimisation problem.</li>
<li><strong>freqs_input</strong> (numpy array, dtype=float):
Array of the frequencies as computed by GYRE, to be scaled to the optimal rotation rate.</li>
<li><strong>orders</strong> (numpy array, dtype=int):
Array with the radial orders of the theoretical input frequencies.</li>
<li><strong>obs</strong> (numpy array, dtype=float):
Array of observed frequencies or periods. (Ordered increasing in frequency.)</li>
<li><strong>obs_pattern_parts</strong> (list of numpy array, dtype=float):
Holds a numpy array with observed frequencies or periods
per split off part of the observed pattern if it is interrupted.
The list contains only one array if the observed pattern is uninterrupted.</li>
<li><strong>obs_err_pattern_parts</strong> (list of numpy array, dtype=float):
The errors on obs_pattern_parts</li>
<li><strong>which_observable</strong> (string):
Which observables are used in the pattern building, options are 'frequency' or 'period'.</li>
<li><strong>method_build_series</strong> (string):
way to generate the theoretical frequency pattern from each model
to match the observed pattern. Options are:
    provided-pulsation: build pattern from the provided pulsation    (function 'puls_series_from_given_puls')
    highest-frequency: build pattern from the observed highest frequency    (function 'puls_series_from_given_puls')
    chisq-longest-sequence: build pattern based on longest, best matching sequence of pulsations    (function 'chisq_longest_sequence')</li>
<li><strong>pattern_starting_pulsation</strong> (list of floats):
Only needed if you set method_build_series=provided-pulsation
Value of the pulsation to start building the pattern from, one for each separated part of the pattern.
The unit of this value needs to be the same as the observable set through which_observable.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>(output_pulsations - obs)</strong> (numpy array, dtype=float):
Differences between the scaled pulsations and the observations.
The array to be minimised by the lmfit Minimizer if rotation is optimised.</li>
</ul>
</div>


                </section>
                <section id="puls_series_from_given_puls">
                            <input id="puls_series_from_given_puls-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">puls_series_from_given_puls</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">theory_in</span>, </span><span class="param"><span class="n">obs</span>, </span><span class="param"><span class="n">obs_to_build_from</span>, </span><span class="param"><span class="n">plot</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="puls_series_from_given_puls-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#puls_series_from_given_puls"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="puls_series_from_given_puls-511"><a href="#puls_series_from_given_puls-511"><span class="linenos">511</span></a><span class="k">def</span> <span class="nf">puls_series_from_given_puls</span><span class="p">(</span><span class="n">theory_in</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">obs_to_build_from</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="puls_series_from_given_puls-512"><a href="#puls_series_from_given_puls-512"><span class="linenos">512</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="puls_series_from_given_puls-513"><a href="#puls_series_from_given_puls-513"><span class="linenos">513</span></a><span class="sd">    Generate a theoretical pulsation pattern (can be in frequency or period) from the given observations.</span>
</span><span id="puls_series_from_given_puls-514"><a href="#puls_series_from_given_puls-514"><span class="linenos">514</span></a><span class="sd">    Build consecutively in radial order, starting from the theoretical value closest to the provided observational value.</span>
</span><span id="puls_series_from_given_puls-515"><a href="#puls_series_from_given_puls-515"><span class="linenos">515</span></a>
</span><span id="puls_series_from_given_puls-516"><a href="#puls_series_from_given_puls-516"><span class="linenos">516</span></a><span class="sd">    Parameters</span>
</span><span id="puls_series_from_given_puls-517"><a href="#puls_series_from_given_puls-517"><span class="linenos">517</span></a><span class="sd">    ----------</span>
</span><span id="puls_series_from_given_puls-518"><a href="#puls_series_from_given_puls-518"><span class="linenos">518</span></a><span class="sd">    theory_in: numpy array, dtype=float</span>
</span><span id="puls_series_from_given_puls-519"><a href="#puls_series_from_given_puls-519"><span class="linenos">519</span></a><span class="sd">        Array of theoretical frequencies or periods.</span>
</span><span id="puls_series_from_given_puls-520"><a href="#puls_series_from_given_puls-520"><span class="linenos">520</span></a><span class="sd">    obs: numpy array, dtype=float</span>
</span><span id="puls_series_from_given_puls-521"><a href="#puls_series_from_given_puls-521"><span class="linenos">521</span></a><span class="sd">        Array of observed frequencies or periods.</span>
</span><span id="puls_series_from_given_puls-522"><a href="#puls_series_from_given_puls-522"><span class="linenos">522</span></a><span class="sd">    obs_to_build_from: float</span>
</span><span id="puls_series_from_given_puls-523"><a href="#puls_series_from_given_puls-523"><span class="linenos">523</span></a><span class="sd">        observed frequency or period value to start building the pattern from.</span>
</span><span id="puls_series_from_given_puls-524"><a href="#puls_series_from_given_puls-524"><span class="linenos">524</span></a><span class="sd">    plot: boolean</span>
</span><span id="puls_series_from_given_puls-525"><a href="#puls_series_from_given_puls-525"><span class="linenos">525</span></a><span class="sd">        Make a period spacing diagram for the constructed series.</span>
</span><span id="puls_series_from_given_puls-526"><a href="#puls_series_from_given_puls-526"><span class="linenos">526</span></a>
</span><span id="puls_series_from_given_puls-527"><a href="#puls_series_from_given_puls-527"><span class="linenos">527</span></a><span class="sd">    Returns</span>
</span><span id="puls_series_from_given_puls-528"><a href="#puls_series_from_given_puls-528"><span class="linenos">528</span></a><span class="sd">    ----------</span>
</span><span id="puls_series_from_given_puls-529"><a href="#puls_series_from_given_puls-529"><span class="linenos">529</span></a><span class="sd">    theory_sequence: list of float</span>
</span><span id="puls_series_from_given_puls-530"><a href="#puls_series_from_given_puls-530"><span class="linenos">530</span></a><span class="sd">        The constructed theoretical frequency pattern</span>
</span><span id="puls_series_from_given_puls-531"><a href="#puls_series_from_given_puls-531"><span class="linenos">531</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="puls_series_from_given_puls-532"><a href="#puls_series_from_given_puls-532"><span class="linenos">532</span></a>    <span class="c1"># get index of observation to build the series from</span>
</span><span id="puls_series_from_given_puls-533"><a href="#puls_series_from_given_puls-533"><span class="linenos">533</span></a>    <span class="n">nth_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obs</span> <span class="o">==</span> <span class="n">obs_to_build_from</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="puls_series_from_given_puls-534"><a href="#puls_series_from_given_puls-534"><span class="linenos">534</span></a>    <span class="c1"># search theoretical freq closest to the given observed one</span>
</span><span id="puls_series_from_given_puls-535"><a href="#puls_series_from_given_puls-535"><span class="linenos">535</span></a>    <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theory_in</span> <span class="o">-</span> <span class="n">obs_to_build_from</span><span class="p">)</span>
</span><span id="puls_series_from_given_puls-536"><a href="#puls_series_from_given_puls-536"><span class="linenos">536</span></a>    <span class="c1"># get index of this theoretical frequency</span>
</span><span id="puls_series_from_given_puls-537"><a href="#puls_series_from_given_puls-537"><span class="linenos">537</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">diff</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="puls_series_from_given_puls-538"><a href="#puls_series_from_given_puls-538"><span class="linenos">538</span></a>
</span><span id="puls_series_from_given_puls-539"><a href="#puls_series_from_given_puls-539"><span class="linenos">539</span></a>    <span class="c1"># Insert a value of -1 if observations miss a theoretical counterpart in the beginning</span>
</span><span id="puls_series_from_given_puls-540"><a href="#puls_series_from_given_puls-540"><span class="linenos">540</span></a>    <span class="n">theory_sequence</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="puls_series_from_given_puls-541"><a href="#puls_series_from_given_puls-541"><span class="linenos">541</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">-</span> <span class="n">nth_obs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="puls_series_from_given_puls-542"><a href="#puls_series_from_given_puls-542"><span class="linenos">542</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">index</span> <span class="o">-</span> <span class="n">nth_obs</span><span class="p">))):</span>
</span><span id="puls_series_from_given_puls-543"><a href="#puls_series_from_given_puls-543"><span class="linenos">543</span></a>            <span class="n">theory_sequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="puls_series_from_given_puls-544"><a href="#puls_series_from_given_puls-544"><span class="linenos">544</span></a>        <span class="n">theory_sequence</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">theory_in</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">-</span> <span class="n">nth_obs</span><span class="p">)])</span>
</span><span id="puls_series_from_given_puls-545"><a href="#puls_series_from_given_puls-545"><span class="linenos">545</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="puls_series_from_given_puls-546"><a href="#puls_series_from_given_puls-546"><span class="linenos">546</span></a>        <span class="n">theory_sequence</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">theory_in</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="n">nth_obs</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">-</span> <span class="n">nth_obs</span><span class="p">)])</span>
</span><span id="puls_series_from_given_puls-547"><a href="#puls_series_from_given_puls-547"><span class="linenos">547</span></a>
</span><span id="puls_series_from_given_puls-548"><a href="#puls_series_from_given_puls-548"><span class="linenos">548</span></a>    <span class="c1"># Insert a value of -1 if observations miss a theoretical counterpart at the end</span>
</span><span id="puls_series_from_given_puls-549"><a href="#puls_series_from_given_puls-549"><span class="linenos">549</span></a>    <span class="k">if</span> <span class="n">index</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">-</span> <span class="n">nth_obs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">theory_in</span><span class="p">):</span>
</span><span id="puls_series_from_given_puls-550"><a href="#puls_series_from_given_puls-550"><span class="linenos">550</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">index</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">-</span> <span class="n">nth_obs</span><span class="p">))</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">theory_in</span><span class="p">)):</span>
</span><span id="puls_series_from_given_puls-551"><a href="#puls_series_from_given_puls-551"><span class="linenos">551</span></a>            <span class="n">theory_sequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="puls_series_from_given_puls-552"><a href="#puls_series_from_given_puls-552"><span class="linenos">552</span></a>
</span><span id="puls_series_from_given_puls-553"><a href="#puls_series_from_given_puls-553"><span class="linenos">553</span></a>    <span class="k">if</span> <span class="n">plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="puls_series_from_given_puls-554"><a href="#puls_series_from_given_puls-554"><span class="linenos">554</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="puls_series_from_given_puls-555"><a href="#puls_series_from_given_puls-555"><span class="linenos">555</span></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span id="puls_series_from_given_puls-556"><a href="#puls_series_from_given_puls-556"><span class="linenos">556</span></a>        <span class="n">theory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theory_sequence</span><span class="p">)</span>
</span><span id="puls_series_from_given_puls-557"><a href="#puls_series_from_given_puls-557"><span class="linenos">557</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="n">obs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="n">obs</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">86400</span><span class="p">,</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="puls_series_from_given_puls-558"><a href="#puls_series_from_given_puls-558"><span class="linenos">558</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="puls_series_from_given_puls-559"><a href="#puls_series_from_given_puls-559"><span class="linenos">559</span></a>            <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">theory</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="puls_series_from_given_puls-560"><a href="#puls_series_from_given_puls-560"><span class="linenos">560</span></a>            <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">theory</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">86400</span><span class="p">,</span>
</span><span id="puls_series_from_given_puls-561"><a href="#puls_series_from_given_puls-561"><span class="linenos">561</span></a>            <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
</span><span id="puls_series_from_given_puls-562"><a href="#puls_series_from_given_puls-562"><span class="linenos">562</span></a>            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="puls_series_from_given_puls-563"><a href="#puls_series_from_given_puls-563"><span class="linenos">563</span></a>            <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span id="puls_series_from_given_puls-564"><a href="#puls_series_from_given_puls-564"><span class="linenos">564</span></a>            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
</span><span id="puls_series_from_given_puls-565"><a href="#puls_series_from_given_puls-565"><span class="linenos">565</span></a>            <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span id="puls_series_from_given_puls-566"><a href="#puls_series_from_given_puls-566"><span class="linenos">566</span></a>            <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="puls_series_from_given_puls-567"><a href="#puls_series_from_given_puls-567"><span class="linenos">567</span></a>        <span class="p">)</span>
</span><span id="puls_series_from_given_puls-568"><a href="#puls_series_from_given_puls-568"><span class="linenos">568</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="puls_series_from_given_puls-569"><a href="#puls_series_from_given_puls-569"><span class="linenos">569</span></a>
</span><span id="puls_series_from_given_puls-570"><a href="#puls_series_from_given_puls-570"><span class="linenos">570</span></a>    <span class="k">return</span> <span class="n">theory_sequence</span>
</span></pre></div>


            <div class="docstring"><p>Generate a theoretical pulsation pattern (can be in frequency or period) from the given observations.
Build consecutively in radial order, starting from the theoretical value closest to the provided observational value.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>theory_in</strong> (numpy array, dtype=float):
Array of theoretical frequencies or periods.</li>
<li><strong>obs</strong> (numpy array, dtype=float):
Array of observed frequencies or periods.</li>
<li><strong>obs_to_build_from</strong> (float):
observed frequency or period value to start building the pattern from.</li>
<li><strong>plot</strong> (boolean):
Make a period spacing diagram for the constructed series.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>theory_sequence</strong> (list of float):
The constructed theoretical frequency pattern</li>
</ul>
</div>


                </section>
                <section id="chisq_longest_sequence">
                            <input id="chisq_longest_sequence-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">chisq_longest_sequence</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">theory_periods</span>, </span><span class="param"><span class="n">orders</span>, </span><span class="param"><span class="n">obs_periods</span>, </span><span class="param"><span class="n">obs_periods_errors</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="chisq_longest_sequence-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#chisq_longest_sequence"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="chisq_longest_sequence-574"><a href="#chisq_longest_sequence-574"><span class="linenos">574</span></a><span class="k">def</span> <span class="nf">chisq_longest_sequence</span><span class="p">(</span><span class="n">theory_periods</span><span class="p">,</span> <span class="n">orders</span><span class="p">,</span> <span class="n">obs_periods</span><span class="p">,</span> <span class="n">obs_periods_errors</span><span class="p">):</span>
</span><span id="chisq_longest_sequence-575"><a href="#chisq_longest_sequence-575"><span class="linenos">575</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="chisq_longest_sequence-576"><a href="#chisq_longest_sequence-576"><span class="linenos">576</span></a><span class="sd">    Method to extract the theoretical pattern that best matches the observed one.</span>
</span><span id="chisq_longest_sequence-577"><a href="#chisq_longest_sequence-577"><span class="linenos">577</span></a><span class="sd">    Match each observed mode period to its best matching theoretical counterpart,</span>
</span><span id="chisq_longest_sequence-578"><a href="#chisq_longest_sequence-578"><span class="linenos">578</span></a><span class="sd">    and adopt the longest sequence of consecutive modes found this way.</span>
</span><span id="chisq_longest_sequence-579"><a href="#chisq_longest_sequence-579"><span class="linenos">579</span></a><span class="sd">    In case of multiple mode series with the same length, a final pattern selection</span>
</span><span id="chisq_longest_sequence-580"><a href="#chisq_longest_sequence-580"><span class="linenos">580</span></a><span class="sd">    is made based on the best (chi-square) match between theory and observations.</span>
</span><span id="chisq_longest_sequence-581"><a href="#chisq_longest_sequence-581"><span class="linenos">581</span></a>
</span><span id="chisq_longest_sequence-582"><a href="#chisq_longest_sequence-582"><span class="linenos">582</span></a><span class="sd">    Parameters</span>
</span><span id="chisq_longest_sequence-583"><a href="#chisq_longest_sequence-583"><span class="linenos">583</span></a><span class="sd">    ----------</span>
</span><span id="chisq_longest_sequence-584"><a href="#chisq_longest_sequence-584"><span class="linenos">584</span></a><span class="sd">    theory_periods : numpy array, dtype=float</span>
</span><span id="chisq_longest_sequence-585"><a href="#chisq_longest_sequence-585"><span class="linenos">585</span></a><span class="sd">        Theoretical periods and their radial orders.</span>
</span><span id="chisq_longest_sequence-586"><a href="#chisq_longest_sequence-586"><span class="linenos">586</span></a><span class="sd">    orders : numpy array, dtype=int</span>
</span><span id="chisq_longest_sequence-587"><a href="#chisq_longest_sequence-587"><span class="linenos">587</span></a><span class="sd">        Radial orders corresponding to the periods in theory_periods.</span>
</span><span id="chisq_longest_sequence-588"><a href="#chisq_longest_sequence-588"><span class="linenos">588</span></a><span class="sd">    obs_periods: numpy array, dtype=float</span>
</span><span id="chisq_longest_sequence-589"><a href="#chisq_longest_sequence-589"><span class="linenos">589</span></a><span class="sd">        Observational periods.</span>
</span><span id="chisq_longest_sequence-590"><a href="#chisq_longest_sequence-590"><span class="linenos">590</span></a><span class="sd">    obs_periods_errors: numpy array, dtype=float</span>
</span><span id="chisq_longest_sequence-591"><a href="#chisq_longest_sequence-591"><span class="linenos">591</span></a><span class="sd">        The errors on obs_periods.</span>
</span><span id="chisq_longest_sequence-592"><a href="#chisq_longest_sequence-592"><span class="linenos">592</span></a>
</span><span id="chisq_longest_sequence-593"><a href="#chisq_longest_sequence-593"><span class="linenos">593</span></a><span class="sd">    Returns</span>
</span><span id="chisq_longest_sequence-594"><a href="#chisq_longest_sequence-594"><span class="linenos">594</span></a><span class="sd">    ----------</span>
</span><span id="chisq_longest_sequence-595"><a href="#chisq_longest_sequence-595"><span class="linenos">595</span></a><span class="sd">    series_chi2: float</span>
</span><span id="chisq_longest_sequence-596"><a href="#chisq_longest_sequence-596"><span class="linenos">596</span></a><span class="sd">        chi2 value of the selected theoretical frequencies.</span>
</span><span id="chisq_longest_sequence-597"><a href="#chisq_longest_sequence-597"><span class="linenos">597</span></a><span class="sd">    final_theoretical_periods: numpy array, dtype=float</span>
</span><span id="chisq_longest_sequence-598"><a href="#chisq_longest_sequence-598"><span class="linenos">598</span></a><span class="sd">        The selected theoretical periods that best match the observed pattern.</span>
</span><span id="chisq_longest_sequence-599"><a href="#chisq_longest_sequence-599"><span class="linenos">599</span></a><span class="sd">    corresponding_orders: list of integers</span>
</span><span id="chisq_longest_sequence-600"><a href="#chisq_longest_sequence-600"><span class="linenos">600</span></a><span class="sd">        The radial orders of the returned theoretical periods.</span>
</span><span id="chisq_longest_sequence-601"><a href="#chisq_longest_sequence-601"><span class="linenos">601</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="chisq_longest_sequence-602"><a href="#chisq_longest_sequence-602"><span class="linenos">602</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">theory_periods</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_periods</span><span class="p">):</span>
</span><span id="chisq_longest_sequence-603"><a href="#chisq_longest_sequence-603"><span class="linenos">603</span></a>        <span class="k">return</span> <span class="mf">1e16</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_periods</span><span class="p">))],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_periods</span><span class="p">))]</span>
</span><span id="chisq_longest_sequence-604"><a href="#chisq_longest_sequence-604"><span class="linenos">604</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="chisq_longest_sequence-605"><a href="#chisq_longest_sequence-605"><span class="linenos">605</span></a>        <span class="c1"># Find the best matches per observed period</span>
</span><span id="chisq_longest_sequence-606"><a href="#chisq_longest_sequence-606"><span class="linenos">606</span></a>        <span class="n">pairs_orders</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="chisq_longest_sequence-607"><a href="#chisq_longest_sequence-607"><span class="linenos">607</span></a>        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_periods</span><span class="p">):</span>
</span><span id="chisq_longest_sequence-608"><a href="#chisq_longest_sequence-608"><span class="linenos">608</span></a>            <span class="c1">## Chi_squared array definition</span>
</span><span id="chisq_longest_sequence-609"><a href="#chisq_longest_sequence-609"><span class="linenos">609</span></a>            <span class="n">chi_sqrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="chisq_longest_sequence-610"><a href="#chisq_longest_sequence-610"><span class="linenos">610</span></a>                <span class="p">[((</span><span class="n">period</span> <span class="o">-</span> <span class="n">theory_period</span><span class="p">)</span> <span class="o">/</span> <span class="n">obs_periods_errors</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">theory_period</span> <span class="ow">in</span> <span class="n">theory_periods</span><span class="p">]</span>
</span><span id="chisq_longest_sequence-611"><a href="#chisq_longest_sequence-611"><span class="linenos">611</span></a>            <span class="p">)</span>
</span><span id="chisq_longest_sequence-612"><a href="#chisq_longest_sequence-612"><span class="linenos">612</span></a>
</span><span id="chisq_longest_sequence-613"><a href="#chisq_longest_sequence-613"><span class="linenos">613</span></a>            <span class="c1">## Locate the theoretical frequency (and accompanying order) with the best chi2</span>
</span><span id="chisq_longest_sequence-614"><a href="#chisq_longest_sequence-614"><span class="linenos">614</span></a>            <span class="n">min_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">chi_sqrs</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">chi_sqrs</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="chisq_longest_sequence-615"><a href="#chisq_longest_sequence-615"><span class="linenos">615</span></a>            <span class="n">best_match</span> <span class="o">=</span> <span class="n">theory_periods</span><span class="p">[</span><span class="n">min_ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="chisq_longest_sequence-616"><a href="#chisq_longest_sequence-616"><span class="linenos">616</span></a>            <span class="n">best_order</span> <span class="o">=</span> <span class="n">orders</span><span class="p">[</span><span class="n">min_ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="chisq_longest_sequence-617"><a href="#chisq_longest_sequence-617"><span class="linenos">617</span></a>
</span><span id="chisq_longest_sequence-618"><a href="#chisq_longest_sequence-618"><span class="linenos">618</span></a>            <span class="c1">## Toss everything together for bookkeeping</span>
</span><span id="chisq_longest_sequence-619"><a href="#chisq_longest_sequence-619"><span class="linenos">619</span></a>            <span class="n">pairs_orders</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">period</span><span class="p">,</span> <span class="n">best_match</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">best_order</span><span class="p">),</span> <span class="n">chi_sqrs</span><span class="p">[</span><span class="n">min_ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="chisq_longest_sequence-620"><a href="#chisq_longest_sequence-620"><span class="linenos">620</span></a>
</span><span id="chisq_longest_sequence-621"><a href="#chisq_longest_sequence-621"><span class="linenos">621</span></a>        <span class="n">pairs_orders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pairs_orders</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-622"><a href="#chisq_longest_sequence-622"><span class="linenos">622</span></a>
</span><span id="chisq_longest_sequence-623"><a href="#chisq_longest_sequence-623"><span class="linenos">623</span></a>        <span class="c1"># If input is in increasing radial order (decreasing n_pg, since n_pg is negative for g-modes)</span>
</span><span id="chisq_longest_sequence-624"><a href="#chisq_longest_sequence-624"><span class="linenos">624</span></a>        <span class="k">if</span> <span class="n">orders</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">orders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="chisq_longest_sequence-625"><a href="#chisq_longest_sequence-625"><span class="linenos">625</span></a>            <span class="n">increase_or_decrease</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="chisq_longest_sequence-626"><a href="#chisq_longest_sequence-626"><span class="linenos">626</span></a>        <span class="c1"># If input is in decreasing radial order</span>
</span><span id="chisq_longest_sequence-627"><a href="#chisq_longest_sequence-627"><span class="linenos">627</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="chisq_longest_sequence-628"><a href="#chisq_longest_sequence-628"><span class="linenos">628</span></a>            <span class="n">increase_or_decrease</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="chisq_longest_sequence-629"><a href="#chisq_longest_sequence-629"><span class="linenos">629</span></a>
</span><span id="chisq_longest_sequence-630"><a href="#chisq_longest_sequence-630"><span class="linenos">630</span></a>        <span class="n">sequences</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="chisq_longest_sequence-631"><a href="#chisq_longest_sequence-631"><span class="linenos">631</span></a>        <span class="c1">## Go through all pairs of obs and theoretical frequencies and</span>
</span><span id="chisq_longest_sequence-632"><a href="#chisq_longest_sequence-632"><span class="linenos">632</span></a>        <span class="c1">## check if the next observed frequency has a corresponding theoretical frequency</span>
</span><span id="chisq_longest_sequence-633"><a href="#chisq_longest_sequence-633"><span class="linenos">633</span></a>        <span class="c1">## with the consecutive radial order.</span>
</span><span id="chisq_longest_sequence-634"><a href="#chisq_longest_sequence-634"><span class="linenos">634</span></a>        <span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="chisq_longest_sequence-635"><a href="#chisq_longest_sequence-635"><span class="linenos">635</span></a>        <span class="n">lp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairs_orders</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="chisq_longest_sequence-636"><a href="#chisq_longest_sequence-636"><span class="linenos">636</span></a>        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">sett</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pairs_orders</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="chisq_longest_sequence-637"><a href="#chisq_longest_sequence-637"><span class="linenos">637</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sett</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pairs_orders</span><span class="p">[</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">increase_or_decrease</span><span class="p">:</span>
</span><span id="chisq_longest_sequence-638"><a href="#chisq_longest_sequence-638"><span class="linenos">638</span></a>                <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sett</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-639"><a href="#chisq_longest_sequence-639"><span class="linenos">639</span></a>            <span class="c1"># If not consecutive radial order, save the current sequence and start a new one.</span>
</span><span id="chisq_longest_sequence-640"><a href="#chisq_longest_sequence-640"><span class="linenos">640</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="chisq_longest_sequence-641"><a href="#chisq_longest_sequence-641"><span class="linenos">641</span></a>                <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sett</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-642"><a href="#chisq_longest_sequence-642"><span class="linenos">642</span></a>                <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="chisq_longest_sequence-643"><a href="#chisq_longest_sequence-643"><span class="linenos">643</span></a>                <span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="chisq_longest_sequence-644"><a href="#chisq_longest_sequence-644"><span class="linenos">644</span></a>            <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="n">lp</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="chisq_longest_sequence-645"><a href="#chisq_longest_sequence-645"><span class="linenos">645</span></a>                <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sett</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-646"><a href="#chisq_longest_sequence-646"><span class="linenos">646</span></a>                <span class="n">sequences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="chisq_longest_sequence-647"><a href="#chisq_longest_sequence-647"><span class="linenos">647</span></a>                <span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="chisq_longest_sequence-648"><a href="#chisq_longest_sequence-648"><span class="linenos">648</span></a>        <span class="n">len_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">])</span>
</span><span id="chisq_longest_sequence-649"><a href="#chisq_longest_sequence-649"><span class="linenos">649</span></a>        <span class="n">longest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">len_list</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">len_list</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="chisq_longest_sequence-650"><a href="#chisq_longest_sequence-650"><span class="linenos">650</span></a>
</span><span id="chisq_longest_sequence-651"><a href="#chisq_longest_sequence-651"><span class="linenos">651</span></a>        <span class="c1">## Test if there really is one longest sequence</span>
</span><span id="chisq_longest_sequence-652"><a href="#chisq_longest_sequence-652"><span class="linenos">652</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">longest</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="chisq_longest_sequence-653"><a href="#chisq_longest_sequence-653"><span class="linenos">653</span></a>            <span class="n">lseq</span> <span class="o">=</span> <span class="n">sequences</span><span class="p">[</span><span class="n">longest</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="chisq_longest_sequence-654"><a href="#chisq_longest_sequence-654"><span class="linenos">654</span></a>
</span><span id="chisq_longest_sequence-655"><a href="#chisq_longest_sequence-655"><span class="linenos">655</span></a>        <span class="c1">## if not, pick, of all the sequences with the same length, the best based on chi2</span>
</span><span id="chisq_longest_sequence-656"><a href="#chisq_longest_sequence-656"><span class="linenos">656</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="chisq_longest_sequence-657"><a href="#chisq_longest_sequence-657"><span class="linenos">657</span></a>            <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sequences</span><span class="p">[</span><span class="n">ii</span><span class="p">][:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sequences</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">longest</span><span class="p">]</span>
</span><span id="chisq_longest_sequence-658"><a href="#chisq_longest_sequence-658"><span class="linenos">658</span></a>            <span class="n">min_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">scores</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">scores</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="chisq_longest_sequence-659"><a href="#chisq_longest_sequence-659"><span class="linenos">659</span></a>            <span class="n">lseq</span> <span class="o">=</span> <span class="n">sequences</span><span class="p">[</span><span class="n">longest</span><span class="p">[</span><span class="n">min_score</span><span class="p">]]</span>
</span><span id="chisq_longest_sequence-660"><a href="#chisq_longest_sequence-660"><span class="linenos">660</span></a>
</span><span id="chisq_longest_sequence-661"><a href="#chisq_longest_sequence-661"><span class="linenos">661</span></a>        <span class="n">obs_ordering_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obs_periods</span> <span class="o">==</span> <span class="n">lseq</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="chisq_longest_sequence-662"><a href="#chisq_longest_sequence-662"><span class="linenos">662</span></a>        <span class="n">thr_ordering_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theory_periods</span> <span class="o">==</span> <span class="n">lseq</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="chisq_longest_sequence-663"><a href="#chisq_longest_sequence-663"><span class="linenos">663</span></a>
</span><span id="chisq_longest_sequence-664"><a href="#chisq_longest_sequence-664"><span class="linenos">664</span></a>        <span class="n">ordered_theoretical_periods</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="chisq_longest_sequence-665"><a href="#chisq_longest_sequence-665"><span class="linenos">665</span></a>        <span class="n">corresponding_orders</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="chisq_longest_sequence-666"><a href="#chisq_longest_sequence-666"><span class="linenos">666</span></a>
</span><span id="chisq_longest_sequence-667"><a href="#chisq_longest_sequence-667"><span class="linenos">667</span></a>        <span class="n">thr_ind_start</span> <span class="o">=</span> <span class="n">thr_ordering_ind</span> <span class="o">-</span> <span class="n">obs_ordering_ind</span>
</span><span id="chisq_longest_sequence-668"><a href="#chisq_longest_sequence-668"><span class="linenos">668</span></a>        <span class="n">thr_ind_current</span> <span class="o">=</span> <span class="n">thr_ind_start</span>
</span><span id="chisq_longest_sequence-669"><a href="#chisq_longest_sequence-669"><span class="linenos">669</span></a>
</span><span id="chisq_longest_sequence-670"><a href="#chisq_longest_sequence-670"><span class="linenos">670</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">oper</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_periods</span><span class="p">):</span>
</span><span id="chisq_longest_sequence-671"><a href="#chisq_longest_sequence-671"><span class="linenos">671</span></a>            <span class="n">thr_ind_current</span> <span class="o">=</span> <span class="n">thr_ind_start</span> <span class="o">+</span> <span class="n">i</span>
</span><span id="chisq_longest_sequence-672"><a href="#chisq_longest_sequence-672"><span class="linenos">672</span></a>            <span class="k">if</span> <span class="n">thr_ind_current</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="chisq_longest_sequence-673"><a href="#chisq_longest_sequence-673"><span class="linenos">673</span></a>                <span class="n">tper</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="chisq_longest_sequence-674"><a href="#chisq_longest_sequence-674"><span class="linenos">674</span></a>                <span class="n">ordr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="chisq_longest_sequence-675"><a href="#chisq_longest_sequence-675"><span class="linenos">675</span></a>            <span class="k">elif</span> <span class="n">thr_ind_current</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theory_periods</span><span class="p">):</span>
</span><span id="chisq_longest_sequence-676"><a href="#chisq_longest_sequence-676"><span class="linenos">676</span></a>                <span class="n">tper</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="chisq_longest_sequence-677"><a href="#chisq_longest_sequence-677"><span class="linenos">677</span></a>                <span class="n">ordr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="chisq_longest_sequence-678"><a href="#chisq_longest_sequence-678"><span class="linenos">678</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="chisq_longest_sequence-679"><a href="#chisq_longest_sequence-679"><span class="linenos">679</span></a>                <span class="n">tper</span> <span class="o">=</span> <span class="n">theory_periods</span><span class="p">[</span><span class="n">thr_ind_current</span><span class="p">]</span>
</span><span id="chisq_longest_sequence-680"><a href="#chisq_longest_sequence-680"><span class="linenos">680</span></a>                <span class="n">ordr</span> <span class="o">=</span> <span class="n">orders</span><span class="p">[</span><span class="n">thr_ind_current</span><span class="p">]</span>
</span><span id="chisq_longest_sequence-681"><a href="#chisq_longest_sequence-681"><span class="linenos">681</span></a>            <span class="n">ordered_theoretical_periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tper</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-682"><a href="#chisq_longest_sequence-682"><span class="linenos">682</span></a>            <span class="n">corresponding_orders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ordr</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-683"><a href="#chisq_longest_sequence-683"><span class="linenos">683</span></a>
</span><span id="chisq_longest_sequence-684"><a href="#chisq_longest_sequence-684"><span class="linenos">684</span></a>        <span class="n">final_theoretical_periods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ordered_theoretical_periods</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-685"><a href="#chisq_longest_sequence-685"><span class="linenos">685</span></a>
</span><span id="chisq_longest_sequence-686"><a href="#chisq_longest_sequence-686"><span class="linenos">686</span></a>        <span class="n">obs_series</span><span class="p">,</span> <span class="n">obs_series_errors</span> <span class="o">=</span> <span class="n">generate_spacing_series</span><span class="p">(</span><span class="n">obs_periods</span><span class="p">,</span> <span class="n">obs_periods_errors</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-687"><a href="#chisq_longest_sequence-687"><span class="linenos">687</span></a>        <span class="n">thr_series</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generate_spacing_series</span><span class="p">(</span><span class="n">final_theoretical_periods</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-688"><a href="#chisq_longest_sequence-688"><span class="linenos">688</span></a>
</span><span id="chisq_longest_sequence-689"><a href="#chisq_longest_sequence-689"><span class="linenos">689</span></a>        <span class="n">obs_series</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs_series</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-690"><a href="#chisq_longest_sequence-690"><span class="linenos">690</span></a>        <span class="n">obs_series_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs_series_errors</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-691"><a href="#chisq_longest_sequence-691"><span class="linenos">691</span></a>        <span class="n">thr_series</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thr_series</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-692"><a href="#chisq_longest_sequence-692"><span class="linenos">692</span></a>
</span><span id="chisq_longest_sequence-693"><a href="#chisq_longest_sequence-693"><span class="linenos">693</span></a>        <span class="n">series_chi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">obs_series</span> <span class="o">-</span> <span class="n">thr_series</span><span class="p">)</span> <span class="o">/</span> <span class="n">obs_series_errors</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_series</span><span class="p">)</span>
</span><span id="chisq_longest_sequence-694"><a href="#chisq_longest_sequence-694"><span class="linenos">694</span></a>
</span><span id="chisq_longest_sequence-695"><a href="#chisq_longest_sequence-695"><span class="linenos">695</span></a>        <span class="k">return</span> <span class="n">series_chi2</span><span class="p">,</span> <span class="n">final_theoretical_periods</span><span class="p">,</span> <span class="n">corresponding_orders</span>
</span></pre></div>


            <div class="docstring"><p>Method to extract the theoretical pattern that best matches the observed one.
Match each observed mode period to its best matching theoretical counterpart,
and adopt the longest sequence of consecutive modes found this way.
In case of multiple mode series with the same length, a final pattern selection
is made based on the best (chi-square) match between theory and observations.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>theory_periods</strong> (numpy array, dtype=float):
Theoretical periods and their radial orders.</li>
<li><strong>orders</strong> (numpy array, dtype=int):
Radial orders corresponding to the periods in theory_periods.</li>
<li><strong>obs_periods</strong> (numpy array, dtype=float):
Observational periods.</li>
<li><strong>obs_periods_errors</strong> (numpy array, dtype=float):
The errors on obs_periods.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>series_chi2</strong> (float):
chi2 value of the selected theoretical frequencies.</li>
<li><strong>final_theoretical_periods</strong> (numpy array, dtype=float):
The selected theoretical periods that best match the observed pattern.</li>
<li><strong>corresponding_orders</strong> (list of integers):
The radial orders of the returned theoretical periods.</li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script>
<style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style>pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
<style>:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
<style>.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>    

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">FOAM maintained by <a href="https://github.com/MichielsenM">MichielsenM</a>, created by Mathias Michielsen</p>
        <p>Generated with <a href="https://pdoc.dev/">Pdoc</a>. Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
  </body>
</div>  
</html>