<!DOCTYPE html>
<html>
<style>
.api-page-content {margin: 20px 0px 10px 200px; max-width: 75%;}

.sidenav {
  height: 100%;
  width: 170px;
  position: fixed;
  z-index: 1;
  top: 0;
  left: 0;
  background-color: #111;
  overflow-x: hidden;
  padding-top: 20px;
}

.sidenav a {
  padding: 6px 8px 6px 16px;
  text-decoration: none;
  font-size: 25px;
  color: #a0a0a0;
  display: block;
}

.sidenav a:hover {
  color: #f1f1f1;
}

.dropdown {
  float: left;
  overflow: hidden;
}

.dropdown .dropbtn {
  font-size: 25px;  
  border: none;
  outline: none;
  color: #a0a0a0;
  padding: 14px 16px;
  background-color: inherit;
  font-family: inherit;
  margin: 0;
}

.dropdown-content {
  font-size: 17px;
  display: none;
  position: absolute;
  background-color: #111;
  z-index: 1;
  padding-left: 5px;
  padding-bottom: 25px;
}

.dropdown-content a {
  font-size: 16px;
  float: none;
  color: #a0a0a0;
  text-decoration: none;
  display: block;
  text-align: left;
}

.dropdown-content a:hover {
  color: #f1f1f1
}

.dropdown:hover .dropdown-content {
  display: block;
}
</style><!-- <div id="sidenav" class="sidenav" onmouseover="expandSidebar()" onmouseout="collapseSidebar()"> -->
    <div id="sidenav" class="sidenav"">
        <a href="https://michielsenm.github.io/FOAM/">Home</a>
        <a href="https://michielsenm.github.io/FOAM">Installation</a>
        <a href="https://michielsenm.github.io/FOAM/Walkthrough">Walkthrough</a>
        <a href="https://michielsenm.github.io/FOAM/Pipeline">Pipeline modules</a>
        <a href="https://michielsenm.github.io/FOAM/Configuration">Pipeline configuration</a>
        <a href="https://michielsenm.github.io/FOAM/Plottools">Plotting tools</a>
        <a href="https://michielsenm.github.io/FOAM/Guidelines">Community guidelines</a>
        <div class="dropdown">
        <button class="dropbtn" href="https://michielsenm.github.io/FOAM/API/index.html">API</button>
        <div class="dropdown-content">
            <a href="https://michielsenm.github.io/FOAM/API/foam/additional_constraints.html">Additional constraints</a>
            <a href="https://michielsenm.github.io/FOAM/API/foam/build_optimised_pattern.html">Build optimised pattern</a>
            <a href="https://michielsenm.github.io/FOAM/API/foam/functions_for_gyre.html">Functions for gyre</a>
            <a href="https://michielsenm.github.io/FOAM/API/foam/functions_for_mesa.html">Functions for mesa</a>
            <a href="https://michielsenm.github.io/FOAM/API/foam/gmode_rotation_scaling.html">Gmode rotation scaling</a>
            <a href="https://michielsenm.github.io/FOAM/API/foam/maximum_likelihood_estimator.html">Maximum likelihood estimator</a>
            <a href="https://michielsenm.github.io/FOAM/API/foam/model_grid.html">Model grid</a>
            <a href="https://michielsenm.github.io/FOAM/API/foam/plot_tools.html">Plot tools</a>
            <a href="https://michielsenm.github.io/FOAM/API/foam/support_functions.html">Support functions</a>
        </div>
      </div>
      </div>  
      
      <!-- <script>
        document.getElementById("page-content").style.marginLeft = "160px"
        function expandSidebar() {
            console.log("opening sidebar");
            document.getElementById("sidenav").style.left = "0px";
            document.getElementById("page-content").style.marginLeft = "160px";
          } 
          function collapseSidebar() {
            console.log("closing sidebar");
            document.getElementById("sidenav").style.left = "-100px";
            document.getElementById("page-content").style.marginLeft = "60px";
          } 
      </script> --><div id="page-content" class="api-page-content">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <h1 id="project_title"> FAOM API documentation</h1>
        </header>
    </div>

    <!-- MAIN CONTENT -->

    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../foam.html">foam</a><wbr>.maximum_likelihood_estimator    </h1>

                        <div class="docstring"><p>Functions to perform different kinds of maximum likelihood estimation for the models in a grid, and make correlation plots.
Note: The file with observations needs to hold temperature as Teff, although the analysis is done using the logTeff values.</p>
</div>

                        <input id="mod-maximum_likelihood_estimator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-maximum_likelihood_estimator-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot; Functions to perform different kinds of maximum likelihood estimation for the models in a grid, and make correlation plots.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">Note: The file with observations needs to hold temperature as Teff, although the analysis is done using the logTeff values.&quot;&quot;&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">foam</span> <span class="kn">import</span> <span class="n">build_optimised_pattern</span> <span class="k">as</span> <span class="n">bop</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span> <span class="nn">foam</span> <span class="kn">import</span> <span class="n">support_functions</span> <span class="k">as</span> <span class="n">sf</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="c1"># Make a child logger of &quot;logger&quot; made in the top level script</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;logger.mle_estimator&quot;</span><span class="p">)</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="c1"># %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="k">def</span> <span class="nf">calculate_likelihood</span><span class="p">(</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>    <span class="n">theory_file</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>    <span class="n">observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>    <span class="n">merit_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>    <span class="n">obs_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>    <span class="n">star_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="n">fixed_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>    <span class="n">grid_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="p">):</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    Perform a maximum likelihood estimation using the provided type of merit function on the list of observables.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    Writes a data file with the values of the merit function and input parameters of each model.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    Can select and continue the analysis of nested grids through the keyword &#39;fixed_params&#39;.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    Parameters</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    ----------</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    obs_path: string</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">        Path to the tsv file with observations, with a column for each observable and each set of errors.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">        Column names specify the observable, and &quot;_err&quot; suffix denotes that it&#39;s the error.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    theory_file: string</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">        Path to the hdf5 file with the theoretical model input parameters (first set of columns), frequency or period values (last set of columns),</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">        and possibly extra columns with additional observables (these columns should be in between the input parameters and frequency columns).</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    observables: list of strings</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">        Which observables are included in the merit function.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">        Must contain either &#39;f&#39; (frequency), &#39;P&#39; (period), or &#39;dP&#39; (period-spacing) which will be computed for the period pattern.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        Can contain any additional observables that are added as columns in both the file with observations and the file with theoretical models.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    merit_function: string</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        The type of merit function to use. Currently supports &quot;CS and &quot;MD&quot; (&quot;chi-squared&quot; and &quot;mahalanobis distance&quot;).</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    star_name: string</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        Name of the star, used in file naming.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    fixed_params: dict</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">        Only select and analyse the part of the theoretical grid with the specified parameter values.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">        The keys specify for which parameters only the specified value should be selected.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    grid_parameters: list of string</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        List of the parameters in the theoretical grid.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="k">if</span> <span class="s2">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="n">observed_quantity</span> <span class="o">=</span> <span class="s2">&quot;frequency&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="k">elif</span> <span class="s2">&quot;P&quot;</span> <span class="ow">or</span> <span class="s2">&quot;dP&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="n">observed_quantity</span> <span class="o">=</span> <span class="s2">&quot;period&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="c1"># Read in the observed data and make an array of the observed observables</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="n">obs_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">obs_path</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>    <span class="n">obs</span><span class="p">,</span> <span class="n">obs_err</span><span class="p">,</span> <span class="n">file_suffix_observables</span> <span class="o">=</span> <span class="n">create_obs_observables_array</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">,</span> <span class="n">observables</span><span class="p">)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="c1"># set the name of the output file</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="n">_</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">split_line</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">theory_file</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="n">star_name</span><span class="p">)</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">star_name</span><span class="si">}{</span><span class="n">tail</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">merit_function</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_suffix_observables</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="c1"># Theoretical grid data</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="n">theory_dataframe</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">get_subgrid_dataframe</span><span class="p">(</span><span class="n">theory_file</span><span class="p">,</span> <span class="n">fixed_params</span><span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="c1"># get the interruptions in the pattern, absolute index in dataframe</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="n">missing_absolute</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">observed_quantity</span><span class="si">}</span><span class="s2">_missing&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="c1"># get the interruptions in the pattern, index relative within pulsations</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="n">missing_relative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">observed_quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">observed_quantity</span><span class="si">}</span><span class="s2">_missing&quot;</span><span class="p">)</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="c1"># Remove columns of missing frequencies</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>    <span class="n">theory_dataframe</span> <span class="o">=</span> <span class="n">theory_dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">missing_absolute</span><span class="p">])</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>    <span class="c1"># Adjust indices for removed lines of missing frequencies</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>    <span class="n">missing_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">missing_relative</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_relative</span><span class="p">))]</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>    <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">([</span><span class="s2">&quot;rot&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;rot_err&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">grid_parameters</span><span class="p">))</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>    <span class="n">theory_puls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">observed_quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="c1"># Make new list of theoretical models without entries with value -1</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="n">new_theory</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>    <span class="n">new_thetas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">theory_puls</span><span class="p">)):</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        <span class="c1"># ignore models where one of the freqs is -1</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">theory_puls</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">theory_puls</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>            <span class="c1"># make an array of the theoretical observables for each model</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>            <span class="n">theory_observables</span> <span class="o">=</span> <span class="n">create_theory_observables_array</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">observables</span><span class="p">,</span> <span class="n">missing_indices</span><span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>            <span class="n">new_theory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theory_observables</span><span class="p">)</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>            <span class="n">new_thetas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thetas</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="n">neg_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theory_puls</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File: </span><span class="si">{</span><span class="n">theory_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;observables      : </span><span class="si">{</span><span class="n">observables</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ignored -1 freqs : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">neg_value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;original #models : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">theory_puls</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;remaining #models: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">new_theory</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neg_value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">neg_value</span><span class="p">)</span><span class="si">}</span><span class="s2"> models were discarded due to mismatches during the selection of theoretical frequencies.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="s2">                        This is likely due to the frequency range used for the theoretical calculations being too narrow.&quot;&quot;&quot;</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="n">new_theory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_theory</span><span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>    <span class="n">new_thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_thetas</span><span class="p">)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>    <span class="c1"># Dictionary containing different merit functions</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="n">switcher</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;CS&quot;</span><span class="p">:</span> <span class="n">merit_chi2</span><span class="p">,</span> <span class="s2">&quot;MD&quot;</span><span class="p">:</span> <span class="n">merit_mahalanobis</span><span class="p">}</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="c1"># get the desired function from the dictionary. Returns the lambda function if option is not in the dictionary.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>    <span class="n">selected_merit_function</span> <span class="o">=</span> <span class="n">switcher</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="n">merit_function</span><span class="p">,</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;invalid type of maximum likelihood estimator&quot;</span><span class="p">)),</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="n">merit_values</span> <span class="o">=</span> <span class="n">selected_merit_function</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">obs_err</span><span class="p">,</span> <span class="n">new_theory</span><span class="p">,</span> <span class="n">fig_title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">star_name</span><span class="o">=</span><span class="n">star_name</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>    <span class="c1"># Combine values and save the results</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="c1"># add an additional column for MLE &#39;meritValues&#39;</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="n">combined_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">merit_values</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">new_thetas</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="c1"># put the data in a pandas DataFrame</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">combined_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;meritValue&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;rot_err&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">grid_parameters</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="n">df</span><span class="p">,</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="n">theory_dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">observed_quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">,</span> <span class="s2">&quot;rot_err&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">grid_parameters</span><span class="p">,</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">/meritvalues/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.hdf&quot;</span><span class="p">,</span> <span class="s2">&quot;merit_values&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="c1"># %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="c1"># %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="k">def</span> <span class="nf">create_theory_observables_array</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">observables_in</span><span class="p">,</span> <span class="n">missing_indices</span><span class="p">):</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">    Create an array of theoretical observables.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">    Parameters</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">    ----------</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">    theory_dataframe: pandas dataFrame</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        DataFrame containing the theoretical periods or frequencies (as the last columns), along with any additional</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        columns containing extra observables.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">    index: int</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        Row index in the dataFrame of the theoretical model to make the array for.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">    observables_in: list of strings</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">        Which observables are included in the returned array.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">        Must contain either &#39;f&#39; (frequency), &#39;P&#39; (period), or &#39;dP&#39; (period-spacing) which will be computed for the period pattern.</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">        Can contain any additional observables that are added as columns in both the file with observations and the file with theoretical models.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">    missing_indices: list of int</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        Contains the indices of the missing pulsations so that the period spacing pattern can be split around them.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">    Returns</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">    ----------</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">    observables_out: numpy array, dtype=float</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        The values of the specified observables for the model.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>    <span class="c1"># Make a copy to leave the array handed to this function unaltered.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>    <span class="n">observables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">observables_in</span><span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>    <span class="k">if</span> <span class="s2">&quot;P&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="c1"># Cast to list before using asarray to prevent memory leak</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="c1"># add the periods to the output list</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;period&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>        <span class="n">observables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>    <span class="k">elif</span> <span class="s2">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="c1"># Cast to list before using asarray to prevent memory leak</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="c1"># add the frequencies to the output list</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;frequency&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="n">observables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>    <span class="k">elif</span> <span class="s2">&quot;dP&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="n">periods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;period&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="k">for</span> <span class="n">periods_part</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">missing_indices</span><span class="p">):</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>            <span class="n">spacing</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">bop</span><span class="o">.</span><span class="n">generate_spacing_series</span><span class="p">(</span><span class="n">periods_part</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="c1"># switch back from seconds to days (so both P and dP are in days)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spacing</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="n">observables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;dP&quot;</span><span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>    <span class="c1"># Add all other observables in the list from the dataFrame</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>    <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">observable</span><span class="p">]))</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>    <span class="k">return</span> <span class="n">observables_out</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="c1"># %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="k">def</span> <span class="nf">create_obs_observables_array</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">,</span> <span class="n">observables</span><span class="p">):</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">    Create an array of the observed observables.</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">    Parameters</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">    ----------</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">    obs_dataframe: pandas dataFrame</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        DataFrame containing the theoretical frequencies, periods, and any additional observables as columns, as well as columns with their errors.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        Column names specify the observable, and &quot;_err&quot; suffix denotes that it&#39;s the error.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">    observables: list of strings</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        Which observables are included in the returned array.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">        Must contain either &#39;f&#39; (frequency), &#39;P&#39; (period), or &#39;dP&#39; (period-spacing) which will be computed for the period pattern.</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">        Can contain any additional observables that are added as columns in both the file with observations and the file with theoretical models.</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">    Returns</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">    ----------</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">    observables_out: numpy array, dtype=float</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        The values of the specified observables.</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">    observables_err_out: numpy array, dtype=float</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        The errors on the values in observables_out.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">    filename_suffix: string</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        suffix for the filename, containing all the included observables, separated by &#39;-&#39;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>    <span class="c1"># get the interruptions in the pattern</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>    <span class="n">missing_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;f_missing&quot;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>    <span class="c1"># Adjust indices for removed lines of missing frequencies</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>    <span class="n">missing_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">missing_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_indices</span><span class="p">))]</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>    <span class="c1"># remove lines indicating missing frequencies (if they are present)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_indices</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="n">obs_dataframe</span> <span class="o">=</span> <span class="n">obs_dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;f_missing&quot;</span><span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    <span class="n">observables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">observables</span><span class="p">)</span>  <span class="c1"># make a copy of the list, to not alter the one that was given to the function</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>    <span class="n">filename_suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>    <span class="k">if</span> <span class="s2">&quot;P&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">])</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="n">observables_err_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="s2">&quot;period_err&quot;</span><span class="p">])</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="n">filename_suffix</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="n">observables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>    <span class="k">elif</span> <span class="s2">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">])</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="n">observables_err_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="s2">&quot;frequency_err&quot;</span><span class="p">])</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="n">filename_suffix</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="n">observables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="k">elif</span> <span class="s2">&quot;dP&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>        <span class="n">observables_err_out</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="n">period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">])</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="n">period_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="s2">&quot;period_err&quot;</span><span class="p">])</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="n">periods_parts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">missing_indices</span><span class="p">)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="n">periods_err_parts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">period_err</span><span class="p">,</span> <span class="n">missing_indices</span><span class="p">)</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="k">for</span> <span class="n">periods</span><span class="p">,</span> <span class="n">periods_err</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">periods_parts</span><span class="p">,</span> <span class="n">periods_err_parts</span><span class="p">):</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="n">spacing</span><span class="p">,</span> <span class="n">spacing_errs</span> <span class="o">=</span> <span class="n">bop</span><span class="o">.</span><span class="n">generate_spacing_series</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">periods_err</span><span class="p">)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="c1"># switch back from seconds to days (so both P and dP are in days)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spacing</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="n">observables_err_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_err_out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spacing_errs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="n">filename_suffix</span> <span class="o">=</span> <span class="s2">&quot;dP&quot;</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="n">observables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;dP&quot;</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">observables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="n">filename_suffix</span> <span class="o">+=</span> <span class="s2">&quot;+extra&quot;</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    <span class="c1"># Add all other observables in the list from the dataFrame</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>    <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="n">logTeff</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="n">observable</span> <span class="o">==</span> <span class="s2">&quot;logTeff&quot;</span><span class="p">:</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="c1"># To read it as Teff from the observations datafile</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">observable</span> <span class="o">=</span> <span class="s2">&quot;Teff&quot;</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">logTeff</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="c1"># since these columns have less entries, the dataFrame has NaNs in the empty rows</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="n">observable</span><span class="p">])</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="c1"># remove all entries that are NaN in the numpy array</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">obs</span><span class="p">)]</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="n">obs_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">observable</span><span class="si">}</span><span class="s2">_err&quot;</span><span class="p">])</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="n">obs_err</span> <span class="o">=</span> <span class="n">obs_err</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">obs_err</span><span class="p">)]</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="c1"># Convert observed Teff and error to log values</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="k">if</span> <span class="n">logTeff</span><span class="p">:</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="n">logT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="n">logT_err</span> <span class="o">=</span> <span class="n">obs_err</span> <span class="o">/</span> <span class="p">(</span><span class="n">obs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_out</span><span class="p">,</span> <span class="n">logT</span><span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="n">observables_err_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_err_out</span><span class="p">,</span> <span class="n">logT_err</span><span class="p">)</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>            <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_out</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>            <span class="n">observables_err_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_err_out</span><span class="p">,</span> <span class="n">obs_err</span><span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>    <span class="k">return</span> <span class="n">observables_out</span><span class="p">,</span> <span class="n">observables_err_out</span><span class="p">,</span> <span class="n">filename_suffix</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="c1"># %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="c1"># %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="k">def</span> <span class="nf">merit_chi2</span><span class="p">(</span><span class="n">Yobs</span><span class="p">,</span> <span class="n">obs_err</span><span class="p">,</span> <span class="n">YTheo</span><span class="p">,</span> <span class="n">fig_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">star_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">    Calculate chi squared values for the given theoretical patterns</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">    Parameters</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">    ----------</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">    Yobs: numpy array, dtype=float</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">        observed values (period or frequency)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">    obs_err: numpy array, dtype=float</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        Errors on Yobs</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">    YTheo: numpy ndarray (2D), dtype=float</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">        Array of all theoretical patterns to calculate the chi squared value for.</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">    fig_title: None</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">        Should not be used in this function, but is to make it analogous to merit_mahalanobis()</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">        and enable the use of the lambda function.</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">    star_name: None</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">        Should not be used in this function, but is to make it analogous to merit_mahalanobis()</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">        and enable the use of the lambda function.</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">    Returns</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">    ----------</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">    chi2: numpy array, dtype=float</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">        chi squared values for the given theoretical values</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>    <span class="n">chi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">one_YTheo</span> <span class="o">-</span> <span class="n">Yobs</span><span class="p">)</span> <span class="o">/</span> <span class="n">obs_err</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">one_YTheo</span> <span class="ow">in</span> <span class="n">YTheo</span><span class="p">])</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>    <span class="k">return</span> <span class="n">chi2</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="c1"># %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="k">def</span> <span class="nf">merit_mahalanobis</span><span class="p">(</span><span class="n">Yobs</span><span class="p">,</span> <span class="n">obs_err</span><span class="p">,</span> <span class="n">YTheo</span><span class="p">,</span> <span class="n">generate_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fig_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">star_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">    Calculate mahalanobis distance (MD) values for the given theoretical patterns.</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">    Parameters</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">    ----------</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">    Yobs: numpy array, dtype=float</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">        observed values (period or frequency)</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">    obs_err: numpy array, dtype=float</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">        Errors on Yobs</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">    YTheo: numpy array of arrays of floats</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">        Array of all theoretical patterns to calculate the MD value for.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">    generate_output: boolean</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">        Flag to write output and plot the variance-covariance matrix</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">    fig_title: string</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">        The name of the figure to be created.</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">    star_name: string</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        The name of the analysed star, for file naming purposes.</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">    Returns</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">    ----------</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">    MD: numpy array, dtype=float</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">        Mahalanobis distances for the given theoretical patterns.</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>    <span class="c1"># Convert to matrix format (np.matrix is not recommended, use array and newaxis instead)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>    <span class="n">YobsMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Yobs</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>    <span class="n">YTheoMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">YTheo</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>    <span class="c1"># Calculate the average on the theoretical values (e.g. frequencies)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>    <span class="c1"># over the entire grid. Returns a vector of dimension N x 1</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>    <span class="n">Yav</span> <span class="o">=</span> <span class="n">YTheoMat</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>    <span class="c1"># Calculate the variance-covariance matrix</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>    <span class="c1"># number of grid points</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">YTheo</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>    <span class="c1"># number of observed values</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Yobs</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>    <span class="n">v_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>        <span class="n">difference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">YTheoMat</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">Yav</span><span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="n">v_matrix</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">difference</span><span class="p">,</span> <span class="n">difference</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>    <span class="n">v_matrix</span> <span class="o">=</span> <span class="n">v_matrix</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>    <span class="c1"># Include observational errors in the variance-covariance matrix</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>    <span class="n">v_matrix</span> <span class="o">=</span> <span class="n">v_matrix</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">obs_err</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>    <span class="c1"># check if positive definite and make figure</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>    <span class="n">check_matrix</span><span class="p">(</span><span class="n">v_matrix</span><span class="p">,</span> <span class="n">generate_output</span><span class="o">=</span><span class="n">generate_output</span><span class="p">,</span> <span class="n">fig_title</span><span class="o">=</span><span class="n">fig_title</span><span class="p">,</span> <span class="n">star_name</span><span class="o">=</span><span class="n">star_name</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>    <span class="c1"># Calculate Mahalanobis distances</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>    <span class="n">MD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>    <span class="n">v_matrix_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">v_matrix</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        <span class="n">diff</span> <span class="o">=</span> <span class="n">YTheoMat</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">YobsMat</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="n">MD</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">v_matrix_inv</span><span class="p">),</span> <span class="n">diff</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>    <span class="k">return</span> <span class="n">MD</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="c1">################################################################################</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="k">def</span> <span class="nf">check_matrix</span><span class="p">(</span><span class="n">v_matrix</span><span class="p">,</span> <span class="n">generate_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fig_title</span><span class="o">=</span><span class="s2">&quot;Vmatrix&quot;</span><span class="p">,</span> <span class="n">star_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">    Check the if the the eigenvalues of the Variance-covariance matrix are all positive,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">    since this means the matrix is positive definite. Compute its determinant and condition number,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">    and write them to a tsv file. Create and save a figure of the variance-covariance matrix.</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">    Parameters</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">    ----------</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">    v_matrix: numpy ndarray (2D), dtype=float</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">        Variance-covariance matrix</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">    output: boolean</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        Flag to write output and plot the variance-covariance matrix</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">    fig_title: string</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        The name of the figure to be created.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">    star_name: string</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        The name of the analysed star, for file naming purposes.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="c1"># If all eigenvalues are &gt;0, it is positive definite</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">v_matrix</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;V matrix is possibly not positive definite (since eigenvalues are not all &gt; 0)&quot;</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max(v_matrix) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v_matrix</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>    <span class="c1"># multiply the matrix by the exponent of this, otherwise the determinant can be too small for the numerics</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>    <span class="n">kk</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>    <span class="k">if</span> <span class="n">generate_output</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">/V_matrix/</span><span class="si">{</span><span class="n">star_name</span><span class="si">}</span><span class="s2">_determinant_conditionNr.tsv&quot;</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="n">file_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>            <span class="k">with</span> <span class="n">file_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;method </span><span class="se">\t</span><span class="s2"> ln(det(V)) </span><span class="se">\t</span><span class="s2"> condition_number </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="k">with</span> <span class="n">file_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_title</span><span class="si">}</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">*</span><span class="n">v_matrix</span><span class="p">))</span><span class="o">-</span><span class="n">kk</span><span class="o">*</span><span class="n">v_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">v_matrix</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> &quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>            <span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="c1"># Do *10^4 to get rid of small values, and put this in the colorbar label</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">v_matrix</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds&quot;</span><span class="p">)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;obs </span><span class="si">{</span><span class="n">v_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">  $\leftarrow$ obs 1&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;obs 1 $\rightarrow$ obs </span><span class="si">{</span><span class="n">v_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[d$^</span><span class="si">{2}</span><span class="s2"> 10^{-4}$]&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Variance covariance matrix&quot;</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">/V_matrix/</span><span class="si">{</span><span class="n">fig_title</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="calculate_likelihood">
                            <input id="calculate_likelihood-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_likelihood</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">theory_file</span>,</span><span class="param">	<span class="n">observables</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">merit_function</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">obs_path</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">star_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">fixed_params</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">grid_parameters</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="calculate_likelihood-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#calculate_likelihood"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="calculate_likelihood-22"><a href="#calculate_likelihood-22"><span class="linenos"> 22</span></a><span class="k">def</span> <span class="nf">calculate_likelihood</span><span class="p">(</span>
</span><span id="calculate_likelihood-23"><a href="#calculate_likelihood-23"><span class="linenos"> 23</span></a>    <span class="n">theory_file</span><span class="p">,</span>
</span><span id="calculate_likelihood-24"><a href="#calculate_likelihood-24"><span class="linenos"> 24</span></a>    <span class="n">observables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="calculate_likelihood-25"><a href="#calculate_likelihood-25"><span class="linenos"> 25</span></a>    <span class="n">merit_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="calculate_likelihood-26"><a href="#calculate_likelihood-26"><span class="linenos"> 26</span></a>    <span class="n">obs_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="calculate_likelihood-27"><a href="#calculate_likelihood-27"><span class="linenos"> 27</span></a>    <span class="n">star_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="calculate_likelihood-28"><a href="#calculate_likelihood-28"><span class="linenos"> 28</span></a>    <span class="n">fixed_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="calculate_likelihood-29"><a href="#calculate_likelihood-29"><span class="linenos"> 29</span></a>    <span class="n">grid_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="calculate_likelihood-30"><a href="#calculate_likelihood-30"><span class="linenos"> 30</span></a><span class="p">):</span>
</span><span id="calculate_likelihood-31"><a href="#calculate_likelihood-31"><span class="linenos"> 31</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="calculate_likelihood-32"><a href="#calculate_likelihood-32"><span class="linenos"> 32</span></a><span class="sd">    Perform a maximum likelihood estimation using the provided type of merit function on the list of observables.</span>
</span><span id="calculate_likelihood-33"><a href="#calculate_likelihood-33"><span class="linenos"> 33</span></a><span class="sd">    Writes a data file with the values of the merit function and input parameters of each model.</span>
</span><span id="calculate_likelihood-34"><a href="#calculate_likelihood-34"><span class="linenos"> 34</span></a><span class="sd">    Can select and continue the analysis of nested grids through the keyword &#39;fixed_params&#39;.</span>
</span><span id="calculate_likelihood-35"><a href="#calculate_likelihood-35"><span class="linenos"> 35</span></a>
</span><span id="calculate_likelihood-36"><a href="#calculate_likelihood-36"><span class="linenos"> 36</span></a><span class="sd">    Parameters</span>
</span><span id="calculate_likelihood-37"><a href="#calculate_likelihood-37"><span class="linenos"> 37</span></a><span class="sd">    ----------</span>
</span><span id="calculate_likelihood-38"><a href="#calculate_likelihood-38"><span class="linenos"> 38</span></a><span class="sd">    obs_path: string</span>
</span><span id="calculate_likelihood-39"><a href="#calculate_likelihood-39"><span class="linenos"> 39</span></a><span class="sd">        Path to the tsv file with observations, with a column for each observable and each set of errors.</span>
</span><span id="calculate_likelihood-40"><a href="#calculate_likelihood-40"><span class="linenos"> 40</span></a><span class="sd">        Column names specify the observable, and &quot;_err&quot; suffix denotes that it&#39;s the error.</span>
</span><span id="calculate_likelihood-41"><a href="#calculate_likelihood-41"><span class="linenos"> 41</span></a><span class="sd">    theory_file: string</span>
</span><span id="calculate_likelihood-42"><a href="#calculate_likelihood-42"><span class="linenos"> 42</span></a><span class="sd">        Path to the hdf5 file with the theoretical model input parameters (first set of columns), frequency or period values (last set of columns),</span>
</span><span id="calculate_likelihood-43"><a href="#calculate_likelihood-43"><span class="linenos"> 43</span></a><span class="sd">        and possibly extra columns with additional observables (these columns should be in between the input parameters and frequency columns).</span>
</span><span id="calculate_likelihood-44"><a href="#calculate_likelihood-44"><span class="linenos"> 44</span></a><span class="sd">    observables: list of strings</span>
</span><span id="calculate_likelihood-45"><a href="#calculate_likelihood-45"><span class="linenos"> 45</span></a><span class="sd">        Which observables are included in the merit function.</span>
</span><span id="calculate_likelihood-46"><a href="#calculate_likelihood-46"><span class="linenos"> 46</span></a><span class="sd">        Must contain either &#39;f&#39; (frequency), &#39;P&#39; (period), or &#39;dP&#39; (period-spacing) which will be computed for the period pattern.</span>
</span><span id="calculate_likelihood-47"><a href="#calculate_likelihood-47"><span class="linenos"> 47</span></a><span class="sd">        Can contain any additional observables that are added as columns in both the file with observations and the file with theoretical models.</span>
</span><span id="calculate_likelihood-48"><a href="#calculate_likelihood-48"><span class="linenos"> 48</span></a><span class="sd">    merit_function: string</span>
</span><span id="calculate_likelihood-49"><a href="#calculate_likelihood-49"><span class="linenos"> 49</span></a><span class="sd">        The type of merit function to use. Currently supports &quot;CS and &quot;MD&quot; (&quot;chi-squared&quot; and &quot;mahalanobis distance&quot;).</span>
</span><span id="calculate_likelihood-50"><a href="#calculate_likelihood-50"><span class="linenos"> 50</span></a><span class="sd">    star_name: string</span>
</span><span id="calculate_likelihood-51"><a href="#calculate_likelihood-51"><span class="linenos"> 51</span></a><span class="sd">        Name of the star, used in file naming.</span>
</span><span id="calculate_likelihood-52"><a href="#calculate_likelihood-52"><span class="linenos"> 52</span></a><span class="sd">    fixed_params: dict</span>
</span><span id="calculate_likelihood-53"><a href="#calculate_likelihood-53"><span class="linenos"> 53</span></a><span class="sd">        Only select and analyse the part of the theoretical grid with the specified parameter values.</span>
</span><span id="calculate_likelihood-54"><a href="#calculate_likelihood-54"><span class="linenos"> 54</span></a><span class="sd">        The keys specify for which parameters only the specified value should be selected.</span>
</span><span id="calculate_likelihood-55"><a href="#calculate_likelihood-55"><span class="linenos"> 55</span></a><span class="sd">    grid_parameters: list of string</span>
</span><span id="calculate_likelihood-56"><a href="#calculate_likelihood-56"><span class="linenos"> 56</span></a><span class="sd">        List of the parameters in the theoretical grid.</span>
</span><span id="calculate_likelihood-57"><a href="#calculate_likelihood-57"><span class="linenos"> 57</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="calculate_likelihood-58"><a href="#calculate_likelihood-58"><span class="linenos"> 58</span></a>    <span class="k">if</span> <span class="s2">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="calculate_likelihood-59"><a href="#calculate_likelihood-59"><span class="linenos"> 59</span></a>        <span class="n">observed_quantity</span> <span class="o">=</span> <span class="s2">&quot;frequency&quot;</span>
</span><span id="calculate_likelihood-60"><a href="#calculate_likelihood-60"><span class="linenos"> 60</span></a>    <span class="k">elif</span> <span class="s2">&quot;P&quot;</span> <span class="ow">or</span> <span class="s2">&quot;dP&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="calculate_likelihood-61"><a href="#calculate_likelihood-61"><span class="linenos"> 61</span></a>        <span class="n">observed_quantity</span> <span class="o">=</span> <span class="s2">&quot;period&quot;</span>
</span><span id="calculate_likelihood-62"><a href="#calculate_likelihood-62"><span class="linenos"> 62</span></a>    <span class="c1"># Read in the observed data and make an array of the observed observables</span>
</span><span id="calculate_likelihood-63"><a href="#calculate_likelihood-63"><span class="linenos"> 63</span></a>    <span class="n">obs_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">obs_path</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="calculate_likelihood-64"><a href="#calculate_likelihood-64"><span class="linenos"> 64</span></a>    <span class="n">obs</span><span class="p">,</span> <span class="n">obs_err</span><span class="p">,</span> <span class="n">file_suffix_observables</span> <span class="o">=</span> <span class="n">create_obs_observables_array</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">,</span> <span class="n">observables</span><span class="p">)</span>
</span><span id="calculate_likelihood-65"><a href="#calculate_likelihood-65"><span class="linenos"> 65</span></a>
</span><span id="calculate_likelihood-66"><a href="#calculate_likelihood-66"><span class="linenos"> 66</span></a>    <span class="c1"># set the name of the output file</span>
</span><span id="calculate_likelihood-67"><a href="#calculate_likelihood-67"><span class="linenos"> 67</span></a>    <span class="n">_</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">split_line</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">theory_file</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="n">star_name</span><span class="p">)</span>
</span><span id="calculate_likelihood-68"><a href="#calculate_likelihood-68"><span class="linenos"> 68</span></a>    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">star_name</span><span class="si">}{</span><span class="n">tail</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">merit_function</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_suffix_observables</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="calculate_likelihood-69"><a href="#calculate_likelihood-69"><span class="linenos"> 69</span></a>
</span><span id="calculate_likelihood-70"><a href="#calculate_likelihood-70"><span class="linenos"> 70</span></a>    <span class="c1"># Theoretical grid data</span>
</span><span id="calculate_likelihood-71"><a href="#calculate_likelihood-71"><span class="linenos"> 71</span></a>    <span class="n">theory_dataframe</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">get_subgrid_dataframe</span><span class="p">(</span><span class="n">theory_file</span><span class="p">,</span> <span class="n">fixed_params</span><span class="p">)</span>
</span><span id="calculate_likelihood-72"><a href="#calculate_likelihood-72"><span class="linenos"> 72</span></a>
</span><span id="calculate_likelihood-73"><a href="#calculate_likelihood-73"><span class="linenos"> 73</span></a>    <span class="c1"># get the interruptions in the pattern, absolute index in dataframe</span>
</span><span id="calculate_likelihood-74"><a href="#calculate_likelihood-74"><span class="linenos"> 74</span></a>    <span class="n">missing_absolute</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">observed_quantity</span><span class="si">}</span><span class="s2">_missing&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="calculate_likelihood-75"><a href="#calculate_likelihood-75"><span class="linenos"> 75</span></a>    <span class="c1"># get the interruptions in the pattern, index relative within pulsations</span>
</span><span id="calculate_likelihood-76"><a href="#calculate_likelihood-76"><span class="linenos"> 76</span></a>    <span class="n">missing_relative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="calculate_likelihood-77"><a href="#calculate_likelihood-77"><span class="linenos"> 77</span></a>        <span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">observed_quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="calculate_likelihood-78"><a href="#calculate_likelihood-78"><span class="linenos"> 78</span></a>        <span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span>
</span><span id="calculate_likelihood-79"><a href="#calculate_likelihood-79"><span class="linenos"> 79</span></a>        <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">observed_quantity</span><span class="si">}</span><span class="s2">_missing&quot;</span><span class="p">)</span>
</span><span id="calculate_likelihood-80"><a href="#calculate_likelihood-80"><span class="linenos"> 80</span></a>    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="calculate_likelihood-81"><a href="#calculate_likelihood-81"><span class="linenos"> 81</span></a>    <span class="c1"># Remove columns of missing frequencies</span>
</span><span id="calculate_likelihood-82"><a href="#calculate_likelihood-82"><span class="linenos"> 82</span></a>    <span class="n">theory_dataframe</span> <span class="o">=</span> <span class="n">theory_dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">missing_absolute</span><span class="p">])</span>
</span><span id="calculate_likelihood-83"><a href="#calculate_likelihood-83"><span class="linenos"> 83</span></a>    <span class="c1"># Adjust indices for removed lines of missing frequencies</span>
</span><span id="calculate_likelihood-84"><a href="#calculate_likelihood-84"><span class="linenos"> 84</span></a>    <span class="n">missing_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">missing_relative</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_relative</span><span class="p">))]</span>
</span><span id="calculate_likelihood-85"><a href="#calculate_likelihood-85"><span class="linenos"> 85</span></a>
</span><span id="calculate_likelihood-86"><a href="#calculate_likelihood-86"><span class="linenos"> 86</span></a>    <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">([</span><span class="s2">&quot;rot&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;rot_err&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">grid_parameters</span><span class="p">))</span>
</span><span id="calculate_likelihood-87"><a href="#calculate_likelihood-87"><span class="linenos"> 87</span></a>    <span class="n">theory_puls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">observed_quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="calculate_likelihood-88"><a href="#calculate_likelihood-88"><span class="linenos"> 88</span></a>
</span><span id="calculate_likelihood-89"><a href="#calculate_likelihood-89"><span class="linenos"> 89</span></a>    <span class="c1"># Make new list of theoretical models without entries with value -1</span>
</span><span id="calculate_likelihood-90"><a href="#calculate_likelihood-90"><span class="linenos"> 90</span></a>    <span class="n">new_theory</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="calculate_likelihood-91"><a href="#calculate_likelihood-91"><span class="linenos"> 91</span></a>    <span class="n">new_thetas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="calculate_likelihood-92"><a href="#calculate_likelihood-92"><span class="linenos"> 92</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">theory_puls</span><span class="p">)):</span>
</span><span id="calculate_likelihood-93"><a href="#calculate_likelihood-93"><span class="linenos"> 93</span></a>        <span class="c1"># ignore models where one of the freqs is -1</span>
</span><span id="calculate_likelihood-94"><a href="#calculate_likelihood-94"><span class="linenos"> 94</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">theory_puls</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">theory_puls</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="calculate_likelihood-95"><a href="#calculate_likelihood-95"><span class="linenos"> 95</span></a>            <span class="c1"># make an array of the theoretical observables for each model</span>
</span><span id="calculate_likelihood-96"><a href="#calculate_likelihood-96"><span class="linenos"> 96</span></a>            <span class="n">theory_observables</span> <span class="o">=</span> <span class="n">create_theory_observables_array</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">observables</span><span class="p">,</span> <span class="n">missing_indices</span><span class="p">)</span>
</span><span id="calculate_likelihood-97"><a href="#calculate_likelihood-97"><span class="linenos"> 97</span></a>
</span><span id="calculate_likelihood-98"><a href="#calculate_likelihood-98"><span class="linenos"> 98</span></a>            <span class="n">new_theory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theory_observables</span><span class="p">)</span>
</span><span id="calculate_likelihood-99"><a href="#calculate_likelihood-99"><span class="linenos"> 99</span></a>            <span class="n">new_thetas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thetas</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="calculate_likelihood-100"><a href="#calculate_likelihood-100"><span class="linenos">100</span></a>    <span class="n">neg_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theory_puls</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="calculate_likelihood-101"><a href="#calculate_likelihood-101"><span class="linenos">101</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File: </span><span class="si">{</span><span class="n">theory_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="calculate_likelihood-102"><a href="#calculate_likelihood-102"><span class="linenos">102</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;observables      : </span><span class="si">{</span><span class="n">observables</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="calculate_likelihood-103"><a href="#calculate_likelihood-103"><span class="linenos">103</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ignored -1 freqs : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">neg_value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="calculate_likelihood-104"><a href="#calculate_likelihood-104"><span class="linenos">104</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;original #models : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">theory_puls</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="calculate_likelihood-105"><a href="#calculate_likelihood-105"><span class="linenos">105</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;remaining #models: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">new_theory</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="calculate_likelihood-106"><a href="#calculate_likelihood-106"><span class="linenos">106</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neg_value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="calculate_likelihood-107"><a href="#calculate_likelihood-107"><span class="linenos">107</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="calculate_likelihood-108"><a href="#calculate_likelihood-108"><span class="linenos">108</span></a>            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">neg_value</span><span class="p">)</span><span class="si">}</span><span class="s2"> models were discarded due to mismatches during the selection of theoretical frequencies.</span>
</span><span id="calculate_likelihood-109"><a href="#calculate_likelihood-109"><span class="linenos">109</span></a><span class="s2">                        This is likely due to the frequency range used for the theoretical calculations being too narrow.&quot;&quot;&quot;</span>
</span><span id="calculate_likelihood-110"><a href="#calculate_likelihood-110"><span class="linenos">110</span></a>        <span class="p">)</span>
</span><span id="calculate_likelihood-111"><a href="#calculate_likelihood-111"><span class="linenos">111</span></a>    <span class="n">new_theory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_theory</span><span class="p">)</span>
</span><span id="calculate_likelihood-112"><a href="#calculate_likelihood-112"><span class="linenos">112</span></a>    <span class="n">new_thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_thetas</span><span class="p">)</span>
</span><span id="calculate_likelihood-113"><a href="#calculate_likelihood-113"><span class="linenos">113</span></a>
</span><span id="calculate_likelihood-114"><a href="#calculate_likelihood-114"><span class="linenos">114</span></a>    <span class="c1"># Dictionary containing different merit functions</span>
</span><span id="calculate_likelihood-115"><a href="#calculate_likelihood-115"><span class="linenos">115</span></a>    <span class="n">switcher</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;CS&quot;</span><span class="p">:</span> <span class="n">merit_chi2</span><span class="p">,</span> <span class="s2">&quot;MD&quot;</span><span class="p">:</span> <span class="n">merit_mahalanobis</span><span class="p">}</span>
</span><span id="calculate_likelihood-116"><a href="#calculate_likelihood-116"><span class="linenos">116</span></a>
</span><span id="calculate_likelihood-117"><a href="#calculate_likelihood-117"><span class="linenos">117</span></a>    <span class="c1"># get the desired function from the dictionary. Returns the lambda function if option is not in the dictionary.</span>
</span><span id="calculate_likelihood-118"><a href="#calculate_likelihood-118"><span class="linenos">118</span></a>    <span class="n">selected_merit_function</span> <span class="o">=</span> <span class="n">switcher</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="calculate_likelihood-119"><a href="#calculate_likelihood-119"><span class="linenos">119</span></a>        <span class="n">merit_function</span><span class="p">,</span>
</span><span id="calculate_likelihood-120"><a href="#calculate_likelihood-120"><span class="linenos">120</span></a>        <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;invalid type of maximum likelihood estimator&quot;</span><span class="p">)),</span>
</span><span id="calculate_likelihood-121"><a href="#calculate_likelihood-121"><span class="linenos">121</span></a>    <span class="p">)</span>
</span><span id="calculate_likelihood-122"><a href="#calculate_likelihood-122"><span class="linenos">122</span></a>    <span class="n">merit_values</span> <span class="o">=</span> <span class="n">selected_merit_function</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">obs_err</span><span class="p">,</span> <span class="n">new_theory</span><span class="p">,</span> <span class="n">fig_title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">star_name</span><span class="o">=</span><span class="n">star_name</span><span class="p">)</span>
</span><span id="calculate_likelihood-123"><a href="#calculate_likelihood-123"><span class="linenos">123</span></a>
</span><span id="calculate_likelihood-124"><a href="#calculate_likelihood-124"><span class="linenos">124</span></a>    <span class="c1"># Combine values and save the results</span>
</span><span id="calculate_likelihood-125"><a href="#calculate_likelihood-125"><span class="linenos">125</span></a>    <span class="c1"># add an additional column for MLE &#39;meritValues&#39;</span>
</span><span id="calculate_likelihood-126"><a href="#calculate_likelihood-126"><span class="linenos">126</span></a>    <span class="n">combined_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">merit_values</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">new_thetas</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="calculate_likelihood-127"><a href="#calculate_likelihood-127"><span class="linenos">127</span></a>    <span class="c1"># put the data in a pandas DataFrame</span>
</span><span id="calculate_likelihood-128"><a href="#calculate_likelihood-128"><span class="linenos">128</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">combined_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;meritValue&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;rot_err&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">grid_parameters</span><span class="p">)</span>
</span><span id="calculate_likelihood-129"><a href="#calculate_likelihood-129"><span class="linenos">129</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="calculate_likelihood-130"><a href="#calculate_likelihood-130"><span class="linenos">130</span></a>        <span class="n">df</span><span class="p">,</span>
</span><span id="calculate_likelihood-131"><a href="#calculate_likelihood-131"><span class="linenos">131</span></a>        <span class="n">theory_dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">observed_quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
</span><span id="calculate_likelihood-132"><a href="#calculate_likelihood-132"><span class="linenos">132</span></a>        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
</span><span id="calculate_likelihood-133"><a href="#calculate_likelihood-133"><span class="linenos">133</span></a>        <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">,</span> <span class="s2">&quot;rot_err&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">grid_parameters</span><span class="p">,</span>
</span><span id="calculate_likelihood-134"><a href="#calculate_likelihood-134"><span class="linenos">134</span></a>    <span class="p">)</span>
</span><span id="calculate_likelihood-135"><a href="#calculate_likelihood-135"><span class="linenos">135</span></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">/meritvalues/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.hdf&quot;</span><span class="p">,</span> <span class="s2">&quot;merit_values&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform a maximum likelihood estimation using the provided type of merit function on the list of observables.
Writes a data file with the values of the merit function and input parameters of each model.
Can select and continue the analysis of nested grids through the keyword 'fixed_params'.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>obs_path</strong> (string):
Path to the tsv file with observations, with a column for each observable and each set of errors.
Column names specify the observable, and "_err" suffix denotes that it's the error.</li>
<li><strong>theory_file</strong> (string):
Path to the hdf5 file with the theoretical model input parameters (first set of columns), frequency or period values (last set of columns),
and possibly extra columns with additional observables (these columns should be in between the input parameters and frequency columns).</li>
<li><strong>observables</strong> (list of strings):
Which observables are included in the merit function.
Must contain either 'f' (frequency), 'P' (period), or 'dP' (period-spacing) which will be computed for the period pattern.
Can contain any additional observables that are added as columns in both the file with observations and the file with theoretical models.</li>
<li><strong>merit_function</strong> (string):
The type of merit function to use. Currently supports "CS and "MD" ("chi-squared" and "mahalanobis distance").</li>
<li><strong>star_name</strong> (string):
Name of the star, used in file naming.</li>
<li><strong>fixed_params</strong> (dict):
Only select and analyse the part of the theoretical grid with the specified parameter values.
The keys specify for which parameters only the specified value should be selected.</li>
<li><strong>grid_parameters</strong> (list of string):
List of the parameters in the theoretical grid.</li>
</ul>
</div>


                </section>
                <section id="create_theory_observables_array">
                            <input id="create_theory_observables_array-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_theory_observables_array</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">theory_dataframe</span>, </span><span class="param"><span class="n">index</span>, </span><span class="param"><span class="n">observables_in</span>, </span><span class="param"><span class="n">missing_indices</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="create_theory_observables_array-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_theory_observables_array"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_theory_observables_array-140"><a href="#create_theory_observables_array-140"><span class="linenos">140</span></a><span class="k">def</span> <span class="nf">create_theory_observables_array</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">observables_in</span><span class="p">,</span> <span class="n">missing_indices</span><span class="p">):</span>
</span><span id="create_theory_observables_array-141"><a href="#create_theory_observables_array-141"><span class="linenos">141</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="create_theory_observables_array-142"><a href="#create_theory_observables_array-142"><span class="linenos">142</span></a><span class="sd">    Create an array of theoretical observables.</span>
</span><span id="create_theory_observables_array-143"><a href="#create_theory_observables_array-143"><span class="linenos">143</span></a>
</span><span id="create_theory_observables_array-144"><a href="#create_theory_observables_array-144"><span class="linenos">144</span></a><span class="sd">    Parameters</span>
</span><span id="create_theory_observables_array-145"><a href="#create_theory_observables_array-145"><span class="linenos">145</span></a><span class="sd">    ----------</span>
</span><span id="create_theory_observables_array-146"><a href="#create_theory_observables_array-146"><span class="linenos">146</span></a><span class="sd">    theory_dataframe: pandas dataFrame</span>
</span><span id="create_theory_observables_array-147"><a href="#create_theory_observables_array-147"><span class="linenos">147</span></a><span class="sd">        DataFrame containing the theoretical periods or frequencies (as the last columns), along with any additional</span>
</span><span id="create_theory_observables_array-148"><a href="#create_theory_observables_array-148"><span class="linenos">148</span></a><span class="sd">        columns containing extra observables.</span>
</span><span id="create_theory_observables_array-149"><a href="#create_theory_observables_array-149"><span class="linenos">149</span></a><span class="sd">    index: int</span>
</span><span id="create_theory_observables_array-150"><a href="#create_theory_observables_array-150"><span class="linenos">150</span></a><span class="sd">        Row index in the dataFrame of the theoretical model to make the array for.</span>
</span><span id="create_theory_observables_array-151"><a href="#create_theory_observables_array-151"><span class="linenos">151</span></a><span class="sd">    observables_in: list of strings</span>
</span><span id="create_theory_observables_array-152"><a href="#create_theory_observables_array-152"><span class="linenos">152</span></a><span class="sd">        Which observables are included in the returned array.</span>
</span><span id="create_theory_observables_array-153"><a href="#create_theory_observables_array-153"><span class="linenos">153</span></a><span class="sd">        Must contain either &#39;f&#39; (frequency), &#39;P&#39; (period), or &#39;dP&#39; (period-spacing) which will be computed for the period pattern.</span>
</span><span id="create_theory_observables_array-154"><a href="#create_theory_observables_array-154"><span class="linenos">154</span></a><span class="sd">        Can contain any additional observables that are added as columns in both the file with observations and the file with theoretical models.</span>
</span><span id="create_theory_observables_array-155"><a href="#create_theory_observables_array-155"><span class="linenos">155</span></a><span class="sd">    missing_indices: list of int</span>
</span><span id="create_theory_observables_array-156"><a href="#create_theory_observables_array-156"><span class="linenos">156</span></a><span class="sd">        Contains the indices of the missing pulsations so that the period spacing pattern can be split around them.</span>
</span><span id="create_theory_observables_array-157"><a href="#create_theory_observables_array-157"><span class="linenos">157</span></a>
</span><span id="create_theory_observables_array-158"><a href="#create_theory_observables_array-158"><span class="linenos">158</span></a><span class="sd">    Returns</span>
</span><span id="create_theory_observables_array-159"><a href="#create_theory_observables_array-159"><span class="linenos">159</span></a><span class="sd">    ----------</span>
</span><span id="create_theory_observables_array-160"><a href="#create_theory_observables_array-160"><span class="linenos">160</span></a><span class="sd">    observables_out: numpy array, dtype=float</span>
</span><span id="create_theory_observables_array-161"><a href="#create_theory_observables_array-161"><span class="linenos">161</span></a><span class="sd">        The values of the specified observables for the model.</span>
</span><span id="create_theory_observables_array-162"><a href="#create_theory_observables_array-162"><span class="linenos">162</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="create_theory_observables_array-163"><a href="#create_theory_observables_array-163"><span class="linenos">163</span></a>    <span class="c1"># Make a copy to leave the array handed to this function unaltered.</span>
</span><span id="create_theory_observables_array-164"><a href="#create_theory_observables_array-164"><span class="linenos">164</span></a>    <span class="n">observables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">observables_in</span><span class="p">)</span>
</span><span id="create_theory_observables_array-165"><a href="#create_theory_observables_array-165"><span class="linenos">165</span></a>    <span class="k">if</span> <span class="s2">&quot;P&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="create_theory_observables_array-166"><a href="#create_theory_observables_array-166"><span class="linenos">166</span></a>        <span class="c1"># Cast to list before using asarray to prevent memory leak</span>
</span><span id="create_theory_observables_array-167"><a href="#create_theory_observables_array-167"><span class="linenos">167</span></a>        <span class="c1"># add the periods to the output list</span>
</span><span id="create_theory_observables_array-168"><a href="#create_theory_observables_array-168"><span class="linenos">168</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;period&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
</span><span id="create_theory_observables_array-169"><a href="#create_theory_observables_array-169"><span class="linenos">169</span></a>        <span class="n">observables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>
</span><span id="create_theory_observables_array-170"><a href="#create_theory_observables_array-170"><span class="linenos">170</span></a>
</span><span id="create_theory_observables_array-171"><a href="#create_theory_observables_array-171"><span class="linenos">171</span></a>    <span class="k">elif</span> <span class="s2">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="create_theory_observables_array-172"><a href="#create_theory_observables_array-172"><span class="linenos">172</span></a>        <span class="c1"># Cast to list before using asarray to prevent memory leak</span>
</span><span id="create_theory_observables_array-173"><a href="#create_theory_observables_array-173"><span class="linenos">173</span></a>        <span class="c1"># add the frequencies to the output list</span>
</span><span id="create_theory_observables_array-174"><a href="#create_theory_observables_array-174"><span class="linenos">174</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;frequency&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
</span><span id="create_theory_observables_array-175"><a href="#create_theory_observables_array-175"><span class="linenos">175</span></a>        <span class="n">observables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
</span><span id="create_theory_observables_array-176"><a href="#create_theory_observables_array-176"><span class="linenos">176</span></a>
</span><span id="create_theory_observables_array-177"><a href="#create_theory_observables_array-177"><span class="linenos">177</span></a>    <span class="k">elif</span> <span class="s2">&quot;dP&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="create_theory_observables_array-178"><a href="#create_theory_observables_array-178"><span class="linenos">178</span></a>        <span class="n">periods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s2">&quot;period&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
</span><span id="create_theory_observables_array-179"><a href="#create_theory_observables_array-179"><span class="linenos">179</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="create_theory_observables_array-180"><a href="#create_theory_observables_array-180"><span class="linenos">180</span></a>        <span class="k">for</span> <span class="n">periods_part</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">missing_indices</span><span class="p">):</span>
</span><span id="create_theory_observables_array-181"><a href="#create_theory_observables_array-181"><span class="linenos">181</span></a>            <span class="n">spacing</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">bop</span><span class="o">.</span><span class="n">generate_spacing_series</span><span class="p">(</span><span class="n">periods_part</span><span class="p">)</span>
</span><span id="create_theory_observables_array-182"><a href="#create_theory_observables_array-182"><span class="linenos">182</span></a>            <span class="c1"># switch back from seconds to days (so both P and dP are in days)</span>
</span><span id="create_theory_observables_array-183"><a href="#create_theory_observables_array-183"><span class="linenos">183</span></a>            <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spacing</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span>
</span><span id="create_theory_observables_array-184"><a href="#create_theory_observables_array-184"><span class="linenos">184</span></a>        <span class="n">observables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;dP&quot;</span><span class="p">)</span>
</span><span id="create_theory_observables_array-185"><a href="#create_theory_observables_array-185"><span class="linenos">185</span></a>
</span><span id="create_theory_observables_array-186"><a href="#create_theory_observables_array-186"><span class="linenos">186</span></a>    <span class="c1"># Add all other observables in the list from the dataFrame</span>
</span><span id="create_theory_observables_array-187"><a href="#create_theory_observables_array-187"><span class="linenos">187</span></a>    <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="create_theory_observables_array-188"><a href="#create_theory_observables_array-188"><span class="linenos">188</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theory_dataframe</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">observable</span><span class="p">]))</span>
</span><span id="create_theory_observables_array-189"><a href="#create_theory_observables_array-189"><span class="linenos">189</span></a>
</span><span id="create_theory_observables_array-190"><a href="#create_theory_observables_array-190"><span class="linenos">190</span></a>    <span class="k">return</span> <span class="n">observables_out</span>
</span></pre></div>


            <div class="docstring"><p>Create an array of theoretical observables.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>theory_dataframe</strong> (pandas dataFrame):
DataFrame containing the theoretical periods or frequencies (as the last columns), along with any additional
columns containing extra observables.</li>
<li><strong>index</strong> (int):
Row index in the dataFrame of the theoretical model to make the array for.</li>
<li><strong>observables_in</strong> (list of strings):
Which observables are included in the returned array.
Must contain either 'f' (frequency), 'P' (period), or 'dP' (period-spacing) which will be computed for the period pattern.
Can contain any additional observables that are added as columns in both the file with observations and the file with theoretical models.</li>
<li><strong>missing_indices</strong> (list of int):
Contains the indices of the missing pulsations so that the period spacing pattern can be split around them.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>observables_out</strong> (numpy array, dtype=float):
The values of the specified observables for the model.</li>
</ul>
</div>


                </section>
                <section id="create_obs_observables_array">
                            <input id="create_obs_observables_array-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_obs_observables_array</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obs_dataframe</span>, </span><span class="param"><span class="n">observables</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="create_obs_observables_array-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_obs_observables_array"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_obs_observables_array-194"><a href="#create_obs_observables_array-194"><span class="linenos">194</span></a><span class="k">def</span> <span class="nf">create_obs_observables_array</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">,</span> <span class="n">observables</span><span class="p">):</span>
</span><span id="create_obs_observables_array-195"><a href="#create_obs_observables_array-195"><span class="linenos">195</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="create_obs_observables_array-196"><a href="#create_obs_observables_array-196"><span class="linenos">196</span></a><span class="sd">    Create an array of the observed observables.</span>
</span><span id="create_obs_observables_array-197"><a href="#create_obs_observables_array-197"><span class="linenos">197</span></a>
</span><span id="create_obs_observables_array-198"><a href="#create_obs_observables_array-198"><span class="linenos">198</span></a><span class="sd">    Parameters</span>
</span><span id="create_obs_observables_array-199"><a href="#create_obs_observables_array-199"><span class="linenos">199</span></a><span class="sd">    ----------</span>
</span><span id="create_obs_observables_array-200"><a href="#create_obs_observables_array-200"><span class="linenos">200</span></a><span class="sd">    obs_dataframe: pandas dataFrame</span>
</span><span id="create_obs_observables_array-201"><a href="#create_obs_observables_array-201"><span class="linenos">201</span></a><span class="sd">        DataFrame containing the theoretical frequencies, periods, and any additional observables as columns, as well as columns with their errors.</span>
</span><span id="create_obs_observables_array-202"><a href="#create_obs_observables_array-202"><span class="linenos">202</span></a><span class="sd">        Column names specify the observable, and &quot;_err&quot; suffix denotes that it&#39;s the error.</span>
</span><span id="create_obs_observables_array-203"><a href="#create_obs_observables_array-203"><span class="linenos">203</span></a><span class="sd">    observables: list of strings</span>
</span><span id="create_obs_observables_array-204"><a href="#create_obs_observables_array-204"><span class="linenos">204</span></a><span class="sd">        Which observables are included in the returned array.</span>
</span><span id="create_obs_observables_array-205"><a href="#create_obs_observables_array-205"><span class="linenos">205</span></a><span class="sd">        Must contain either &#39;f&#39; (frequency), &#39;P&#39; (period), or &#39;dP&#39; (period-spacing) which will be computed for the period pattern.</span>
</span><span id="create_obs_observables_array-206"><a href="#create_obs_observables_array-206"><span class="linenos">206</span></a><span class="sd">        Can contain any additional observables that are added as columns in both the file with observations and the file with theoretical models.</span>
</span><span id="create_obs_observables_array-207"><a href="#create_obs_observables_array-207"><span class="linenos">207</span></a>
</span><span id="create_obs_observables_array-208"><a href="#create_obs_observables_array-208"><span class="linenos">208</span></a><span class="sd">    Returns</span>
</span><span id="create_obs_observables_array-209"><a href="#create_obs_observables_array-209"><span class="linenos">209</span></a><span class="sd">    ----------</span>
</span><span id="create_obs_observables_array-210"><a href="#create_obs_observables_array-210"><span class="linenos">210</span></a><span class="sd">    observables_out: numpy array, dtype=float</span>
</span><span id="create_obs_observables_array-211"><a href="#create_obs_observables_array-211"><span class="linenos">211</span></a><span class="sd">        The values of the specified observables.</span>
</span><span id="create_obs_observables_array-212"><a href="#create_obs_observables_array-212"><span class="linenos">212</span></a><span class="sd">    observables_err_out: numpy array, dtype=float</span>
</span><span id="create_obs_observables_array-213"><a href="#create_obs_observables_array-213"><span class="linenos">213</span></a><span class="sd">        The errors on the values in observables_out.</span>
</span><span id="create_obs_observables_array-214"><a href="#create_obs_observables_array-214"><span class="linenos">214</span></a><span class="sd">    filename_suffix: string</span>
</span><span id="create_obs_observables_array-215"><a href="#create_obs_observables_array-215"><span class="linenos">215</span></a><span class="sd">        suffix for the filename, containing all the included observables, separated by &#39;-&#39;</span>
</span><span id="create_obs_observables_array-216"><a href="#create_obs_observables_array-216"><span class="linenos">216</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="create_obs_observables_array-217"><a href="#create_obs_observables_array-217"><span class="linenos">217</span></a>    <span class="c1"># get the interruptions in the pattern</span>
</span><span id="create_obs_observables_array-218"><a href="#create_obs_observables_array-218"><span class="linenos">218</span></a>    <span class="n">missing_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;f_missing&quot;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="create_obs_observables_array-219"><a href="#create_obs_observables_array-219"><span class="linenos">219</span></a>    <span class="c1"># Adjust indices for removed lines of missing frequencies</span>
</span><span id="create_obs_observables_array-220"><a href="#create_obs_observables_array-220"><span class="linenos">220</span></a>    <span class="n">missing_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">missing_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_indices</span><span class="p">))]</span>
</span><span id="create_obs_observables_array-221"><a href="#create_obs_observables_array-221"><span class="linenos">221</span></a>    <span class="c1"># remove lines indicating missing frequencies (if they are present)</span>
</span><span id="create_obs_observables_array-222"><a href="#create_obs_observables_array-222"><span class="linenos">222</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_indices</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="create_obs_observables_array-223"><a href="#create_obs_observables_array-223"><span class="linenos">223</span></a>        <span class="n">obs_dataframe</span> <span class="o">=</span> <span class="n">obs_dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;f_missing&quot;</span><span class="p">)</span>
</span><span id="create_obs_observables_array-224"><a href="#create_obs_observables_array-224"><span class="linenos">224</span></a>
</span><span id="create_obs_observables_array-225"><a href="#create_obs_observables_array-225"><span class="linenos">225</span></a>    <span class="n">observables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">observables</span><span class="p">)</span>  <span class="c1"># make a copy of the list, to not alter the one that was given to the function</span>
</span><span id="create_obs_observables_array-226"><a href="#create_obs_observables_array-226"><span class="linenos">226</span></a>    <span class="n">filename_suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="create_obs_observables_array-227"><a href="#create_obs_observables_array-227"><span class="linenos">227</span></a>
</span><span id="create_obs_observables_array-228"><a href="#create_obs_observables_array-228"><span class="linenos">228</span></a>    <span class="k">if</span> <span class="s2">&quot;P&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="create_obs_observables_array-229"><a href="#create_obs_observables_array-229"><span class="linenos">229</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">])</span>
</span><span id="create_obs_observables_array-230"><a href="#create_obs_observables_array-230"><span class="linenos">230</span></a>        <span class="n">observables_err_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="s2">&quot;period_err&quot;</span><span class="p">])</span>
</span><span id="create_obs_observables_array-231"><a href="#create_obs_observables_array-231"><span class="linenos">231</span></a>        <span class="n">filename_suffix</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span>
</span><span id="create_obs_observables_array-232"><a href="#create_obs_observables_array-232"><span class="linenos">232</span></a>        <span class="n">observables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>
</span><span id="create_obs_observables_array-233"><a href="#create_obs_observables_array-233"><span class="linenos">233</span></a>
</span><span id="create_obs_observables_array-234"><a href="#create_obs_observables_array-234"><span class="linenos">234</span></a>    <span class="k">elif</span> <span class="s2">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="create_obs_observables_array-235"><a href="#create_obs_observables_array-235"><span class="linenos">235</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">])</span>
</span><span id="create_obs_observables_array-236"><a href="#create_obs_observables_array-236"><span class="linenos">236</span></a>        <span class="n">observables_err_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="s2">&quot;frequency_err&quot;</span><span class="p">])</span>
</span><span id="create_obs_observables_array-237"><a href="#create_obs_observables_array-237"><span class="linenos">237</span></a>        <span class="n">filename_suffix</span> <span class="o">=</span> <span class="s2">&quot;f&quot;</span>
</span><span id="create_obs_observables_array-238"><a href="#create_obs_observables_array-238"><span class="linenos">238</span></a>        <span class="n">observables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
</span><span id="create_obs_observables_array-239"><a href="#create_obs_observables_array-239"><span class="linenos">239</span></a>
</span><span id="create_obs_observables_array-240"><a href="#create_obs_observables_array-240"><span class="linenos">240</span></a>    <span class="k">elif</span> <span class="s2">&quot;dP&quot;</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="create_obs_observables_array-241"><a href="#create_obs_observables_array-241"><span class="linenos">241</span></a>        <span class="n">observables_out</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="create_obs_observables_array-242"><a href="#create_obs_observables_array-242"><span class="linenos">242</span></a>        <span class="n">observables_err_out</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="create_obs_observables_array-243"><a href="#create_obs_observables_array-243"><span class="linenos">243</span></a>        <span class="n">period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">])</span>
</span><span id="create_obs_observables_array-244"><a href="#create_obs_observables_array-244"><span class="linenos">244</span></a>        <span class="n">period_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="s2">&quot;period_err&quot;</span><span class="p">])</span>
</span><span id="create_obs_observables_array-245"><a href="#create_obs_observables_array-245"><span class="linenos">245</span></a>        <span class="n">periods_parts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">missing_indices</span><span class="p">)</span>
</span><span id="create_obs_observables_array-246"><a href="#create_obs_observables_array-246"><span class="linenos">246</span></a>        <span class="n">periods_err_parts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">period_err</span><span class="p">,</span> <span class="n">missing_indices</span><span class="p">)</span>
</span><span id="create_obs_observables_array-247"><a href="#create_obs_observables_array-247"><span class="linenos">247</span></a>        <span class="k">for</span> <span class="n">periods</span><span class="p">,</span> <span class="n">periods_err</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">periods_parts</span><span class="p">,</span> <span class="n">periods_err_parts</span><span class="p">):</span>
</span><span id="create_obs_observables_array-248"><a href="#create_obs_observables_array-248"><span class="linenos">248</span></a>            <span class="n">spacing</span><span class="p">,</span> <span class="n">spacing_errs</span> <span class="o">=</span> <span class="n">bop</span><span class="o">.</span><span class="n">generate_spacing_series</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">periods_err</span><span class="p">)</span>
</span><span id="create_obs_observables_array-249"><a href="#create_obs_observables_array-249"><span class="linenos">249</span></a>            <span class="c1"># switch back from seconds to days (so both P and dP are in days)</span>
</span><span id="create_obs_observables_array-250"><a href="#create_obs_observables_array-250"><span class="linenos">250</span></a>            <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spacing</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span>
</span><span id="create_obs_observables_array-251"><a href="#create_obs_observables_array-251"><span class="linenos">251</span></a>            <span class="n">observables_err_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_err_out</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spacing_errs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span>
</span><span id="create_obs_observables_array-252"><a href="#create_obs_observables_array-252"><span class="linenos">252</span></a>
</span><span id="create_obs_observables_array-253"><a href="#create_obs_observables_array-253"><span class="linenos">253</span></a>        <span class="n">filename_suffix</span> <span class="o">=</span> <span class="s2">&quot;dP&quot;</span>
</span><span id="create_obs_observables_array-254"><a href="#create_obs_observables_array-254"><span class="linenos">254</span></a>        <span class="n">observables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;dP&quot;</span><span class="p">)</span>
</span><span id="create_obs_observables_array-255"><a href="#create_obs_observables_array-255"><span class="linenos">255</span></a>
</span><span id="create_obs_observables_array-256"><a href="#create_obs_observables_array-256"><span class="linenos">256</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">observables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="create_obs_observables_array-257"><a href="#create_obs_observables_array-257"><span class="linenos">257</span></a>        <span class="n">filename_suffix</span> <span class="o">+=</span> <span class="s2">&quot;+extra&quot;</span>
</span><span id="create_obs_observables_array-258"><a href="#create_obs_observables_array-258"><span class="linenos">258</span></a>    <span class="c1"># Add all other observables in the list from the dataFrame</span>
</span><span id="create_obs_observables_array-259"><a href="#create_obs_observables_array-259"><span class="linenos">259</span></a>    <span class="k">for</span> <span class="n">observable</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
</span><span id="create_obs_observables_array-260"><a href="#create_obs_observables_array-260"><span class="linenos">260</span></a>        <span class="n">logTeff</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="create_obs_observables_array-261"><a href="#create_obs_observables_array-261"><span class="linenos">261</span></a>        <span class="k">if</span> <span class="n">observable</span> <span class="o">==</span> <span class="s2">&quot;logTeff&quot;</span><span class="p">:</span>
</span><span id="create_obs_observables_array-262"><a href="#create_obs_observables_array-262"><span class="linenos">262</span></a>            <span class="c1"># To read it as Teff from the observations datafile</span>
</span><span id="create_obs_observables_array-263"><a href="#create_obs_observables_array-263"><span class="linenos">263</span></a>            <span class="n">observable</span> <span class="o">=</span> <span class="s2">&quot;Teff&quot;</span>
</span><span id="create_obs_observables_array-264"><a href="#create_obs_observables_array-264"><span class="linenos">264</span></a>            <span class="n">logTeff</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="create_obs_observables_array-265"><a href="#create_obs_observables_array-265"><span class="linenos">265</span></a>        <span class="c1"># since these columns have less entries, the dataFrame has NaNs in the empty rows</span>
</span><span id="create_obs_observables_array-266"><a href="#create_obs_observables_array-266"><span class="linenos">266</span></a>        <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="n">observable</span><span class="p">])</span>
</span><span id="create_obs_observables_array-267"><a href="#create_obs_observables_array-267"><span class="linenos">267</span></a>        <span class="c1"># remove all entries that are NaN in the numpy array</span>
</span><span id="create_obs_observables_array-268"><a href="#create_obs_observables_array-268"><span class="linenos">268</span></a>        <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">obs</span><span class="p">)]</span>
</span><span id="create_obs_observables_array-269"><a href="#create_obs_observables_array-269"><span class="linenos">269</span></a>        <span class="n">obs_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obs_dataframe</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">observable</span><span class="si">}</span><span class="s2">_err&quot;</span><span class="p">])</span>
</span><span id="create_obs_observables_array-270"><a href="#create_obs_observables_array-270"><span class="linenos">270</span></a>        <span class="n">obs_err</span> <span class="o">=</span> <span class="n">obs_err</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">obs_err</span><span class="p">)]</span>
</span><span id="create_obs_observables_array-271"><a href="#create_obs_observables_array-271"><span class="linenos">271</span></a>
</span><span id="create_obs_observables_array-272"><a href="#create_obs_observables_array-272"><span class="linenos">272</span></a>        <span class="c1"># Convert observed Teff and error to log values</span>
</span><span id="create_obs_observables_array-273"><a href="#create_obs_observables_array-273"><span class="linenos">273</span></a>        <span class="k">if</span> <span class="n">logTeff</span><span class="p">:</span>
</span><span id="create_obs_observables_array-274"><a href="#create_obs_observables_array-274"><span class="linenos">274</span></a>            <span class="n">logT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
</span><span id="create_obs_observables_array-275"><a href="#create_obs_observables_array-275"><span class="linenos">275</span></a>            <span class="n">logT_err</span> <span class="o">=</span> <span class="n">obs_err</span> <span class="o">/</span> <span class="p">(</span><span class="n">obs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</span><span id="create_obs_observables_array-276"><a href="#create_obs_observables_array-276"><span class="linenos">276</span></a>            <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_out</span><span class="p">,</span> <span class="n">logT</span><span class="p">)</span>
</span><span id="create_obs_observables_array-277"><a href="#create_obs_observables_array-277"><span class="linenos">277</span></a>            <span class="n">observables_err_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_err_out</span><span class="p">,</span> <span class="n">logT_err</span><span class="p">)</span>
</span><span id="create_obs_observables_array-278"><a href="#create_obs_observables_array-278"><span class="linenos">278</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="create_obs_observables_array-279"><a href="#create_obs_observables_array-279"><span class="linenos">279</span></a>            <span class="n">observables_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_out</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>
</span><span id="create_obs_observables_array-280"><a href="#create_obs_observables_array-280"><span class="linenos">280</span></a>            <span class="n">observables_err_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observables_err_out</span><span class="p">,</span> <span class="n">obs_err</span><span class="p">)</span>
</span><span id="create_obs_observables_array-281"><a href="#create_obs_observables_array-281"><span class="linenos">281</span></a>
</span><span id="create_obs_observables_array-282"><a href="#create_obs_observables_array-282"><span class="linenos">282</span></a>    <span class="k">return</span> <span class="n">observables_out</span><span class="p">,</span> <span class="n">observables_err_out</span><span class="p">,</span> <span class="n">filename_suffix</span>
</span></pre></div>


            <div class="docstring"><p>Create an array of the observed observables.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>obs_dataframe</strong> (pandas dataFrame):
DataFrame containing the theoretical frequencies, periods, and any additional observables as columns, as well as columns with their errors.
Column names specify the observable, and "_err" suffix denotes that it's the error.</li>
<li><strong>observables</strong> (list of strings):
Which observables are included in the returned array.
Must contain either 'f' (frequency), 'P' (period), or 'dP' (period-spacing) which will be computed for the period pattern.
Can contain any additional observables that are added as columns in both the file with observations and the file with theoretical models.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>observables_out</strong> (numpy array, dtype=float):
The values of the specified observables.</li>
<li><strong>observables_err_out</strong> (numpy array, dtype=float):
The errors on the values in observables_out.</li>
<li><strong>filename_suffix</strong> (string):
suffix for the filename, containing all the included observables, separated by '-'</li>
</ul>
</div>


                </section>
                <section id="merit_chi2">
                            <input id="merit_chi2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">merit_chi2</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">Yobs</span>, </span><span class="param"><span class="n">obs_err</span>, </span><span class="param"><span class="n">YTheo</span>, </span><span class="param"><span class="n">fig_title</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">star_name</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="merit_chi2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#merit_chi2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="merit_chi2-287"><a href="#merit_chi2-287"><span class="linenos">287</span></a><span class="k">def</span> <span class="nf">merit_chi2</span><span class="p">(</span><span class="n">Yobs</span><span class="p">,</span> <span class="n">obs_err</span><span class="p">,</span> <span class="n">YTheo</span><span class="p">,</span> <span class="n">fig_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">star_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="merit_chi2-288"><a href="#merit_chi2-288"><span class="linenos">288</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="merit_chi2-289"><a href="#merit_chi2-289"><span class="linenos">289</span></a><span class="sd">    Calculate chi squared values for the given theoretical patterns</span>
</span><span id="merit_chi2-290"><a href="#merit_chi2-290"><span class="linenos">290</span></a>
</span><span id="merit_chi2-291"><a href="#merit_chi2-291"><span class="linenos">291</span></a><span class="sd">    Parameters</span>
</span><span id="merit_chi2-292"><a href="#merit_chi2-292"><span class="linenos">292</span></a><span class="sd">    ----------</span>
</span><span id="merit_chi2-293"><a href="#merit_chi2-293"><span class="linenos">293</span></a><span class="sd">    Yobs: numpy array, dtype=float</span>
</span><span id="merit_chi2-294"><a href="#merit_chi2-294"><span class="linenos">294</span></a><span class="sd">        observed values (period or frequency)</span>
</span><span id="merit_chi2-295"><a href="#merit_chi2-295"><span class="linenos">295</span></a><span class="sd">    obs_err: numpy array, dtype=float</span>
</span><span id="merit_chi2-296"><a href="#merit_chi2-296"><span class="linenos">296</span></a><span class="sd">        Errors on Yobs</span>
</span><span id="merit_chi2-297"><a href="#merit_chi2-297"><span class="linenos">297</span></a><span class="sd">    YTheo: numpy ndarray (2D), dtype=float</span>
</span><span id="merit_chi2-298"><a href="#merit_chi2-298"><span class="linenos">298</span></a><span class="sd">        Array of all theoretical patterns to calculate the chi squared value for.</span>
</span><span id="merit_chi2-299"><a href="#merit_chi2-299"><span class="linenos">299</span></a><span class="sd">    fig_title: None</span>
</span><span id="merit_chi2-300"><a href="#merit_chi2-300"><span class="linenos">300</span></a><span class="sd">        Should not be used in this function, but is to make it analogous to merit_mahalanobis()</span>
</span><span id="merit_chi2-301"><a href="#merit_chi2-301"><span class="linenos">301</span></a><span class="sd">        and enable the use of the lambda function.</span>
</span><span id="merit_chi2-302"><a href="#merit_chi2-302"><span class="linenos">302</span></a><span class="sd">    star_name: None</span>
</span><span id="merit_chi2-303"><a href="#merit_chi2-303"><span class="linenos">303</span></a><span class="sd">        Should not be used in this function, but is to make it analogous to merit_mahalanobis()</span>
</span><span id="merit_chi2-304"><a href="#merit_chi2-304"><span class="linenos">304</span></a><span class="sd">        and enable the use of the lambda function.</span>
</span><span id="merit_chi2-305"><a href="#merit_chi2-305"><span class="linenos">305</span></a><span class="sd">    Returns</span>
</span><span id="merit_chi2-306"><a href="#merit_chi2-306"><span class="linenos">306</span></a><span class="sd">    ----------</span>
</span><span id="merit_chi2-307"><a href="#merit_chi2-307"><span class="linenos">307</span></a><span class="sd">    chi2: numpy array, dtype=float</span>
</span><span id="merit_chi2-308"><a href="#merit_chi2-308"><span class="linenos">308</span></a><span class="sd">        chi squared values for the given theoretical values</span>
</span><span id="merit_chi2-309"><a href="#merit_chi2-309"><span class="linenos">309</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="merit_chi2-310"><a href="#merit_chi2-310"><span class="linenos">310</span></a>    <span class="n">chi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">one_YTheo</span> <span class="o">-</span> <span class="n">Yobs</span><span class="p">)</span> <span class="o">/</span> <span class="n">obs_err</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">one_YTheo</span> <span class="ow">in</span> <span class="n">YTheo</span><span class="p">])</span>
</span><span id="merit_chi2-311"><a href="#merit_chi2-311"><span class="linenos">311</span></a>    <span class="k">return</span> <span class="n">chi2</span>
</span></pre></div>


            <div class="docstring"><p>Calculate chi squared values for the given theoretical patterns</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>Yobs</strong> (numpy array, dtype=float):
observed values (period or frequency)</li>
<li><strong>obs_err</strong> (numpy array, dtype=float):
Errors on Yobs</li>
<li><strong>YTheo</strong> (numpy ndarray (2D), dtype=float):
Array of all theoretical patterns to calculate the chi squared value for.</li>
<li><strong>fig_title</strong> (None):
Should not be used in this function, but is to make it analogous to merit_mahalanobis()
and enable the use of the lambda function.</li>
<li><strong>star_name</strong> (None):
Should not be used in this function, but is to make it analogous to merit_mahalanobis()
and enable the use of the lambda function.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>chi2</strong> (numpy array, dtype=float):
chi squared values for the given theoretical values</li>
</ul>
</div>


                </section>
                <section id="merit_mahalanobis">
                            <input id="merit_mahalanobis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">merit_mahalanobis</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">Yobs</span>,</span><span class="param">	<span class="n">obs_err</span>,</span><span class="param">	<span class="n">YTheo</span>,</span><span class="param">	<span class="n">generate_output</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">fig_title</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">star_name</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="merit_mahalanobis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#merit_mahalanobis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="merit_mahalanobis-315"><a href="#merit_mahalanobis-315"><span class="linenos">315</span></a><span class="k">def</span> <span class="nf">merit_mahalanobis</span><span class="p">(</span><span class="n">Yobs</span><span class="p">,</span> <span class="n">obs_err</span><span class="p">,</span> <span class="n">YTheo</span><span class="p">,</span> <span class="n">generate_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fig_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">star_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="merit_mahalanobis-316"><a href="#merit_mahalanobis-316"><span class="linenos">316</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="merit_mahalanobis-317"><a href="#merit_mahalanobis-317"><span class="linenos">317</span></a><span class="sd">    Calculate mahalanobis distance (MD) values for the given theoretical patterns.</span>
</span><span id="merit_mahalanobis-318"><a href="#merit_mahalanobis-318"><span class="linenos">318</span></a>
</span><span id="merit_mahalanobis-319"><a href="#merit_mahalanobis-319"><span class="linenos">319</span></a><span class="sd">    Parameters</span>
</span><span id="merit_mahalanobis-320"><a href="#merit_mahalanobis-320"><span class="linenos">320</span></a><span class="sd">    ----------</span>
</span><span id="merit_mahalanobis-321"><a href="#merit_mahalanobis-321"><span class="linenos">321</span></a><span class="sd">    Yobs: numpy array, dtype=float</span>
</span><span id="merit_mahalanobis-322"><a href="#merit_mahalanobis-322"><span class="linenos">322</span></a><span class="sd">        observed values (period or frequency)</span>
</span><span id="merit_mahalanobis-323"><a href="#merit_mahalanobis-323"><span class="linenos">323</span></a><span class="sd">    obs_err: numpy array, dtype=float</span>
</span><span id="merit_mahalanobis-324"><a href="#merit_mahalanobis-324"><span class="linenos">324</span></a><span class="sd">        Errors on Yobs</span>
</span><span id="merit_mahalanobis-325"><a href="#merit_mahalanobis-325"><span class="linenos">325</span></a><span class="sd">    YTheo: numpy array of arrays of floats</span>
</span><span id="merit_mahalanobis-326"><a href="#merit_mahalanobis-326"><span class="linenos">326</span></a><span class="sd">        Array of all theoretical patterns to calculate the MD value for.</span>
</span><span id="merit_mahalanobis-327"><a href="#merit_mahalanobis-327"><span class="linenos">327</span></a><span class="sd">    generate_output: boolean</span>
</span><span id="merit_mahalanobis-328"><a href="#merit_mahalanobis-328"><span class="linenos">328</span></a><span class="sd">        Flag to write output and plot the variance-covariance matrix</span>
</span><span id="merit_mahalanobis-329"><a href="#merit_mahalanobis-329"><span class="linenos">329</span></a><span class="sd">    fig_title: string</span>
</span><span id="merit_mahalanobis-330"><a href="#merit_mahalanobis-330"><span class="linenos">330</span></a><span class="sd">        The name of the figure to be created.</span>
</span><span id="merit_mahalanobis-331"><a href="#merit_mahalanobis-331"><span class="linenos">331</span></a><span class="sd">    star_name: string</span>
</span><span id="merit_mahalanobis-332"><a href="#merit_mahalanobis-332"><span class="linenos">332</span></a><span class="sd">        The name of the analysed star, for file naming purposes.</span>
</span><span id="merit_mahalanobis-333"><a href="#merit_mahalanobis-333"><span class="linenos">333</span></a>
</span><span id="merit_mahalanobis-334"><a href="#merit_mahalanobis-334"><span class="linenos">334</span></a><span class="sd">    Returns</span>
</span><span id="merit_mahalanobis-335"><a href="#merit_mahalanobis-335"><span class="linenos">335</span></a><span class="sd">    ----------</span>
</span><span id="merit_mahalanobis-336"><a href="#merit_mahalanobis-336"><span class="linenos">336</span></a><span class="sd">    MD: numpy array, dtype=float</span>
</span><span id="merit_mahalanobis-337"><a href="#merit_mahalanobis-337"><span class="linenos">337</span></a><span class="sd">        Mahalanobis distances for the given theoretical patterns.</span>
</span><span id="merit_mahalanobis-338"><a href="#merit_mahalanobis-338"><span class="linenos">338</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="merit_mahalanobis-339"><a href="#merit_mahalanobis-339"><span class="linenos">339</span></a>    <span class="c1"># Convert to matrix format (np.matrix is not recommended, use array and newaxis instead)</span>
</span><span id="merit_mahalanobis-340"><a href="#merit_mahalanobis-340"><span class="linenos">340</span></a>    <span class="n">YobsMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Yobs</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="merit_mahalanobis-341"><a href="#merit_mahalanobis-341"><span class="linenos">341</span></a>    <span class="n">YTheoMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">YTheo</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="merit_mahalanobis-342"><a href="#merit_mahalanobis-342"><span class="linenos">342</span></a>
</span><span id="merit_mahalanobis-343"><a href="#merit_mahalanobis-343"><span class="linenos">343</span></a>    <span class="c1"># Calculate the average on the theoretical values (e.g. frequencies)</span>
</span><span id="merit_mahalanobis-344"><a href="#merit_mahalanobis-344"><span class="linenos">344</span></a>    <span class="c1"># over the entire grid. Returns a vector of dimension N x 1</span>
</span><span id="merit_mahalanobis-345"><a href="#merit_mahalanobis-345"><span class="linenos">345</span></a>    <span class="n">Yav</span> <span class="o">=</span> <span class="n">YTheoMat</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="merit_mahalanobis-346"><a href="#merit_mahalanobis-346"><span class="linenos">346</span></a>
</span><span id="merit_mahalanobis-347"><a href="#merit_mahalanobis-347"><span class="linenos">347</span></a>    <span class="c1"># Calculate the variance-covariance matrix</span>
</span><span id="merit_mahalanobis-348"><a href="#merit_mahalanobis-348"><span class="linenos">348</span></a>    <span class="c1"># number of grid points</span>
</span><span id="merit_mahalanobis-349"><a href="#merit_mahalanobis-349"><span class="linenos">349</span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">YTheo</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="merit_mahalanobis-350"><a href="#merit_mahalanobis-350"><span class="linenos">350</span></a>    <span class="c1"># number of observed values</span>
</span><span id="merit_mahalanobis-351"><a href="#merit_mahalanobis-351"><span class="linenos">351</span></a>    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Yobs</span><span class="p">)</span>
</span><span id="merit_mahalanobis-352"><a href="#merit_mahalanobis-352"><span class="linenos">352</span></a>    <span class="n">v_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
</span><span id="merit_mahalanobis-353"><a href="#merit_mahalanobis-353"><span class="linenos">353</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="merit_mahalanobis-354"><a href="#merit_mahalanobis-354"><span class="linenos">354</span></a>        <span class="n">difference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">YTheoMat</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">Yav</span><span class="p">)</span>
</span><span id="merit_mahalanobis-355"><a href="#merit_mahalanobis-355"><span class="linenos">355</span></a>        <span class="n">v_matrix</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">difference</span><span class="p">,</span> <span class="n">difference</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="merit_mahalanobis-356"><a href="#merit_mahalanobis-356"><span class="linenos">356</span></a>    <span class="n">v_matrix</span> <span class="o">=</span> <span class="n">v_matrix</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="merit_mahalanobis-357"><a href="#merit_mahalanobis-357"><span class="linenos">357</span></a>
</span><span id="merit_mahalanobis-358"><a href="#merit_mahalanobis-358"><span class="linenos">358</span></a>    <span class="c1"># Include observational errors in the variance-covariance matrix</span>
</span><span id="merit_mahalanobis-359"><a href="#merit_mahalanobis-359"><span class="linenos">359</span></a>    <span class="n">v_matrix</span> <span class="o">=</span> <span class="n">v_matrix</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">obs_err</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
</span><span id="merit_mahalanobis-360"><a href="#merit_mahalanobis-360"><span class="linenos">360</span></a>    <span class="c1"># check if positive definite and make figure</span>
</span><span id="merit_mahalanobis-361"><a href="#merit_mahalanobis-361"><span class="linenos">361</span></a>    <span class="n">check_matrix</span><span class="p">(</span><span class="n">v_matrix</span><span class="p">,</span> <span class="n">generate_output</span><span class="o">=</span><span class="n">generate_output</span><span class="p">,</span> <span class="n">fig_title</span><span class="o">=</span><span class="n">fig_title</span><span class="p">,</span> <span class="n">star_name</span><span class="o">=</span><span class="n">star_name</span><span class="p">)</span>
</span><span id="merit_mahalanobis-362"><a href="#merit_mahalanobis-362"><span class="linenos">362</span></a>    <span class="c1"># Calculate Mahalanobis distances</span>
</span><span id="merit_mahalanobis-363"><a href="#merit_mahalanobis-363"><span class="linenos">363</span></a>    <span class="n">MD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</span><span id="merit_mahalanobis-364"><a href="#merit_mahalanobis-364"><span class="linenos">364</span></a>    <span class="n">v_matrix_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">v_matrix</span><span class="p">)</span>
</span><span id="merit_mahalanobis-365"><a href="#merit_mahalanobis-365"><span class="linenos">365</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
</span><span id="merit_mahalanobis-366"><a href="#merit_mahalanobis-366"><span class="linenos">366</span></a>        <span class="n">diff</span> <span class="o">=</span> <span class="n">YTheoMat</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">YobsMat</span>
</span><span id="merit_mahalanobis-367"><a href="#merit_mahalanobis-367"><span class="linenos">367</span></a>        <span class="n">MD</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">v_matrix_inv</span><span class="p">),</span> <span class="n">diff</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="merit_mahalanobis-368"><a href="#merit_mahalanobis-368"><span class="linenos">368</span></a>
</span><span id="merit_mahalanobis-369"><a href="#merit_mahalanobis-369"><span class="linenos">369</span></a>    <span class="k">return</span> <span class="n">MD</span>
</span></pre></div>


            <div class="docstring"><p>Calculate mahalanobis distance (MD) values for the given theoretical patterns.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>Yobs</strong> (numpy array, dtype=float):
observed values (period or frequency)</li>
<li><strong>obs_err</strong> (numpy array, dtype=float):
Errors on Yobs</li>
<li><strong>YTheo</strong> (numpy array of arrays of floats):
Array of all theoretical patterns to calculate the MD value for.</li>
<li><strong>generate_output</strong> (boolean):
Flag to write output and plot the variance-covariance matrix</li>
<li><strong>fig_title</strong> (string):
The name of the figure to be created.</li>
<li><strong>star_name</strong> (string):
The name of the analysed star, for file naming purposes.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>MD</strong> (numpy array, dtype=float):
Mahalanobis distances for the given theoretical patterns.</li>
</ul>
</div>


                </section>
                <section id="check_matrix">
                            <input id="check_matrix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_matrix</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">v_matrix</span>, </span><span class="param"><span class="n">generate_output</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">fig_title</span><span class="o">=</span><span class="s1">&#39;Vmatrix&#39;</span>, </span><span class="param"><span class="n">star_name</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="check_matrix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#check_matrix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="check_matrix-373"><a href="#check_matrix-373"><span class="linenos">373</span></a><span class="k">def</span> <span class="nf">check_matrix</span><span class="p">(</span><span class="n">v_matrix</span><span class="p">,</span> <span class="n">generate_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fig_title</span><span class="o">=</span><span class="s2">&quot;Vmatrix&quot;</span><span class="p">,</span> <span class="n">star_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="check_matrix-374"><a href="#check_matrix-374"><span class="linenos">374</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="check_matrix-375"><a href="#check_matrix-375"><span class="linenos">375</span></a><span class="sd">    Check the if the the eigenvalues of the Variance-covariance matrix are all positive,</span>
</span><span id="check_matrix-376"><a href="#check_matrix-376"><span class="linenos">376</span></a><span class="sd">    since this means the matrix is positive definite. Compute its determinant and condition number,</span>
</span><span id="check_matrix-377"><a href="#check_matrix-377"><span class="linenos">377</span></a><span class="sd">    and write them to a tsv file. Create and save a figure of the variance-covariance matrix.</span>
</span><span id="check_matrix-378"><a href="#check_matrix-378"><span class="linenos">378</span></a>
</span><span id="check_matrix-379"><a href="#check_matrix-379"><span class="linenos">379</span></a><span class="sd">    Parameters</span>
</span><span id="check_matrix-380"><a href="#check_matrix-380"><span class="linenos">380</span></a><span class="sd">    ----------</span>
</span><span id="check_matrix-381"><a href="#check_matrix-381"><span class="linenos">381</span></a><span class="sd">    v_matrix: numpy ndarray (2D), dtype=float</span>
</span><span id="check_matrix-382"><a href="#check_matrix-382"><span class="linenos">382</span></a><span class="sd">        Variance-covariance matrix</span>
</span><span id="check_matrix-383"><a href="#check_matrix-383"><span class="linenos">383</span></a><span class="sd">    output: boolean</span>
</span><span id="check_matrix-384"><a href="#check_matrix-384"><span class="linenos">384</span></a><span class="sd">        Flag to write output and plot the variance-covariance matrix</span>
</span><span id="check_matrix-385"><a href="#check_matrix-385"><span class="linenos">385</span></a><span class="sd">    fig_title: string</span>
</span><span id="check_matrix-386"><a href="#check_matrix-386"><span class="linenos">386</span></a><span class="sd">        The name of the figure to be created.</span>
</span><span id="check_matrix-387"><a href="#check_matrix-387"><span class="linenos">387</span></a><span class="sd">    star_name: string</span>
</span><span id="check_matrix-388"><a href="#check_matrix-388"><span class="linenos">388</span></a><span class="sd">        The name of the analysed star, for file naming purposes.</span>
</span><span id="check_matrix-389"><a href="#check_matrix-389"><span class="linenos">389</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="check_matrix-390"><a href="#check_matrix-390"><span class="linenos">390</span></a>    <span class="c1"># If all eigenvalues are &gt;0, it is positive definite</span>
</span><span id="check_matrix-391"><a href="#check_matrix-391"><span class="linenos">391</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">v_matrix</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="check_matrix-392"><a href="#check_matrix-392"><span class="linenos">392</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;V matrix is possibly not positive definite (since eigenvalues are not all &gt; 0)&quot;</span><span class="p">)</span>
</span><span id="check_matrix-393"><a href="#check_matrix-393"><span class="linenos">393</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="check_matrix-394"><a href="#check_matrix-394"><span class="linenos">394</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max(v_matrix) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v_matrix</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="check_matrix-395"><a href="#check_matrix-395"><span class="linenos">395</span></a>    <span class="c1"># multiply the matrix by the exponent of this, otherwise the determinant can be too small for the numerics</span>
</span><span id="check_matrix-396"><a href="#check_matrix-396"><span class="linenos">396</span></a>    <span class="n">kk</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="check_matrix-397"><a href="#check_matrix-397"><span class="linenos">397</span></a>
</span><span id="check_matrix-398"><a href="#check_matrix-398"><span class="linenos">398</span></a>    <span class="k">if</span> <span class="n">generate_output</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="check_matrix-399"><a href="#check_matrix-399"><span class="linenos">399</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">/V_matrix/</span><span class="si">{</span><span class="n">star_name</span><span class="si">}</span><span class="s2">_determinant_conditionNr.tsv&quot;</span><span class="p">)</span>
</span><span id="check_matrix-400"><a href="#check_matrix-400"><span class="linenos">400</span></a>        <span class="n">file_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="check_matrix-401"><a href="#check_matrix-401"><span class="linenos">401</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="check_matrix-402"><a href="#check_matrix-402"><span class="linenos">402</span></a>            <span class="k">with</span> <span class="n">file_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="check_matrix-403"><a href="#check_matrix-403"><span class="linenos">403</span></a>                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;method </span><span class="se">\t</span><span class="s2"> ln(det(V)) </span><span class="se">\t</span><span class="s2"> condition_number </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="check_matrix-404"><a href="#check_matrix-404"><span class="linenos">404</span></a>        <span class="k">with</span> <span class="n">file_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="check_matrix-405"><a href="#check_matrix-405"><span class="linenos">405</span></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="check_matrix-406"><a href="#check_matrix-406"><span class="linenos">406</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_title</span><span class="si">}</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">*</span><span class="n">v_matrix</span><span class="p">))</span><span class="o">-</span><span class="n">kk</span><span class="o">*</span><span class="n">v_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">v_matrix</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> &quot;</span>
</span><span id="check_matrix-407"><a href="#check_matrix-407"><span class="linenos">407</span></a>            <span class="p">)</span>
</span><span id="check_matrix-408"><a href="#check_matrix-408"><span class="linenos">408</span></a>
</span><span id="check_matrix-409"><a href="#check_matrix-409"><span class="linenos">409</span></a>        <span class="c1"># Do *10^4 to get rid of small values, and put this in the colorbar label</span>
</span><span id="check_matrix-410"><a href="#check_matrix-410"><span class="linenos">410</span></a>        <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">v_matrix</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds&quot;</span><span class="p">)</span>
</span><span id="check_matrix-411"><a href="#check_matrix-411"><span class="linenos">411</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;obs </span><span class="si">{</span><span class="n">v_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">  $\leftarrow$ obs 1&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="check_matrix-412"><a href="#check_matrix-412"><span class="linenos">412</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;obs 1 $\rightarrow$ obs </span><span class="si">{</span><span class="n">v_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="check_matrix-413"><a href="#check_matrix-413"><span class="linenos">413</span></a>
</span><span id="check_matrix-414"><a href="#check_matrix-414"><span class="linenos">414</span></a>        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</span><span id="check_matrix-415"><a href="#check_matrix-415"><span class="linenos">415</span></a>        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[d$^</span><span class="si">{2}</span><span class="s2"> 10^{-4}$]&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="check_matrix-416"><a href="#check_matrix-416"><span class="linenos">416</span></a>        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="check_matrix-417"><a href="#check_matrix-417"><span class="linenos">417</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Variance covariance matrix&quot;</span><span class="p">)</span>
</span><span id="check_matrix-418"><a href="#check_matrix-418"><span class="linenos">418</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</span><span id="check_matrix-419"><a href="#check_matrix-419"><span class="linenos">419</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="check_matrix-420"><a href="#check_matrix-420"><span class="linenos">420</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">/V_matrix/</span><span class="si">{</span><span class="n">fig_title</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
</span><span id="check_matrix-421"><a href="#check_matrix-421"><span class="linenos">421</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="check_matrix-422"><a href="#check_matrix-422"><span class="linenos">422</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Check the if the the eigenvalues of the Variance-covariance matrix are all positive,
since this means the matrix is positive definite. Compute its determinant and condition number,
and write them to a tsv file. Create and save a figure of the variance-covariance matrix.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>v_matrix</strong> (numpy ndarray (2D), dtype=float):
Variance-covariance matrix</li>
<li><strong>output</strong> (boolean):
Flag to write output and plot the variance-covariance matrix</li>
<li><strong>fig_title</strong> (string):
The name of the figure to be created.</li>
<li><strong>star_name</strong> (string):
The name of the analysed star, for file naming purposes.</li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script>
<style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style>pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
<style>:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
<style>.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>    

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">FOAM maintained by <a href="https://github.com/MichielsenM">MichielsenM</a>, created by Mathias Michielsen</p>
        <p>Generated with <a href="https://pdoc.dev/">Pdoc</a>. Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
  </body>
</div>  
</html>